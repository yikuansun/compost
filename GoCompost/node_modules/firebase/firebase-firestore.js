!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(Gd){"use strict";try{(function(){Gd=Gd&&Gd.hasOwnProperty("default")?Gd.default:Gd;var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function t(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o,e,f=function(){return(f=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function p(o,s,a,u){return new(a=a||Promise)(function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,r)}i((u=u.apply(o,s||[])).next())})}function y(n,r){var i,o,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}function a(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}(e=o=o||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT";function n(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case o.DEBUG:case o.VERBOSE:console.log.apply(console,a(["["+i+"]  "+t.name+":"],n));break;case o.INFO:console.info.apply(console,a(["["+i+"]  "+t.name+":"],n));break;case o.WARN:console.warn.apply(console,a(["["+i+"]  "+t.name+":"],n));break;case o.ERROR:console.error.apply(console,a(["["+i+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}var i=o.INFO,u=(Object.defineProperty(h.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in o))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),h.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.DEBUG],t))},h.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.VERBOSE],t))},h.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.INFO],t))},h.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.WARN],t))},h.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.ERROR],t))},h);function h(t){this.name=t,this._logLevel=i,this._logHandler=n}function l(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var c,d=(t(v,c=Error),v);function v(t,e){var n=c.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,v.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,m.prototype.create),n}var m=(g.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],s=o?function(t,r){return t.replace(w,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})}(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").",u=new d(i,a),h=0,c=Object.keys(r);h<c.length;h++){var f=c[h];"_"!==f.slice(-1)&&(f in u&&console.warn('Overwriting FirebaseError base field "'+f+'" can cause unexpected behavior.'),u[f]=r[f])}return u},g);function g(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var w=/\{\$([^}]+)}/g,b=(E.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},E.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},E.prototype.setServiceProps=function(t){return this.serviceProps=t,this},E);function E(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var I,T="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},N=N||{},A=T;function S(t){return"string"==typeof t}function k(t){return"number"==typeof t}function D(t,e){t=t.split("."),e=e||A;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function R(){}function _(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function O(t){return"array"==_(t)}function C(t){var e=_(t);return"array"==e||"object"==e&&"number"==typeof t.length}function x(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var L="closure_uid_"+(1e9*Math.random()>>>0),P=0;function U(t,e,n){return t.call.apply(t.bind,arguments)}function M(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function V(t,e,n){return(V=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?U:M).apply(null,arguments)}function q(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var F=Date.now||function(){return+new Date};function j(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).xb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function B(){this.j=this.j,this.i=this.i}B.prototype.j=!1,B.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[L]||(this[L]=++P)},B.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var G=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(S(t))return S(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Y=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=S(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function z(t){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function H(t){return/^[\s\xa0]*$/.test(t)}var Q,Z=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function K(t,e){return-1!=t.indexOf(e)}function J(t,e){return t<e?-1:e<t?1:0}t:{var $=A.navigator;if($){var X=$.userAgent;if(X){Q=X;break t}}Q=""}function tt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function et(t){var e,n={};for(e in t)n[e]=t[e];return n}var nt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function rt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<nt.length;o++)n=nt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function it(t){return it[" "](t),t}it[" "]=R;var ot,st,at=K(Q,"Opera"),ut=K(Q,"Trident")||K(Q,"MSIE"),ht=K(Q,"Edge"),ct=ht||ut,ft=K(Q,"Gecko")&&!(K(Q.toLowerCase(),"webkit")&&!K(Q,"Edge"))&&!(K(Q,"Trident")||K(Q,"MSIE"))&&!K(Q,"Edge"),lt=K(Q.toLowerCase(),"webkit")&&!K(Q,"Edge");function pt(){var t=A.document;return t?t.documentMode:void 0}t:{var dt="",yt=(st=Q,ft?/rv:([^\);]+)(\)|;)/.exec(st):ht?/Edge\/([\d\.]+)/.exec(st):ut?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(st):lt?/WebKit\/(\S+)/.exec(st):at?/(?:Version)[ \/]?(\S+)/.exec(st):void 0);if(yt&&(dt=yt?yt[1]:""),ut){var vt=pt();if(null!=vt&&vt>parseFloat(dt)){ot=String(vt);break t}}ot=dt}var mt,gt={};function wt(a){return function(t,e){var n=gt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(a,function(){for(var t=0,e=Z(String(ot)).split("."),n=Z(String(a)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=J(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||J(0==o[2].length,0==s[2].length)||J(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t})}var bt=A.document;mt=bt&&ut?pt()||("CSS1Compat"==bt.compatMode?parseInt(ot,10):5):void 0;var Et=!ut||9<=Number(mt),It=ut&&!wt("9"),Tt=function(){if(!A.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{A.addEventListener("test",R,e),A.removeEventListener("test",R,e)}catch(t){}return t}();function Nt(t,e){this.type=t,this.a=this.target=e,this.Ia=!0}function At(t,e){if(Nt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ft){t:{try{it(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=S(t.pointerType)?t.pointerType:St[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Nt.prototype.b=function(){this.Ia=!1},j(At,Nt);var St={2:"touch",3:"pen",4:"mouse"};At.prototype.b=function(){At.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,It)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var kt="closure_listenable_"+(1e6*Math.random()|0),Dt=0;function Rt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++Dt,this.X=this.Z=!1}function _t(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Ot(t){this.src=t,this.a={},this.b=0}function Ct(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=G(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(_t(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function xt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Ot.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=xt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Rt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Lt="closure_lm_"+(1e6*Math.random()|0),Pt={};function Ut(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(O(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Yt(r);return e&&e[kt]?e.Aa(n,r,x(i)?!!i.capture:!!i,o):Mt(e,n,r,!0,i,o)}(t,e,n,r,i);if(O(e)){for(var o=0;o<e.length;o++)Ut(t,e[o],n,r,i);return null}return n=Yt(n),t&&t[kt]?t.za(e,n,x(r)?!!r.capture:!!r,i):Mt(t,e,n,!1,r,i)}function Mt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=x(i)?!!i.capture:!!i;if(s&&!Et)return null;var a=Bt(t);if(a||(t[Lt]=a=new Ot(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var e=jt,n=Et?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Tt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(qt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Vt(t){if(!k(t)&&t&&!t.X){var e=t.src;if(e&&e[kt])Ct(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(qt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Bt(e))?(Ct(n,t),0==n.b&&(n.src=null,e[Lt]=null)):_t(t)}}}function qt(t){return t in Pt?Pt[t]:Pt[t]="on"+t}function Ft(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Vt(t),n.call(r,e)}function jt(t,e){return!!t.X||(Et?Ft(t,new At(e,this)):Ft(t,e=new At(e||D("window.event"),this)))}function Bt(t){return(t=t[Lt])instanceof Ot?t:null}var Gt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Yt(e){return"function"==_(e)?e:(e[Gt]||(e[Gt]=function(t){return e.handleEvent(t)}),e[Gt])}function zt(){B.call(this),this.c=new Ot(this),(this.J=this).B=null}function Wt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.X&&s.capture==n){var a=s.listener,u=s.da||s.src;s.Z&&Ct(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&0!=r.Ia}j(zt,B),zt.prototype[kt]=!0,(I=zt.prototype).addEventListener=function(t,e,n,r){Ut(this,t,e,n,r)},I.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(O(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=x(i)?!!i.capture:!!i,r=Yt(r),e&&e[kt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=xt(s=e.a[n],r,i,o))&&(_t(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Bt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=xt(n,r,i,o)),(r=-1<e?n[e]:null)&&Vt(r))}(this,t,e,n,r)},I.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(S(t))t=new Nt(t,n);else if(t instanceof Nt)t.target=t.target||n;else{var i=t;rt(t=new Nt(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=Wt(s,r,!0,t)&&i}if(i=Wt(s=t.a=n,r,!0,t)&&i,i=Wt(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Wt(s=t.a=e[o],r,!1,t)&&i;return i},I.G=function(){if(zt.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)_t(n[r]);delete e.a[t],e.b--}}this.B=null},I.za=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},I.Aa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Ht=A.JSON.stringify;function Qt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Zt(){this.b=this.a=null}Qt.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Kt,Jt=new Qt(function(){return new $t},function(t){t.reset()});function $t(){this.next=this.b=this.a=null}function Xt(t){A.setTimeout(function(){throw t},0)}function te(t,e){Kt||function(){var t=A.Promise.resolve(void 0);Kt=function(){t.then(re)}}(),ee||(Kt(),ee=!0),ne.add(t,e)}Zt.prototype.add=function(t,e){var n=Jt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},$t.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var ee=!($t.prototype.reset=function(){this.next=this.b=this.a=null}),ne=new Zt;function re(){for(var t;r=n=void 0,r=null,(n=ne).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){Xt(t)}var e=Jt;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;ee=!1}function ie(t,e){zt.call(this),this.b=t||1,this.a=e||A,this.f=V(this.fb,this),this.g=F()}function oe(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function se(t,e,n){if("function"==_(t))n&&(t=V(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=V(t.handleEvent,t)}return 2147483647<Number(e)?-1:A.setTimeout(t,e||0)}function ae(t,e,n){B.call(this),this.f=null!=n?V(t,n):t,this.c=e,this.b=V(this.$a,this),this.a=[]}function ue(t){t.U=se(t.b,t.c),t.f.apply(null,t.a)}function he(t){B.call(this),this.b=t,this.a={}}j(ie,zt),(I=ie.prototype).ba=!1,I.L=null,I.fb=function(){if(this.ba){var t=F()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(oe(this),this.start()))}},I.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=F())},I.G=function(){ie.N.G.call(this),oe(this),delete this.a},j(ae,B),(I=ae.prototype).ea=!1,I.U=null,I.Ta=function(t){this.a=arguments,this.U?this.ea=!0:ue(this)},I.G=function(){ae.N.G.call(this),this.U&&(A.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},I.$a=function(){this.U=null,this.ea&&(this.ea=!1,ue(this))},j(he,B);var ce=[];function fe(t,e,n,r){O(n)||(n&&(ce[0]=n.toString()),n=ce);for(var i=0;i<n.length;i++){var o=Ut(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function le(t){tt(t.a,function(t,e){this.a.hasOwnProperty(e)&&Vt(t)},t),t.a={}}function pe(){}he.prototype.G=function(){he.N.G.call(this),le(this)},he.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var de=new zt;function ye(t){Nt.call(this,"serverreachability",t)}function ve(t){de.dispatchEvent(new ye(de,t))}function me(t){Nt.call(this,"statevent",t)}function ge(t){de.dispatchEvent(new me(de,t))}function we(t){Nt.call(this,"timingevent",t)}function be(t,e){if("function"!=_(t))throw Error("Fn must not be null and must be a function");return A.setTimeout(function(){t()},e)}j(ye,Nt),j(me,Nt),j(we,Nt);var Ee={NO_ERROR:0,gb:1,nb:2,mb:3,jb:4,lb:5,ob:6,La:7,TIMEOUT:8,rb:9},Ie={ib:"complete",vb:"success",Ma:"error",La:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",kb:"downloadprogress",wb:"uploadprogress"};function Te(){}function Ne(t){var e;return(e=t.a)||(e=t.a={}),e}function Ae(){}Te.prototype.a=null;var Se,ke={OPEN:"a",hb:"b",Ma:"c",qb:"d"};function De(){Nt.call(this,"d")}function Re(){Nt.call(this,"c")}function _e(){}function Oe(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new he(this),this.O=Ce,t=ct?125:void 0,this.P=new ie(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}j(De,Nt),j(Re,Nt),j(_e,Te),Se=new _e;var Ce=45e3,xe={},Le={};function Pe(t,e,n){t.F=1,t.f=an(Xe(e)),t.l=n,t.H=!0,Me(t,null)}function Ue(t,e,n,r){t.F=1,t.f=an(Xe(e)),t.l=null,t.H=n,Me(t,r)}function Me(t,e){t.v=F(),Fe(t),t.D=Xe(t.f),sn(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new ae(V(t.Ja,t,t.a),t.J)),fe(t.I,t.a,"readystatechange",t.cb),e=t.h?et(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),ve(1)}function Ve(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=qe(t,n);if(i==Le){4==e&&(t.c=4,ge(14),r=!1);break}if(i==xe){t.c=4,ge(15),r=!1;break}ze(t,i)}4==e&&0==n.length&&(t.c=1,ge(16),r=!1),t.b=t.b&&r,r||(Ye(t),Ge(t))}function qe(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Le:(n=Number(e.substring(n,r)),isNaN(n)?xe:(r+=1)+n>e.length?Le:(e=e.substr(r,n),t.A=r+n,e))}function Fe(t){t.R=F()+t.O,je(t,t.O)}function je(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=be(V(t.ab,t),e)}function Be(t){t.i&&(A.clearTimeout(t.i),t.i=null)}function Ge(t){t.g.Ca()||t.m||t.g.na(t)}function Ye(t){Be(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,oe(t.P),le(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function ze(t,e){try{t.g.Fa(t,e),ve(4)}catch(t){}}function We(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(C(t)||S(t))Y(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(C(t)||S(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(S(t))return t.split("");if(C(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function He(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof He)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Qe(t,e){Ke(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ze(t))}function Ze(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ke(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Ke(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Ke(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(I=Oe.prototype).setTimeout=function(t){this.O=t},I.cb=function(t){t=t.target;var e=this.B;e&&3==Xn(t)?e.Ta():this.Ja(t)},I.Ja=function(t){try{if(t==this.a)t:{var e=Xn(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!ct&&!this.a.aa())){this.m||4!=e||7==n||ve(8==n||r<=0?3:2),Be(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var s=tr(this.a,"X-HTTP-Initial-Response");if(s&&!H(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.c=3,ge(12),Ye(this),Ge(this);break t}this.s=!0,ze(this,a)}this.H?(Ve(this,e,o),ct&&this.b&&3==e&&(fe(this.I,this.P,"tick",this.bb),this.P.start())):ze(this,o),4==e&&Ye(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Fe(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,ge(12)):(this.c=0,ge(13)),Ye(this),Ge(this)}}}catch(t){}},I.bb=function(){if(this.a){var t=Xn(this.a),e=this.a.aa();this.A<e.length&&(Be(this),Ve(this,t,e),this.b&&4!=t&&Fe(this))}},I.cancel=function(){this.m=!0,Ye(this)},I.ab=function(){this.i=null;var t=F();0<=t-this.R?(2!=this.F&&(ve(3),ge(17)),Ye(this),this.c=2,Ge(this)):je(this,this.R-t)},(I=He.prototype).C=function(){Ze(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},I.K=function(){return Ze(this),this.a.concat()},I.get=function(t,e){return Ke(this.b,t)?this.b[t]:e},I.set=function(t,e){Ke(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},I.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Je=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function $e(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof $e?(this.h=void 0!==e?e:t.h,tn(this,t.f),this.j=t.j,en(this,t.b),nn(this,t.i),this.a=t.a,rn(this,En(t.c)),this.g=t.g):t&&(n=String(t).match(Je))?(this.h=!!e,tn(this,n[1]||"",!0),this.j=un(n[2]||""),en(this,n[3]||"",!0),nn(this,n[4]),this.a=un(n[5]||"",!0),rn(this,n[6]||"",!0),this.g=un(n[7]||"")):(this.h=!!e,this.c=new vn(null,this.h))}function Xe(t){return new $e(t)}function tn(t,e,n){t.f=n?un(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function en(t,e,n){t.b=n?un(e,!0):e}function nn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function rn(t,e,n){e instanceof vn?(t.c=e,function(t,e){e&&!t.f&&(mn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(gn(this,e),bn(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=hn(e,dn)),t.c=new vn(e,t.h))}function on(t,e,n){t.c.set(e,n)}function sn(t,e,n){O(n)||(n=[String(n)]),bn(t.c,e,n)}function an(t){return on(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^F()).toString(36)),t}function un(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function hn(t,e,n){return S(t)?(t=encodeURI(t).replace(e,cn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function cn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}$e.prototype.toString=function(){var t=[],e=this.f;e&&t.push(hn(e,fn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(hn(e,fn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(hn(n,"/"==n.charAt(0)?pn:ln,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",hn(n,yn)),t.join("")},$e.prototype.resolve=function(t){var e=Xe(this),n=!!t.f;n?tn(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?en(e,t.b):n=null!=t.i;var r=t.a;if(n)nn(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(K(i,"./")||K(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],s=0;s<i.length;){var a=i[s++];"."==a?r&&s==i.length&&o.push(""):".."==a?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&s==i.length&&o.push("")):(o.push(a),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?rn(e,En(t.c)):n=!!t.g,n&&(e.g=t.g),e};var fn=/[#\/\?@]/g,ln=/[#\?:]/g,pn=/[#\?]/g,dn=/[#\?@]/g,yn=/#/g;function vn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function mn(n){n.a||(n.a=new He,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function gn(t,e){mn(t),e=In(t,e),Ke(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Qe(t.a,e))}function wn(t,e){return mn(t),e=In(t,e),Ke(t.a.b,e)}function bn(t,e,n){gn(t,e),0<n.length&&(t.c=null,t.a.set(In(t,e),W(n)),t.b+=n.length)}function En(t){var e=new vn;return e.c=t.c,t.a&&(e.a=new He(t.a),e.b=t.b),e}function In(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function Tn(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function Nn(t){var e=t.a.F.a;if(null!=e)ge(4),e?(ge(10),lr(t.a,t,!1)):(ge(11),lr(t.a,t,!0));else{t.b=new Oe(t,void 0,void 0),t.b.h=t.h,e=mr(e=t.a,e.Y()?t.f:null,t.i),ge(4),sn(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&on(e,n,r),Ue(t.b,e,!1,t.f)}}function An(){this.a=this.b=null}function Sn(){this.a=new He}function kn(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[L]||(t[L]=++P)):e.charAt(0)+t}function Dn(t,e){this.b=t,this.a=e}function Rn(t){this.g=t||_n,t=A.PerformanceNavigationTiming?0<(t=A.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(A.ka&&A.ka.Da&&A.ka.Da()&&A.ka.Da().yb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Sn),this.b=null,this.c=[]}(I=vn.prototype).add=function(t,e){mn(this),this.c=null,t=In(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},I.forEach=function(n,r){mn(this),this.a.forEach(function(t,e){Y(t,function(t){n.call(r,t,e,this)},this)},this)},I.K=function(){mn(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},I.C=function(t){mn(this);var e=[];if(S(t))wn(this,t)&&(e=z(e,this.a.get(In(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=z(e,t[n])}return e},I.set=function(t,e){return mn(this),this.c=null,wn(this,t=In(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},I.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},I.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")},j(function(){},function(){}),(I=Tn.prototype).M=null,I.$=function(t){return this.a.$(t)},I.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},I.Ca=function(){return!1},I.Fa=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=tr(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=tr(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void yr(e,2)}this.f=r[0]}else(e=this.a).m=this.c,yr(e,2)}else 1==this.M&&(this.g?ge(6):"11111"==e?(ge(5),this.g=!0,(!ut||10<=Number(mt))&&(this.c=200,this.b.cancel(),ge(11),lr(this.a,this,!0))):(ge(7),this.g=!1))},I.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,Nn(this)):1==this.M&&(this.g?(ge(11),lr(this.a,this,!0)):(ge(10),lr(this.a,this,!1)));else{0==this.M?ge(8):1==this.M&&ge(9);var t=this.a;t.m=this.c,yr(t,2)}},I.Y=function(){return this.a.Y()},I.ma=function(){return this.a.ma()},Sn.prototype.add=function(t){this.a.set(kn(t),t)},Sn.prototype.C=function(){return this.a.C()};var _n=10;function On(t,e){!t.a&&(K(e,"spdy")||K(e,"quic")||K(e,"h2"))&&(t.f=t.g,t.a=new Sn,t.b&&(Pn(t,t.b),t.b=null))}function Cn(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function xn(t){return t.b?1:t.a?t.a.a.c:0}function Ln(t,e){return t=t.b?t.b==e:!!t.a&&(e=kn(e),Ke(t.a.a.b,e))}function Pn(t,e){t.a?t.a.add(e):t.b=e}function Un(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=kn(e),n=Ke(t.a.a.b,n)),n&&Qe(t.a.a,kn(e)))}function Mn(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return W(t.c);var e=t.c;return Y(t.a.C(),function(t){e=e.concat(t.j)}),e}function Vn(){}function qn(){this.a=new Vn}function Fn(t,r,e){var i=e||"";try{We(t,function(t,e){var n=t;x(t)&&(n=Ht(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function jn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}Rn.prototype.cancel=function(){this.c=Mn(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(Y(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},Vn.prototype.stringify=function(t){return A.JSON.stringify(t,void 0)},Vn.prototype.parse=function(t){return A.JSON.parse(t,void 0)};var Bn=A.JSON.parse;function Gn(t){zt.call(this),this.headers=new He,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Yn,this.D=this.F=!1}j(Gn,zt);var Yn="",zn=/^https?$/i,Wn=["POST","PUT"];function Hn(t){return"content-type"==t.toLowerCase()}function Qn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Zn(t),Jn(t)}function Zn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Kn(t){if(t.b&&void 0!==N&&(!t.s[1]||4!=Xn(t)||2!=t.T()))if(t.l&&4==Xn(t))se(t.Ea,0,t);else if(t.dispatchEvent("readystatechange"),4==Xn(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Je)[1]||null;if(!o&&A.self&&A.self.location){var s=A.self.location.protocol;o=s.substr(0,s.length-1)}i=!zn.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var a=2<Xn(t)?t.a.statusText:""}catch(t){a=""}t.f=a+" ["+t.T()+"]",Zn(t)}}finally{Jn(t)}}}function Jn(t,e){if(t.a){$n(t);var n=t.a,r=t.s[0]?R:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function $n(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(A.clearTimeout(t.m),t.m=null)}function Xn(t){return t.a?t.a.readyState:0}function tr(t,e){return t.a?t.a.getResponseHeader(e):null}function er(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var n="";return tt(t,function(t,e){n+=e,n+=":",n+=t,n+="\r\n"}),n}(n),S(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return on(t,e,n),t}function nr(t){this.f=[],this.F=new An,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!D("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=D("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Ra=D("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Pa=D("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=D("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Ka=t&&t.zb||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new Rn(t&&t.concurrentRequestLimit),this.ja=new qn,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function rr(t){if(ir(t),3==t.u){var e=t.P++,n=Xe(t.B);on(n,"SID",t.H),on(n,"RID",e),on(n,"TYPE","terminate"),ur(t,n),(e=new Oe(t,e,void 0)).F=2,e.f=an(Xe(n)),n=!1,A.navigator&&A.navigator.sendBeacon&&(n=A.navigator.sendBeacon(e.f.toString(),"")),!n&&A.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=F(),Fe(e)}vr(t)}function ir(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(A.clearTimeout(t.l),t.l=null),pr(t),t.b.cancel(),t.h&&(k(t.h)&&A.clearTimeout(t.h),t.h=null)}function or(t,e){t.f.push(new Dn(t.Qa++,e)),3==t.u&&sr(t)}function sr(t){Cn(t.b)||t.h||(t.h=!0,te(t.Ha,t),t.A=0)}function ar(t,e){var n;n=e?e.W:t.P++;var r=Xe(t.B);on(r,"SID",t.H),on(r,"RID",n),on(r,"AID",t.O),ur(t,r),t.g&&t.i&&er(r,t.g,t.i),n=new Oe(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=hr(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Pn(t.b,n),Pe(n,r,e)}function ur(t,n){t.c&&We({},function(t,e){on(n,e,t)})}function hr(t,e,n){n=Math.min(t.f.length,n);var r=t.c?V(t.c.Sa,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var h=i[u].b,c=i[u].a;if((h-=o)<0)o=Math.max(0,i[u].b-100),a=!1;else try{Fn(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(a){r=s.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function cr(t){t.a||t.l||(t.S=1,te(t.Ga,t),t.v=0)}function fr(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=be(V(t.Ga,t),dr(t,t.v)),t.v++,!0)}function lr(t,e,n){var r=e.l;r&&On(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=mr(t,null,t.ha),sr(t)}function pr(t){null!=t.s&&(A.clearTimeout(t.s),t.s=null)}function dr(t,e){var n=t.Na+Math.floor(Math.random()*t.Ra);return t.ma()||(n*=2),n*e}function yr(t,e){if(2==e){var n=null;t.c&&(n=null);var r=V(t.eb,t);n||(n=new $e("//www.google.com/images/cleardot.gif"),A.location&&"http"==A.location.protocol||tn(n,"https"),an(n)),function(t,e){var n=new pe;if(A.Image){var r=new Image;r.onload=q(jn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=q(jn,n,r,"TestLoadImage: error",!1,e),r.onabort=q(jn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=q(jn,n,r,"TestLoadImage: timeout",!1,e),A.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ge(2);t.u=0,t.c&&t.c.ta(e),vr(t),ir(t)}function vr(t){t.u=0,t.m=-1,t.c&&(0==Mn(t.b).length&&0==t.f.length||(t.b.c.length=0,W(t.f),t.f.length=0),t.c.sa())}function mr(t,e,n){var r=function(t){return t instanceof $e?Xe(t):new $e(t,void 0)}(n);if(""!=r.b)e&&en(r,e+"."+r.b),nn(r,r.i);else{var i,o=A.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new $e(null,void 0);return t&&tn(i,t),e&&en(i,e),n&&nn(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&tt(t.V,function(t,e){on(r,e,t)}),e=t.j,n=t.I,e&&n&&on(r,e,n),on(r,"VER",t.wa),ur(t,r),r}function gr(){}function wr(){if(ut&&!(10<=Number(mt)))throw Error("Environmental error: no available transport.")}function br(t,e){zt.call(this),this.a=new nr(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))e=i;else(r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!H(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!H(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Tr(this)}function Er(t){De.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Ir(){Re.call(this),this.status=1}function Tr(t){this.a=t}(I=Gn.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Ne(this.H):Ne(Se),this.a.onreadystatechange=V(this.Ea,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Qn(this,t)}t=n||"";var i=new He(this.headers);r&&We(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Hn,n=t.length,r=S(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:S(t)?t.charAt(e):t[e]}(i.K()),n=A.FormData&&t instanceof A.FormData,0<=G(Wn,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{$n(this),0<this.o&&((this.D=function(t){return ut&&wt(9)&&k(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=V(this.Ba,this)):this.m=se(this.Ba,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Qn(this,t)}},I.Ba=function(){void 0!==N&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},I.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Jn(this))},I.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Jn(this,!0)),Gn.N.G.call(this)},I.Ea=function(){this.j||(this.w||this.l||this.g?Kn(this):this.Za())},I.Za=function(){Kn(this)},I.T=function(){try{return 2<Xn(this)?this.a.status:-1}catch(t){return-1}},I.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},I.Ua=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Bn(e)}},I.ya=function(){return this.h},I.Xa=function(){return S(this.f)?this.f:String(this.f)},(I=nr.prototype).wa=8,I.u=1,I.Ca=function(){return 0==this.u},I.Ha=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random()),t=this.P++;var e,n=new Oe(this,t,void 0),r=this.i;if(this.J&&(r?rt(r=et(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&S(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=hr(this,n,e),on(i=Xe(this.B),"RID",t),on(i,"CVER",22),this.o&&this.j&&on(i,"X-HTTP-Session-Id",this.j),ur(this,i),this.g&&r&&er(i,this.g,r),Pn(this.b,n),this.W?(on(i,"$req",e),on(i,"SID","null"),n.S=!0,Pe(n,i,null)):Pe(n,i,e),this.u=2}}else 3==this.u&&(t?ar(this,t):0==this.f.length||Cn(this.b)||ar(this))},I.Ga=function(){this.l=null,this.a=new Oe(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Xe(this.pa);on(t,"RID","rpc"),on(t,"SID",this.H),on(t,"CI",this.ia?"0":"1"),on(t,"AID",this.O),ur(this,t),on(t,"TYPE","xmlhttp"),this.g&&this.i&&er(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Ue(this.a,t,!0,this.ga)},I.Fa=function(t,e){if(0!=this.u&&(this.a==t||Ln(this.b,t)))if(this.m=t.o,!t.s&&Ln(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(O(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;pr(this),this.a.cancel(),this.a=null}fr(this),ge(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=be(V(this.Ya,this),6e3));if(xn(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else yr(this,11)}else if(!t.s&&this.a!=t||pr(this),!H(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&k(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=tr(r,"X-Client-Wire-Protocol"))&&On(this.b,i),this.j&&(r=tr(r,"X-HTTP-Session-Id")))&&(this.I=r,on(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=mr(this,this.Y()?this.ga:null,this.ha),r.s?(Un(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Be(r),Fe(r)),this.a=r):cr(this),0<this.f.length&&sr(this)}else"stop"!=r[0]&&"close"!=r[0]||yr(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?yr(this,7):rr(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},I.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,fr(this),ge(19))},I.na=function(t){var e=null;if(this.a==t){pr(this),this.a=null;var n=2}else{if(!Ln(this.b,t))return;e=t.j,Un(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=F()-t.v,de.dispatchEvent(new we(de,t.l?t.l.length:0,e,this.A)),sr(this)):cr(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(xn(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Oa?0:t.Pa))&&(t.h=be(V(t.Ha,t,e),dr(t,t.A)),t.A++,!0))}(this,t)||2==n&&fr(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:yr(this,5);break;case 4:yr(this,10);break;case 3:yr(this,6);break;default:yr(this,2)}}},I.eb=function(t){ge(t?2:1)},I.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Gn(this.Ka)).F=this.R,t},I.ma=function(){return!!this.c&&!0},I.Y=function(){return this.R},(I=gr.prototype).va=function(){},I.ua=function(){},I.ta=function(){},I.sa=function(){},I.Sa=function(){},wr.prototype.a=function(t,e){return new br(t,e)},j(br,zt),(I=br.prototype).addEventListener=function(t,e,n,r){br.N.addEventListener.call(this,t,e,n,r)},I.removeEventListener=function(t,e,n,r){br.N.removeEventListener.call(this,t,e,n,r)},I.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;ge(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new Tn(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=er(e,t.g,t.i)),(t=t.w).i=n,e=mr(t.a,null,t.i),ge(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,Nn(t)):(sn(e,"MODE","init"),!t.a.o&&t.a.j&&sn(e,"X-HTTP-Session-Id",t.a.j),t.b=new Oe(t,void 0,void 0),t.b.h=t.h,Ue(t.b,e,!1,null),t.M=0)},I.close=function(){rr(this.a)},I.Wa=function(t){if(S(t)){var e={};e.__data__=t,or(this.a,e)}else this.h?((e={}).__data__=Ht(t),or(this.a,e)):or(this.a,t)},I.G=function(){this.a.c=null,delete this.f,rr(this.a),delete this.a,br.N.G.call(this)},j(Er,De),j(Ir,Re),j(Tr,gr),Tr.prototype.va=function(){this.a.dispatchEvent("a")},Tr.prototype.ua=function(t){this.a.dispatchEvent(new Er(t))},Tr.prototype.ta=function(t){this.a.dispatchEvent(new Ir(t))},Tr.prototype.sa=function(){this.a.dispatchEvent("b")};var Nr=q(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},wr);wr.prototype.createWebChannel=wr.prototype.a,br.prototype.send=br.prototype.Wa,br.prototype.open=br.prototype.Va,br.prototype.close=br.prototype.close,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,Ie.COMPLETE="complete",(Ae.EventType=ke).OPEN="a",ke.CLOSE="b",ke.ERROR="c",ke.MESSAGE="d",zt.prototype.listen=zt.prototype.za,Gn.prototype.listenOnce=Gn.prototype.Aa,Gn.prototype.getLastError=Gn.prototype.Xa,Gn.prototype.getLastErrorCode=Gn.prototype.ya,Gn.prototype.getStatus=Gn.prototype.T,Gn.prototype.getResponseJson=Gn.prototype.Ua,Gn.prototype.getResponseText=Gn.prototype.aa,Gn.prototype.send=Gn.prototype.ca;var Ar,Sr,kr={createWebChannelTransport:Nr,ErrorCode:Ee,EventType:Ie,WebChannel:Ae,XhrIo:Gn},Dr=kr.createWebChannelTransport,Rr=kr.ErrorCode,_r=kr.EventType,Or=kr.WebChannel,Cr=kr.XhrIo,xr=Gd.SDK_VERSION,Lr=new u("@firebase/firestore");function Pr(){return Lr.logLevel===o.DEBUG?Ar.DEBUG:Lr.logLevel===o.SILENT?Ar.SILENT:Ar.ERROR}function Ur(t){switch(t){case Ar.DEBUG:Lr.logLevel=o.DEBUG;break;case Ar.ERROR:Lr.logLevel=o.ERROR;break;case Ar.SILENT:Lr.logLevel=o.SILENT;break;default:Lr.error("Firestore ("+xr+"): Invalid value passed to `setLogLevel`")}}function Mr(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Lr.logLevel<=o.DEBUG){var i=n.map(qr);Lr.debug.apply(Lr,s(["Firestore ("+xr+") ["+t+"]: "+e],i))}}function Vr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Lr.logLevel<=o.ERROR){var r=e.map(qr);Lr.error.apply(Lr,s(["Firestore ("+xr+"): "+t],r))}}function qr(t){if("string"==typeof t)return t;var e=ju.t();try{return e.i(t)}catch(e){return t}}function Fr(t){var e="FIRESTORE ("+xr+") INTERNAL ASSERTION FAILED: "+t;throw Vr(e),new Error(e)}function jr(t,e){t||Fr(e)}(Sr=Ar=Ar||{})[Sr.DEBUG=0]="DEBUG",Sr[Sr.ERROR=1]="ERROR",Sr[Sr.SILENT=2]="SILENT";var Br=(Gr.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return jr(20===e.length,"Invalid auto ID: "+e),e},Gr);function Gr(){}function Yr(t,e){return t<e?-1:e<t?1:0}function zr(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function Wr(t){return t+"\0"}function Hr(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var Qr,Zr,Kr,Jr,$r="(default)",Xr=(Object.defineProperty(ti.prototype,"o",{get:function(){return this.database===$r},enumerable:!0,configurable:!0}),ti.prototype.isEqual=function(t){return t instanceof ti&&t.projectId===this.projectId&&t.database===this.database},ti.prototype.h=function(t){return Yr(this.projectId,t.projectId)||Yr(this.database,t.database)},ti);function ti(t,e){this.projectId=t,this.database=e||$r}(Zr=Qr=Qr||{})[Zr.l=0]="__PRIVATE_Unknown",Zr[Zr.v=1]="__PRIVATE_Online",Zr[Zr.m=2]="__PRIVATE_Offline",(Jr=Kr=Kr||{})[Jr.p=0]="__PRIVATE_RemoteStore",Jr[Jr.g=1]="__PRIVATE_SharedClientState";function ei(t,e){this.user=e,this.type="OAuth",this.A={},this.A.Authorization="Bearer "+t}var ni,ri=(yi.prototype._=function(){return null!=this.uid},yi.prototype.I=function(){return this._()?"uid:"+this.uid:"anonymous-user"},yi.prototype.isEqual=function(t){return t.uid===this.uid},yi.UNAUTHENTICATED=new yi(null),yi.T=new yi("google-credentials-uid"),yi.R=new yi("first-party-uid"),yi),ii={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},oi=(t(di,ni=Error),di),si=(pi.prototype.getToken=function(){return Promise.resolve(null)},pi.prototype.P=function(){},pi.prototype.S=function(t){jr(!this.D,"Can only call setChangeListener() once."),(this.D=t)(ri.UNAUTHENTICATED)},pi.prototype.C=function(){jr(null!==this.D,"removeChangeListener() when no listener registered"),this.D=null},pi),ai=(li.prototype.getToken=function(){var e=this;jr(null!=this.V,"getToken cannot be called after listener removed.");var n=this.N,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){if(e.N!==n)throw new oi(ii.ABORTED,"getToken aborted due to token change.");return t?(jr("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new ei(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},li.prototype.P=function(){this.forceRefresh=!0},li.prototype.S=function(t){jr(!this.D,"Can only call setChangeListener() once."),this.D=t,this.k&&t(this.currentUser)},li.prototype.C=function(){jr(null!=this.V,"removeChangeListener() called twice"),jr(null!==this.D,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.V),this.V=null,this.D=null},li.prototype.O=function(){var t=this.auth&&this.auth.getUid();return jr(null===t||"string"==typeof t,"Received invalid UID: "+t),new ri(t)},li),ui=(Object.defineProperty(fi.prototype,"A",{get:function(){var t={"X-Goog-AuthUser":this.j},e=this.F.auth.U([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),fi),hi=(ci.prototype.getToken=function(){return Promise.resolve(new ui(this.F,this.j))},ci.prototype.S=function(t){t(ri.R)},ci.prototype.C=function(){},ci.prototype.P=function(){},ci);function ci(t,e){this.F=t,this.j=e}function fi(t,e){this.F=t,this.j=e,this.type="FirstParty",this.user=ri.R}function li(t){var e=this;this.V=null,this.currentUser=ri.UNAUTHENTICATED,this.k=!1,this.N=0,this.D=null,this.forceRefresh=!1,this.V=function(){e.N++,e.currentUser=e.O(),e.k=!0,e.D&&e.D(e.currentUser)},this.N=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.V):(this.V(null),t.get().then(function(t){e.auth=t,e.V&&e.auth.addAuthTokenListener(e.V)},function(){}))}function pi(){this.D=null}function di(t,e){var n=ni.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function yi(t){this.uid=t}function vi(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function mi(t,e){return void 0!==t?t:e}function gi(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function wi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function bi(t){for(var e in jr(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ei(t,e){if(0!==e.length)throw new oi(ii.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Vi(e.length,"argument")+".")}function Ii(t,e,n){if(e.length!==n)throw new oi(ii.INVALID_ARGUMENT,"Function "+t+"() requires "+Vi(n,"argument")+", but was called with "+Vi(e.length,"argument")+".")}function Ti(t,e,n){if(e.length<n)throw new oi(ii.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Vi(n,"argument")+", but was called with "+Vi(e.length,"argument")+".")}function Ni(t,e,n,r){if(e.length<n||e.length>r)throw new oi(ii.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Vi(e.length,"argument")+".")}function Ai(t,e,n,r){_i(t,e,Mi(n)+" argument",r)}function Si(t,e,n,r){void 0!==r&&Ai(t,e,n,r)}function ki(t,e,n,r){_i(t,e,n+" option",r)}function Di(t,e,n,r){void 0!==r&&ki(t,e,n,r)}function Ri(t,e,n,r,h){void 0!==r&&function(t,e,n,r){for(var i=[],o=0,s=h;o<s.length;o++){var a=s[o];if(a===r)return;i.push(Ci(a))}var u=Ci(r);throw new oi(ii.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+i.join(", "))}(t,0,n,r)}function _i(t,e,n,r){if(!("object"===e?Oi(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Ci(r);throw new oi(ii.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Oi(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Ci(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Fr("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function xi(t,e,n){if(void 0===n)throw new oi(ii.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Mi(e)+" argument, but it was undefined.")}function Li(n,t,r){wi(t,function(t,e){if(r.indexOf(t)<0)throw new oi(ii.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function Pi(t,e,n,r){var i=Ci(r);return new oi(ii.INVALID_ARGUMENT,"Function "+t+"() requires its "+Mi(n)+" argument to be a "+e+", but it was: "+i)}function Ui(t,e,n){if(n<=0)throw new oi(ii.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+Mi(e)+" argument to be a positive number, but it was: "+n+".")}function Mi(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Vi(t,e){return t+" "+e+(1===t?"":"s")}var qi,Fi,ji=(Object.defineProperty(ho.prototype,"latitude",{get:function(){return this.B},enumerable:!0,configurable:!0}),Object.defineProperty(ho.prototype,"longitude",{get:function(){return this.M},enumerable:!0,configurable:!0}),ho.prototype.isEqual=function(t){return this.B===t.B&&this.M===t.M},ho.prototype.q=function(t){return Yr(this.B,t.B)||Yr(this.M,t.M)},ho),Bi=(uo.now=function(){return uo.fromMillis(Date.now())},uo.fromDate=function(t){return uo.fromMillis(t.getTime())},uo.fromMillis=function(t){var e=Math.floor(t/1e3);return new uo(e,1e6*(t-1e3*e))},uo.prototype.toDate=function(){return new Date(this.toMillis())},uo.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},uo.prototype.q=function(t){return this.seconds===t.seconds?Yr(this.nanoseconds,t.nanoseconds):Yr(this.seconds,t.seconds)},uo.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},uo.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},uo),Gi=(ao.G=function(t){var e=Math.floor(t/1e6);return new ao(new Bi(e,t%1e6*1e3))},ao.W=function(t){return new ao(t)},ao.K=function(){return ao.MIN},ao.prototype.h=function(t){return this.timestamp.q(t.timestamp)},ao.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},ao.prototype.H=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},ao.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},ao.prototype.J=function(){return this.timestamp},ao.MIN=new ao(new Bi(0,0)),ao),Yi=(Object.defineProperty(so.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),so.prototype.isEqual=function(t){return 0===so.Y(this,t)},so.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof so?t.forEach(function(t){e.push(t)}):e.push(t),this.X(e)},so.prototype.limit=function(){return this.offset+this.length},so.prototype.$=function(t){return t=void 0===t?1:t,jr(this.length>=t,"Can't call popFirst() with less segments"),this.X(this.segments,this.offset+t,this.length-t)},so.prototype.Z=function(){return jr(!this.tt(),"Can't call popLast() on empty path"),this.X(this.segments,this.offset,this.length-1)},so.prototype.nt=function(){return jr(!this.tt(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},so.prototype.it=function(){return this.get(this.length-1)},so.prototype.get=function(t){return jr(t<this.length,"Index out of range"),this.segments[this.offset+t]},so.prototype.tt=function(){return 0===this.length},so.prototype.et=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},so.prototype.rt=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},so.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},so.prototype.ut=function(){return this.segments.slice(this.offset,this.limit())},so.Y=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},so),zi=(t(oo,Fi=Yi),oo.prototype.X=function(t,e,n){return new oo(t,e,n)},oo.prototype.st=function(){return this.ut().join("/")},oo.prototype.toString=function(){return this.st()},oo.ot=function(t){if(0<=t.indexOf("//"))throw new oi(ii.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new oo(t.split("/").filter(function(t){return 0<t.length}))},oo.ht=new oo([]),oo),Wi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Hi=(t(io,qi=Yi),io.prototype.X=function(t,e,n){return new io(t,e,n)},io.ct=function(t){return Wi.test(t)},io.prototype.st=function(){return this.ut().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),io.ct(t)||(t="`"+t+"`"),t}).join(".")},io.prototype.toString=function(){return this.st()},io.prototype.at=function(){return 1===this.length&&"__name__"===this.get(0)},io.ft=function(){return new io(["__name__"])},io.lt=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new oi(ii.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new oi(ii.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[r+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new oi(ii.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new oi(ii.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new io(e)},io.ht=new io([]),io),Qi=(ro.prototype.vt=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},ro.prototype.isEqual=function(t){return null!==t&&0===zi.Y(this.path,t.path)},ro.prototype.toString=function(){return this.path.toString()},ro.Y=function(t,e){return zi.Y(t.path,e.path)},ro.dt=function(t){return t.length%2==0},ro.wt=function(t){return new ro(new zi(t.slice()))},ro.pt=function(t){return new ro(zi.ot(t))},ro.EMPTY=new ro(new zi([])),ro),Zi=(no.prototype.gt=function(t,e){return new no(this.Y,this.root.gt(t,e,this.Y).copy(null,null,Ji.bt,null,null))},no.prototype.remove=function(t){return new no(this.Y,this.root.remove(t,this.Y).copy(null,null,Ji.bt,null,null))},no.prototype.get=function(t){for(var e=this.root;!e.tt();){var n=this.Y(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},no.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.tt();){var r=this.Y(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},no.prototype.tt=function(){return this.root.tt()},Object.defineProperty(no.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),no.prototype.yt=function(){return this.root.yt()},no.prototype._t=function(){return this.root._t()},no.prototype.It=function(t){return this.root.It(t)},no.prototype.forEach=function(n){this.It(function(t,e){return n(t,e),!1})},no.prototype.toString=function(){var n=[];return this.It(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},no.prototype.Tt=function(t){return this.root.Tt(t)},no.prototype.Et=function(){return new Ki(this.root,null,this.Y,!1)},no.prototype.Rt=function(t){return new Ki(this.root,t,this.Y,!1)},no.prototype.At=function(){return new Ki(this.root,null,this.Y,!0)},no.prototype.Dt=function(t){return new Ki(this.root,t,this.Y,!0)},no),Ki=(eo.prototype.Ct=function(){jr(0<this.St.length,"getNext() called on iterator when hasNext() is false.");var t=this.St.pop(),e={key:t.key,value:t.value};if(this.Pt)for(t=t.left;!t.tt();)this.St.push(t),t=t.right;else for(t=t.right;!t.tt();)this.St.push(t),t=t.left;return e},eo.prototype.Vt=function(){return 0<this.St.length},eo.prototype.kt=function(){if(0===this.St.length)return null;var t=this.St[this.St.length-1];return{key:t.key,value:t.value}},eo),Ji=(to.prototype.copy=function(t,e,n,r,i){return new to(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},to.prototype.tt=function(){return!1},to.prototype.It=function(t){return this.left.It(t)||t(this.key,this.value)||this.right.It(t)},to.prototype.Tt=function(t){return this.right.Tt(t)||t(this.key,this.value)||this.left.Tt(t)},to.prototype.min=function(){return this.left.tt()?this:this.left.min()},to.prototype.yt=function(){return this.min().key},to.prototype._t=function(){return this.right.tt()?this.key:this.right._t()},to.prototype.gt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.gt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.gt(t,e,n))).Nt()},to.prototype.Ot=function(){if(this.left.tt())return to.EMPTY;var t=this;return t.left.Ft()||t.left.left.Ft()||(t=t.xt()),(t=t.copy(null,null,null,t.left.Ot(),null)).Nt()},to.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.tt()||r.left.Ft()||r.left.left.Ft()||(r=r.xt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.Ft()&&(r=r.jt()),r.right.tt()||r.right.Ft()||r.right.left.Ft()||(r=r.Ut()),0===e(t,r.key)){if(r.right.tt())return to.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.Ot())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Nt()},to.prototype.Ft=function(){return this.color},to.prototype.Nt=function(){var t=this;return t.right.Ft()&&!t.left.Ft()&&(t=t.Lt()),t.left.Ft()&&t.left.left.Ft()&&(t=t.jt()),t.left.Ft()&&t.right.Ft()&&(t=t.Bt()),t},to.prototype.xt=function(){var t=this.Bt();return t.right.left.Ft()&&(t=(t=(t=t.copy(null,null,null,null,t.right.jt())).Lt()).Bt()),t},to.prototype.Ut=function(){var t=this.Bt();return t.left.left.Ft()&&(t=(t=t.jt()).Bt()),t},to.prototype.Lt=function(){var t=this.copy(null,null,to.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},to.prototype.jt=function(){var t=this.copy(null,null,to.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},to.prototype.Bt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},to.prototype.Mt=function(){var t=this.qt();return Math.pow(2,t)<=this.size+1},to.prototype.qt=function(){if(this.Ft()&&this.left.Ft())throw Fr("Red node has red child("+this.key+","+this.value+")");if(this.right.Ft())throw Fr("Right child of ("+this.key+","+this.value+") is red");var t=this.left.qt();if(t!==this.right.qt())throw Fr("Black depths differ");return t+(this.Ft()?0:1)},to.EMPTY=null,to.RED=!0,to.bt=!1,to),$i=(Object.defineProperty(Xi.prototype,"key",{get:function(){throw Fr("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(Xi.prototype,"value",{get:function(){throw Fr("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(Xi.prototype,"color",{get:function(){throw Fr("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(Xi.prototype,"left",{get:function(){throw Fr("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(Xi.prototype,"right",{get:function(){throw Fr("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),Xi.prototype.copy=function(t,e,n,r,i){return this},Xi.prototype.gt=function(t,e,n){return new Ji(t,e)},Xi.prototype.remove=function(t,e){return this},Xi.prototype.tt=function(){return!0},Xi.prototype.It=function(t){return!1},Xi.prototype.Tt=function(t){return!1},Xi.prototype.yt=function(){return null},Xi.prototype._t=function(){return null},Xi.prototype.Ft=function(){return!1},Xi.prototype.Mt=function(){return!0},Xi.prototype.qt=function(){return 0},Xi);function Xi(){this.size=0}function to(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:to.RED,this.left=null!=r?r:to.EMPTY,this.right=null!=i?i:to.EMPTY,this.size=this.left.size+1+this.right.size}function eo(t,e,n,r){this.Pt=r,this.St=[];for(var i=1;!t.tt();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Pt?t.left:t.right;else{if(0===i){this.St.push(t);break}this.St.push(t),t=this.Pt?t.right:t.left}}function no(t,e){this.Y=t,this.root=e||Ji.EMPTY}function ro(t){this.path=t,jr(ro.dt(t),"Invalid DocumentKey with an odd number of segments: "+t.ut().join("/"))}function io(){return null!==qi&&qi.apply(this,arguments)||this}function oo(){return null!==Fi&&Fi.apply(this,arguments)||this}function so(t,e,n){void 0===e?e=0:e>t.length&&Fr("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Fr("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}function ao(t){this.timestamp=t}function uo(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new oi(ii.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new oi(ii.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new oi(ii.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new oi(ii.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function ho(t,e){if(Ii("GeoPoint",arguments,2),Ai("GeoPoint","number",1,t),Ai("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new oi(ii.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new oi(ii.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.B=t,this.M=e}Ji.EMPTY=new $i;var co=(Io.Qt=function(t){var e=new Io(t.Y);return t.forEach(function(t){e=e.add(t)}),e},Io.prototype.has=function(t){return null!==this.data.get(t)},Io.prototype.first=function(){return this.data.yt()},Io.prototype.last=function(){return this.data._t()},Object.defineProperty(Io.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),Io.prototype.indexOf=function(t){return this.data.indexOf(t)},Io.prototype.forEach=function(n){this.data.It(function(t,e){return n(t),!1})},Io.prototype.Gt=function(t,e){for(var n=this.data.Rt(t[0]);n.Vt();){var r=n.Ct();if(0<=this.Y(r.key,t[1]))return;e(r.key)}},Io.prototype.Wt=function(t,e){var n;for(n=void 0!==e?this.data.Rt(e):this.data.Et();n.Vt();)if(!t(n.Ct().key))return},Io.prototype.zt=function(t){var e=this.data.Rt(t);return e.Vt()?e.Ct().key:null},Io.prototype.Et=function(){return new fo(this.data.Et())},Io.prototype.Rt=function(t){return new fo(this.data.Rt(t))},Io.prototype.add=function(t){return this.copy(this.data.remove(t).gt(t,!0))},Io.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Io.prototype.tt=function(){return this.data.tt()},Io.prototype.Kt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Io.prototype.isEqual=function(t){if(!(t instanceof Io))return!1;if(this.size!==t.size)return!1;for(var e=this.data.Et(),n=t.data.Et();e.Vt();){var r=e.Ct().key,i=n.Ct().key;if(0!==this.Y(r,i))return!1}return!0},Io.prototype.ut=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Io.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Io.prototype.copy=function(t){var e=new Io(this.Y);return e.data=t,e},Io),fo=(Eo.prototype.Ct=function(){return this.Ht.Ct().key},Eo.prototype.Vt=function(){return this.Ht.Vt()},Eo),lo=(bo.prototype.Jt=function(t,e){return new Os(e,t)},bo.prototype.Yt=function(t,e){return e},bo.prototype.Xt=function(t){return null},bo.prototype.isEqual=function(t){return t instanceof bo},bo.instance=new bo,bo),po=(wo.prototype.Jt=function(t,e){return this.apply(t)},wo.prototype.Yt=function(t,e){return this.apply(t)},wo.prototype.apply=function(t){for(var n=To(t),e=function(e){n.find(function(t){return t.isEqual(e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Us(n)},wo.prototype.Xt=function(t){return null},wo.prototype.isEqual=function(t){return t instanceof wo&&zr(t.elements,this.elements)},wo),yo=(go.prototype.Jt=function(t,e){return this.apply(t)},go.prototype.Yt=function(t,e){return this.apply(t)},go.prototype.apply=function(t){for(var n=To(t),e=function(e){n=n.filter(function(t){return!t.isEqual(e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Us(n)},go.prototype.Xt=function(t){return null},go.prototype.isEqual=function(t){return t instanceof go&&zr(t.elements,this.elements)},go),vo=(mo.prototype.Jt=function(t,e){var n=this.Xt(t);if(n instanceof ks&&this.$t instanceof ks){var r=n.Zt+this.$t.Zt;return new ks(r)}return r=n.Zt+this.$t.Zt,new Ds(r)},mo.prototype.Yt=function(t,e){return jr(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},mo.prototype.Xt=function(t){return t instanceof as?t:new ks(0)},mo.prototype.isEqual=function(t){return t instanceof mo&&this.$t.isEqual(t.$t)},mo);function mo(t){this.$t=t}function go(t){this.elements=t}function wo(t){this.elements=t}function bo(){}function Eo(t){this.Ht=t}function Io(t){this.Y=t,this.data=new Zi(this.Y)}function To(t){return t instanceof Us?t.Zt.slice():[]}function No(t,e){this.version=t,this.transformResults=e}var Ao,So,ko=(_o.tn=function(t){return new _o(t)},_o.nn=function(t){var e=new co(Hi.Y);return t.forEach(function(t){return e=e.add(t)}),new _o(e)},_o.prototype.in=function(e){var n=!1;return this.fields.forEach(function(t){t.et(e)&&(n=!0)}),n},_o.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},_o),Do=(Ro.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},Ro);function Ro(t,e){this.field=t,this.transform=e}function _o(t){this.fields=t}(So=Ao=Ao||{})[So.Set=0]="Set",So[So.en=1]="__PRIVATE_Patch",So[So.Transform=2]="Transform",So[So.rn=3]="__PRIVATE_Delete",So[So.Verify=4]="Verify";var Oo,Co,xo,Lo,Po,Uo,Mo,Vo,qo,Fo=(Xo.exists=function(t){return new Xo(void 0,t)},Xo.updateTime=function(t){return new Xo(t)},Object.defineProperty(Xo.prototype,"un",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),Xo.prototype.sn=function(t){return void 0!==this.updateTime?t instanceof Vs&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Vs:(jr(this.un,"Precondition should be empty"),!0)},Xo.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!=e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},Xo.NONE=new Xo,Xo),jo=($o.prototype.on=function(t){null!=t&&jr(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},$o.hn=function(t){return t instanceof Vs?t.version:Gi.MIN},$o),Bo=(t(Jo,qo=jo),Jo.prototype.Yt=function(t,e){this.on(t),jr(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Vs(this.key,n,{hasCommittedMutations:!0},this.value)},Jo.prototype.Jt=function(t,e,n){if(this.on(t),!this.cn.sn(t))return t;var r=jo.hn(t);return new Vs(this.key,r,{an:!0},this.value)},Jo.prototype.fn=function(t){return null},Jo.prototype.isEqual=function(t){return t instanceof Jo&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.cn.isEqual(t.cn)},Jo),Go=(t(Ko,Vo=jo),Ko.prototype.Yt=function(t,e){if(this.on(t),jr(null==e.transformResults,"Transform results received by PatchMutation."),!this.cn.sn(t))return new Fs(this.key,e.version);var n=this.dn(t);return new Vs(this.key,e.version,{hasCommittedMutations:!0},n)},Ko.prototype.Jt=function(t,e,n){if(this.on(t),!this.cn.sn(t))return t;var r=jo.hn(t),i=this.dn(t);return new Vs(this.key,r,{an:!0},i)},Ko.prototype.fn=function(t){return null},Ko.prototype.isEqual=function(t){return t instanceof Ko&&this.key.isEqual(t.key)&&this.ln.isEqual(t.ln)&&this.cn.isEqual(t.cn)},Ko.prototype.dn=function(t){var e;return e=t instanceof Vs?t.data():Ps.EMPTY,this.vn(e)},Ko.prototype.vn=function(n){var r=this;return this.ln.fields.forEach(function(t){if(!t.tt()){var e=r.data.field(t);n=null!==e?n.set(t,e):n.delete(t)}}),n},Ko),Yo=(t(Zo,Mo=jo),Zo.prototype.Yt=function(t,e){if(this.on(t),jr(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.cn.sn(t))return new Fs(this.key,e.version);var n=this.wn(t),r=this.mn(t,e.transformResults),i=e.version,o=this.pn(n.data(),r);return new Vs(this.key,i,{hasCommittedMutations:!0},o)},Zo.prototype.Jt=function(t,e,n){if(this.on(t),!this.cn.sn(t))return t;var r=this.wn(t),i=this.gn(n,t,e),o=this.pn(r.data(),i);return new Vs(this.key,r.version,{an:!0},o)},Zo.prototype.fn=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Vs?t.field(i.field):void 0,s=i.transform.Xt(o||null);null!=s&&(e=null==e?Ps.EMPTY.set(i.field,s):e.set(i.field,s))}return e},Zo.prototype.isEqual=function(t){return t instanceof Zo&&this.key.isEqual(t.key)&&zr(this.fieldTransforms,t.fieldTransforms)&&this.cn.isEqual(t.cn)},Zo.prototype.wn=function(t){return jr(t instanceof Vs,"Unknown MaybeDocument type "+t),jr(t.key.isEqual(this.key),"Can only transform a document with the same key"),t},Zo.prototype.mn=function(t,e){var n=[];jr(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof Vs&&(s=t.field(i.field)),n.push(o.Yt(s,e[r]))}return n},Zo.prototype.gn=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var s=o[i],a=s.transform,u=null;e instanceof Vs&&(u=e.field(s.field)),null===u&&n instanceof Vs&&(u=n.field(s.field)),r.push(a.Jt(u,t))}return r},Zo.prototype.pn=function(t,e){jr(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},Zo),zo=(t(Qo,Uo=jo),Qo.prototype.Yt=function(t,e){return this.on(t),jr(null==e.transformResults,"Transform results received by DeleteMutation."),new qs(this.key,e.version,{hasCommittedMutations:!0})},Qo.prototype.Jt=function(t,e,n){return this.on(t),this.cn.sn(t)?(t&&jr(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new qs(this.key,Gi.K())):t},Qo.prototype.fn=function(t){return null},Qo.prototype.isEqual=function(t){return t instanceof Qo&&this.key.isEqual(t.key)&&this.cn.isEqual(t.cn)},Qo),Wo=(t(Ho,Po=jo),Ho.prototype.Yt=function(t,e){Fr("VerifyMutation should only be used in Transactions.")},Ho.prototype.Jt=function(t,e,n){Fr("VerifyMutation should only be used in Transactions.")},Ho.prototype.fn=function(t){Fr("VerifyMutation should only be used in Transactions.")},Ho.prototype.isEqual=function(t){return t instanceof Ho&&this.key.isEqual(t.key)&&this.cn.isEqual(t.cn)},Ho);function Ho(t,e){var n=Po.call(this)||this;return n.key=t,n.cn=e,n.type=Ao.Verify,n}function Qo(t,e){var n=Uo.call(this)||this;return n.key=t,n.cn=e,n.type=Ao.rn,n}function Zo(t,e){var n=Mo.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=Ao.Transform,n.cn=Fo.exists(!0),n}function Ko(t,e,n,r){var i=Vo.call(this)||this;return i.key=t,i.data=e,i.ln=n,i.cn=r,i.type=Ao.en,i}function Jo(t,e,n){var r=qo.call(this)||this;return r.key=t,r.value=e,r.cn=n,r.type=Ao.Set,r}function $o(){}function Xo(t,e){this.updateTime=t,this.exists=e,jr(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}(Co=Oo=Oo||{})[Co.bn=0]="__PRIVATE_NullValue",Co[Co.yn=1]="__PRIVATE_BooleanValue",Co[Co._n=2]="__PRIVATE_NumberValue",Co[Co.In=3]="__PRIVATE_TimestampValue",Co[Co.Tn=4]="__PRIVATE_StringValue",Co[Co.En=5]="__PRIVATE_BlobValue",Co[Co.Rn=6]="__PRIVATE_RefValue",Co[Co.An=7]="__PRIVATE_GeoPointValue",Co[Co.ArrayValue=8]="ArrayValue",Co[Co.Dn=9]="__PRIVATE_ObjectValue",(Lo=xo=xo||{})[Lo.Pn=0]="__PRIVATE_Default",Lo[Lo.Sn=1]="__PRIVATE_Estimate",Lo[Lo.Cn=2]="__PRIVATE_Previous";var ts,es,ns,rs=(ls.kn=function(t,e){switch(t.serverTimestamps){case"estimate":return new ls(xo.Sn,e);case"previous":return new ls(xo.Cn,e);case"none":case void 0:return new ls(xo.Pn,e);default:return Fr("fromSnapshotOptions() called with invalid options.")}},ls),is=(fs.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},fs.prototype.Nn=function(t){return jr(this.On!==t.On,"Default compareTo should not be used for values of same type."),Yr(this.On,t.On)},fs),os=(t(cs,ns=is),cs.prototype.value=function(t){return null},cs.prototype.isEqual=function(t){return t instanceof cs},cs.prototype.h=function(t){return t instanceof cs?0:this.Nn(t)},cs.prototype.Fn=function(){return 4},cs.xn=new cs,cs),ss=(t(hs,es=is),hs.prototype.value=function(t){return this.Zt},hs.prototype.isEqual=function(t){return t instanceof hs&&this.Zt===t.Zt},hs.prototype.h=function(t){return t instanceof hs?Yr(this,t):this.Nn(t)},hs.prototype.Fn=function(){return 4},hs.of=function(t){return t?hs.jn:hs.Un},hs.jn=new hs(!0),hs.Un=new hs(!1),hs),as=(t(us,ts=is),us.prototype.value=function(t){return this.Zt},us.prototype.h=function(t){return t instanceof us?(e=this.Zt)<(n=t.Zt)?-1:n<e?1:e===n?0:isNaN(e)?isNaN(n)?0:-1:1:this.Nn(t);var e,n},us.prototype.Fn=function(){return 8},us);function us(t){var e=ts.call(this)||this;return e.Zt=t,e.On=Oo._n,e}function hs(t){var e=es.call(this)||this;return e.Zt=t,e.On=Oo.yn,e}function cs(){var t=ns.call(this)||this;return t.On=Oo.bn,t.Zt=null,t}function fs(){}function ls(t,e){this.Vn=t,this.timestampsInSnapshots=e}function ps(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var ds,ys,vs,ms,gs,ws,bs,Es,Is,Ts,Ns,As,Ss,ks=(t(ia,Ss=as),ia.prototype.isEqual=function(t){return t instanceof ia&&ps(this.Zt,t.Zt)},ia),Ds=(t(ra,As=as),ra.prototype.isEqual=function(t){return t instanceof ra&&ps(this.Zt,t.Zt)},ra.Ln=new ra(NaN),ra.POSITIVE_INFINITY=new ra(1/0),ra.NEGATIVE_INFINITY=new ra(-1/0),ra),Rs=(t(na,Ns=is),na.prototype.value=function(t){return this.Zt},na.prototype.isEqual=function(t){return t instanceof na&&this.Zt===t.Zt},na.prototype.h=function(t){return t instanceof na?Yr(this.Zt,t.Zt):this.Nn(t)},na.prototype.Fn=function(){return 2*this.Zt.length},na),_s=(t(ea,Ts=is),ea.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.Zt:this.Zt.toDate()},ea.prototype.isEqual=function(t){return t instanceof ea&&this.Zt.isEqual(t.Zt)},ea.prototype.h=function(t){return t instanceof ea?this.Zt.q(t.Zt):t instanceof Os?-1:this.Nn(t)},ea.prototype.Fn=function(){return 16},ea),Os=(t(ta,Is=is),ta.prototype.value=function(t){return t&&t.Vn===xo.Sn?new _s(this.Bn).value(t):t&&t.Vn===xo.Cn&&this.previousValue?this.previousValue.value(t):null},ta.prototype.isEqual=function(t){return t instanceof ta&&this.Bn.isEqual(t.Bn)},ta.prototype.h=function(t){return t instanceof ta?this.Bn.q(t.Bn):t instanceof _s?1:this.Nn(t)},ta.prototype.toString=function(){return"<ServerTimestamp localTime="+this.Bn.toString()+">"},ta.prototype.Fn=function(){return 16+(this.previousValue?this.previousValue.Fn():0)},ta),Cs=(t(Xs,Es=is),Xs.prototype.value=function(t){return this.Zt},Xs.prototype.isEqual=function(t){return t instanceof Xs&&this.Zt.isEqual(t.Zt)},Xs.prototype.h=function(t){return t instanceof Xs?this.Zt.q(t.Zt):this.Nn(t)},Xs.prototype.Fn=function(){return this.Zt.Mn()},Xs),xs=(t($s,bs=is),$s.prototype.value=function(t){return this.key},$s.prototype.isEqual=function(t){return t instanceof $s&&this.key.isEqual(t.key)&&this.s.isEqual(t.s)},$s.prototype.h=function(t){if(t instanceof $s){var e=this.s.h(t.s);return 0!==e?e:Qi.Y(this.key,t.key)}return this.Nn(t)},$s.prototype.Fn=function(){return this.s.projectId.length+this.s.database.length+this.key.toString().length},$s),Ls=(t(Js,ws=is),Js.prototype.value=function(t){return this.Zt},Js.prototype.isEqual=function(t){return t instanceof Js&&this.Zt.isEqual(t.Zt)},Js.prototype.h=function(t){return t instanceof Js?this.Zt.q(t.Zt):this.Nn(t)},Js.prototype.Fn=function(){return 16},Js),Ps=(t(Ks,gs=is),Ks.prototype.value=function(n){var r={};return this.Zt.It(function(t,e){r[t]=e.value(n)}),r},Ks.prototype.forEach=function(t){this.Zt.It(t)},Ks.prototype.isEqual=function(t){if(t instanceof Ks){for(var e=this.Zt.Et(),n=t.Zt.Et();e.Vt()&&n.Vt();){var r=e.Ct(),i=n.Ct();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.Vt()&&!n.Vt()}return!1},Ks.prototype.h=function(t){if(t instanceof Ks){for(var e=this.Zt.Et(),n=t.Zt.Et();e.Vt()&&n.Vt();){var r=e.Ct(),i=n.Ct(),o=Yr(r.key,i.key)||r.value.h(i.value);if(o)return o}return Yr(e.Vt(),n.Vt())}return this.Nn(t)},Ks.prototype.set=function(t,e){if(jr(!t.tt(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.qn(t.nt(),e);var n=this.child(t.nt());n instanceof Ks||(n=Ks.EMPTY);var r=n.set(t.$(),e);return this.qn(t.nt(),r)},Ks.prototype.delete=function(t){if(jr(!t.tt(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new Ks(this.Zt.remove(t.nt()));var e=this.child(t.nt());if(e instanceof Ks){var n=e.delete(t.$());return new Ks(this.Zt.gt(t.nt(),n))}return this},Ks.prototype.contains=function(t){return null!==this.field(t)},Ks.prototype.field=function(t){jr(!t.tt(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof Ks?e.Zt.get(t):null}),e},Ks.prototype.ln=function(){var i=new co(Hi.Y);return this.Zt.forEach(function(t,e){var n=new Hi([t]);if(e instanceof Ks){var r=e.ln().fields;r.tt()?i=i.add(n):r.forEach(function(t){i=i.add(n.child(t))})}else i=i.add(n)}),ko.tn(i)},Ks.prototype.Fn=function(){var n=0;return this.Zt.It(function(t,e){n+=t.length+e.Fn()}),n},Ks.prototype.toString=function(){return this.Zt.toString()},Ks.prototype.child=function(t){return this.Zt.get(t)||void 0},Ks.prototype.qn=function(t,e){return new Ks(this.Zt.gt(t,e))},Ks.EMPTY=new Ks(new Zi(Yr)),Ks),Us=(t(Zs,ms=is),Zs.prototype.value=function(e){return this.Zt.map(function(t){return t.value(e)})},Zs.prototype.contains=function(t){for(var e=0,n=this.Zt;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},Zs.prototype.forEach=function(t){this.Zt.forEach(t)},Zs.prototype.isEqual=function(t){if(t instanceof Zs){if(this.Zt.length!==t.Zt.length)return!1;for(var e=0;e<this.Zt.length;e++)if(!this.Zt[e].isEqual(t.Zt[e]))return!1;return!0}return!1},Zs.prototype.h=function(t){if(t instanceof Zs){for(var e=Math.min(this.Zt.length,t.Zt.length),n=0;n<e;n++){var r=this.Zt[n].h(t.Zt[n]);if(r)return r}return Yr(this.Zt.length,t.Zt.length)}return this.Nn(t)},Zs.prototype.Fn=function(){return this.Zt.reduce(function(t,e){return t+e.Fn()},0)},Zs.prototype.toString=function(){return"["+this.Zt.map(function(t){return t.toString()}).join(",")+"]"},Zs),Ms=(Qs.Qn=function(t,e){return Qi.Y(t.key,e.key)},Qs),Vs=(t(Hs,vs=Ms),Hs.prototype.field=function(t){if(this.Gn)return this.Gn.field(t);this.Wn||(this.Wn=new Map);var e=t.st(),n=this.Wn.get(e);if(void 0===n){var r=this.zn(t);n=void 0===r?null:this.converter(r),this.Wn.set(e,n)}return n},Hs.prototype.data=function(){var n=this;if(!this.Gn){var r=Ps.EMPTY;wi(this.proto.fields||{},function(t,e){r=r.set(new Hi([t]),n.converter(e))}),this.Gn=r,this.Wn=void 0}return this.Gn},Hs.prototype.value=function(){return this.data().value()},Hs.prototype.isEqual=function(t){return t instanceof Hs&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.an===t.an&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},Hs.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.an+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Hs.prototype,"hasPendingWrites",{get:function(){return this.an||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Hs.prototype.zn=function(t){jr(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.nt()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},Hs.Kn=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.h(i):Fr("Trying to compare documents on fields that don't exist")},Hs),qs=(t(Ws,ys=Ms),Ws.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ws.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Ws.prototype.isEqual=function(t){return t instanceof Ws&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ws),Fs=(t(zs,ds=Ms),zs.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(zs.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),zs.prototype.isEqual=function(t){return t instanceof zs&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},zs),js=Number,Bs=js.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),Gs=js.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Ys=js.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function zs(){return null!==ds&&ds.apply(this,arguments)||this}function Ws(t,e,n){var r=ys.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Hs(t,e,n,r,i,o){var s=vs.call(this,t,e)||this;return s.Gn=r,s.proto=i,s.converter=o,jr(void 0!==s.Gn||void 0!==s.proto&&void 0!==s.converter,"If objectValue is not defined, proto and converter need to be set."),s.an=!!n.an,s.hasCommittedMutations=!!n.hasCommittedMutations,s}function Qs(t,e){this.key=t,this.version=e}function Zs(t){var e=ms.call(this)||this;return e.Zt=t,e.On=Oo.ArrayValue,e}function Ks(t){var e=gs.call(this)||this;return e.Zt=t,e.On=Oo.Dn,e}function Js(t){var e=ws.call(this)||this;return e.Zt=t,e.On=Oo.An,e}function $s(t,e){var n=bs.call(this)||this;return n.s=t,n.key=e,n.On=Oo.Rn,n}function Xs(t){var e=Es.call(this)||this;return e.Zt=t,e.On=Oo.En,e}function ta(t,e){var n=Is.call(this)||this;return n.Bn=t,n.previousValue=e,n.On=Oo.In,n}function ea(t){var e=Ts.call(this)||this;return e.Zt=t,e.On=Oo.In,e}function na(t){var e=Ns.call(this)||this;return e.Zt=t,e.On=Oo.Tn,e}function ra(){return null!==As&&As.apply(this,arguments)||this}function ia(){return null!==Ss&&Ss.apply(this,arguments)||this}function oa(t){return null==t}function sa(t){return Ys(t)&&t<=Gs&&Bs<=t}var aa,ua,ha=(ca.prototype.canonicalId=function(){if(null===this.Hn){var t=this.path.st();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";oa(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.Hn=t}return this.Hn},ca.prototype.toString=function(){var t=this.path.st();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),oa(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},ca.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},ca.prototype.Jn=function(){return Qi.dt(this.path)&&null===this.collectionGroup&&0===this.filters.length},ca);function ca(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Hn=null}(ua=aa=aa||{}).Yn="F",ua.Xn="L";var fa,la,pa,da,ya,va,ma,ga,wa=(Ba.ei=function(t){return new Ba(t)},Object.defineProperty(Ba.prototype,"orderBy",{get:function(){if(null===this.ti){var t=this.ri(),e=this.ui();if(null!==t&&null===e)t.at()?this.ti=[_a]:this.ti=[new Ra(t),_a];else{jr(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.ti=[]),r=0,i=this.$n;r<i.length;r++){var o=i[r];this.ti.push(o),o.field.at()&&(n=!0)}if(!n){var s=0<this.$n.length?this.$n[this.$n.length-1].dir:ka.ASCENDING;this.ti.push(s===ka.ASCENDING?_a:Oa)}}}return this.ti},enumerable:!0,configurable:!0}),Ba.prototype.si=function(t){jr(null==this.ri()||!(t instanceof Ea)||!t.oi()||t.field.isEqual(this.ri()),"Query must only have one inequality field."),jr(!this.Jn(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new Ba(this.path,this.collectionGroup,this.$n.slice(),e,this.limit,this.Zn,this.startAt,this.endAt)},Ba.prototype.hi=function(t){jr(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.$n.concat([t]);return new Ba(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.Zn,this.startAt,this.endAt)},Ba.prototype.ci=function(t){return new Ba(this.path,this.collectionGroup,this.$n.slice(),this.filters.slice(),t,aa.Yn,this.startAt,this.endAt)},Ba.prototype.ai=function(t){return new Ba(this.path,this.collectionGroup,this.$n.slice(),this.filters.slice(),t,aa.Xn,this.startAt,this.endAt)},Ba.prototype.fi=function(t){return new Ba(this.path,this.collectionGroup,this.$n.slice(),this.filters.slice(),this.limit,this.Zn,t,this.endAt)},Ba.prototype.li=function(t){return new Ba(this.path,this.collectionGroup,this.$n.slice(),this.filters.slice(),this.limit,this.Zn,this.startAt,t)},Ba.prototype.di=function(t){return new Ba(t,null,this.$n.slice(),this.filters.slice(),this.limit,this.Zn,this.startAt,this.endAt)},Ba.prototype.vi=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.$n.length||1===this.$n.length&&this.$n[0].field.at())},Ba.prototype.canonicalId=function(){return this.wi().canonicalId()+"|lt:"+this.Zn},Ba.prototype.toString=function(){return"Query(target="+this.wi().toString()+"; limitType="+this.Zn+")"},Ba.prototype.isEqual=function(t){return this.wi().isEqual(t.wi())&&this.Zn===t.Zn},Ba.prototype.mi=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.at()}return jr(n,"orderBy used that doesn't compare on key field"),0},Ba.prototype.matches=function(t){return this.pi(t)&&this.gi(t)&&this.bi(t)&&this.yi(t)},Ba.prototype._i=function(){return!oa(this.limit)&&this.Zn===aa.Yn},Ba.prototype.Ii=function(){return!oa(this.limit)&&this.Zn===aa.Xn},Ba.prototype.ui=function(){return 0<this.$n.length?this.$n[0].field:null},Ba.prototype.ri=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof Ea&&n.oi())return n.field}return null},Ba.prototype.Ti=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof Ea&&0<=t.indexOf(r.op))return r.op}return null},Ba.prototype.Jn=function(){return this.wi().Jn()},Ba.prototype.Ei=function(){return null!==this.collectionGroup},Ba.prototype.wi=function(){if(!this.ni)if(this.Zn===aa.Yn)this.ni=new ha(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i=r.dir===ka.DESCENDING?ka.ASCENDING:ka.DESCENDING;t.push(new Ra(r.field,i))}var o=this.endAt?new Da(this.endAt.position,!this.endAt.before):null,s=this.startAt?new Da(this.startAt.position,!this.startAt.before):null;this.ni=new ha(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.ni},Ba.prototype.pi=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.vt(this.collectionGroup)&&this.path.et(e):Qi.dt(this.path)?this.path.isEqual(e):this.path.rt(e)},Ba.prototype.gi=function(t){for(var e=0,n=this.$n;e<n.length;e++){var r=n[e];if(!r.field.at()&&null===t.field(r.field))return!1}return!0},Ba.prototype.bi=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},Ba.prototype.yi=function(t){return!(this.startAt&&!this.startAt.Ri(this.orderBy,t)||this.endAt&&this.endAt.Ri(this.orderBy,t))},Ba.prototype.ii=function(t){jr(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},Ba),ba=(ja.ot=function(t){switch(t){case"<":return ja.LESS_THAN;case"<=":return ja.LESS_THAN_OR_EQUAL;case"==":return ja.EQUAL;case">=":return ja.GREATER_THAN_OR_EQUAL;case">":return ja.GREATER_THAN;case"array-contains":return ja.ARRAY_CONTAINS;case"in":return ja.IN;case"array-contains-any":return ja.ARRAY_CONTAINS_ANY;default:return Fr("Unknown FieldFilter operator: "+t)}},ja.prototype.toString=function(){return this.name},ja.prototype.isEqual=function(t){return this.name===t.name},ja.LESS_THAN=new ja("<"),ja.LESS_THAN_OR_EQUAL=new ja("<="),ja.EQUAL=new ja("=="),ja.GREATER_THAN=new ja(">"),ja.GREATER_THAN_OR_EQUAL=new ja(">="),ja.ARRAY_CONTAINS=new ja("array-contains"),ja.IN=new ja("in"),ja.ARRAY_CONTAINS_ANY=new ja("array-contains-any"),ja),Ea=(t(Fa,ga=function(){}),Fa.create=function(t,e,n){if(t.at())return e===ba.IN?(jr(n instanceof Us,"Comparing on key with IN, but filter value not an ArrayValue"),jr(n.Zt.every(function(t){return t instanceof xs}),"Comparing on key with IN, but an array value was not a RefValue"),new Ta(t,n)):(jr(n instanceof xs,"Comparing on key, but filter value not a RefValue"),jr(e!==ba.ARRAY_CONTAINS&&e!==ba.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new Ia(t,e,n));if(n.isEqual(os.xn)){if(e!==ba.EQUAL)throw new oi(ii.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Fa(t,e,n)}if(n.isEqual(Ds.Ln)){if(e!==ba.EQUAL)throw new oi(ii.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Fa(t,e,n)}return e===ba.ARRAY_CONTAINS?new Na(t,n):e===ba.IN?(jr(n instanceof Us,"IN filter has invalid value: "+n.toString()),new Aa(t,n)):e===ba.ARRAY_CONTAINS_ANY?(jr(n instanceof Us,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new Sa(t,n)):new Fa(t,e,n)},Fa.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.On===e.On&&this.Ai(e.h(this.value))},Fa.prototype.Ai=function(t){switch(this.op){case ba.LESS_THAN:return t<0;case ba.LESS_THAN_OR_EQUAL:return t<=0;case ba.EQUAL:return 0===t;case ba.GREATER_THAN:return 0<t;case ba.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Fr("Unknown FieldFilter operator: "+this.op)}},Fa.prototype.oi=function(){return 0<=[ba.LESS_THAN,ba.LESS_THAN_OR_EQUAL,ba.GREATER_THAN,ba.GREATER_THAN_OR_EQUAL].indexOf(this.op)},Fa.prototype.canonicalId=function(){return this.field.st()+this.op.toString()+this.value.toString()},Fa.prototype.isEqual=function(t){return t instanceof Fa&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},Fa.prototype.toString=function(){return this.field.st()+" "+this.op+" "+this.value.value()},Fa),Ia=(t(qa,ma=Ea),qa.prototype.matches=function(t){var e=this.value,n=Qi.Y(t.key,e.key);return this.Ai(n)},qa),Ta=(t(Va,va=Ea),Va.prototype.matches=function(e){return this.value.Zt.some(function(t){return e.key.isEqual(t.key)})},Va),Na=(t(Ma,ya=Ea),Ma.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Us&&e.contains(this.value)},Ma),Aa=(t(Ua,da=Ea),Ua.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},Ua),Sa=(t(Pa,pa=Ea),Pa.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Us&&n.Zt.some(function(t){return e.value.contains(t)})},Pa),ka=(La.prototype.toString=function(){return this.name},La.ASCENDING=new La("asc"),La.DESCENDING=new La("desc"),La),Da=(xa.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},xa.prototype.Ri=function(t,e){jr(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.at())jr(o instanceof xs,"Bound has a non-key value where the key path is being used."),n=Qi.Y(o.key,e.key);else{var s=e.field(i.field);jr(null!==s,"Field should exist since document matched the orderBy already."),n=o.h(s)}if(i.dir===ka.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},xa.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},xa),Ra=(Ca.prototype.compare=function(t,e){var n=this.Di?Vs.Qn(t,e):Vs.Kn(this.field,t,e);switch(this.dir){case ka.ASCENDING:return n;case ka.DESCENDING:return-1*n;default:return Fr("Unknown direction: "+this.dir)}},Ca.prototype.canonicalId=function(){return this.field.st()+this.dir.toString()},Ca.prototype.toString=function(){return this.field.st()+" ("+this.dir+")"},Ca.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},Ca),_a=new Ra(Hi.ft(),ka.ASCENDING),Oa=new Ra(Hi.ft(),ka.DESCENDING);function Ca(t,e){this.field=t,void 0===e&&(e=ka.ASCENDING),this.dir=e,this.Di=t.at()}function xa(t,e){this.position=t,this.before=e}function La(t){this.name=t}function Pa(t,e){var n=pa.call(this,t,ba.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}function Ua(t,e){var n=da.call(this,t,ba.IN,e)||this;return n.value=e,n}function Ma(t,e){return ya.call(this,t,ba.ARRAY_CONTAINS,e)||this}function Va(t,e){var n=va.call(this,t,ba.IN,e)||this;return n.value=e,n}function qa(){return null!==ma&&ma.apply(this,arguments)||this}function Fa(t,e,n){var r=ga.call(this)||this;return r.field=t,r.op=e,r.value=n,r}function ja(t){this.name=t}function Ba(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=aa.Yn),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.$n=n,this.filters=r,this.limit=i,this.Zn=o,this.startAt=s,this.endAt=a,this.ti=null,this.ni=null,this.startAt&&this.ii(this.startAt),this.endAt&&this.ii(this.endAt)}(la=fa=fa||{})[la.Pi=0]="__PRIVATE_Listen",la[la.Si=1]="__PRIVATE_ExistenceFilterMismatch",la[la.Ci=2]="__PRIVATE_LimboResolution";var Ga,Ya,za=(Qa.prototype.Ni=function(t){return new Qa(this.target,this.targetId,this.Vi,t,this.ki,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Qa.prototype.Oi=function(t,e){return new Qa(this.target,this.targetId,this.Vi,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Qa.prototype.Fi=function(t){return new Qa(this.target,this.targetId,this.Vi,this.sequenceNumber,this.ki,t,this.resumeToken)},Qa.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.Vi===t.Vi&&this.sequenceNumber===t.sequenceNumber&&this.ki.isEqual(t.ki)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken===t.resumeToken&&this.target.isEqual(t.target)},Qa),Wa=(Ha.prototype.isEqual=function(t){return t&&t.count===this.count},Ha);function Ha(t){this.count=t}function Qa(t,e,n,r,i,o,s){void 0===i&&(i=Gi.MIN),void 0===o&&(o=Gi.MIN),void 0===s&&(s=Yu()),this.target=t,this.targetId=e,this.Vi=n,this.sequenceNumber=r,this.ki=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Za(t){switch(t){case ii.OK:return Fr("Treated status OK as error");case ii.CANCELLED:case ii.UNKNOWN:case ii.DEADLINE_EXCEEDED:case ii.RESOURCE_EXHAUSTED:case ii.INTERNAL:case ii.UNAVAILABLE:case ii.UNAUTHENTICATED:return!1;case ii.INVALID_ARGUMENT:case ii.NOT_FOUND:case ii.ALREADY_EXISTS:case ii.PERMISSION_DENIED:case ii.FAILED_PRECONDITION:case ii.ABORTED:case ii.OUT_OF_RANGE:case ii.UNIMPLEMENTED:case ii.DATA_LOSS:return!0;default:return Fr("Unknown status code: "+t)}}function Ka(t){if(void 0===t)return Vr("GRPC error has no .code"),ii.UNKNOWN;switch(t){case Ga.OK:return ii.OK;case Ga.CANCELLED:return ii.CANCELLED;case Ga.UNKNOWN:return ii.UNKNOWN;case Ga.DEADLINE_EXCEEDED:return ii.DEADLINE_EXCEEDED;case Ga.RESOURCE_EXHAUSTED:return ii.RESOURCE_EXHAUSTED;case Ga.INTERNAL:return ii.INTERNAL;case Ga.UNAVAILABLE:return ii.UNAVAILABLE;case Ga.UNAUTHENTICATED:return ii.UNAUTHENTICATED;case Ga.INVALID_ARGUMENT:return ii.INVALID_ARGUMENT;case Ga.NOT_FOUND:return ii.NOT_FOUND;case Ga.ALREADY_EXISTS:return ii.ALREADY_EXISTS;case Ga.PERMISSION_DENIED:return ii.PERMISSION_DENIED;case Ga.FAILED_PRECONDITION:return ii.FAILED_PRECONDITION;case Ga.ABORTED:return ii.ABORTED;case Ga.OUT_OF_RANGE:return ii.OUT_OF_RANGE;case Ga.UNIMPLEMENTED:return ii.UNIMPLEMENTED;case Ga.DATA_LOSS:return ii.DATA_LOSS;default:return Fr("Unknown status code: "+t)}}(Ya=Ga=Ga||{})[Ya.OK=0]="OK",Ya[Ya.CANCELLED=1]="CANCELLED",Ya[Ya.UNKNOWN=2]="UNKNOWN",Ya[Ya.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ya[Ya.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ya[Ya.NOT_FOUND=5]="NOT_FOUND",Ya[Ya.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ya[Ya.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ya[Ya.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ya[Ya.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ya[Ya.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ya[Ya.ABORTED=10]="ABORTED",Ya[Ya.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ya[Ya.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ya[Ya.INTERNAL=13]="INTERNAL",Ya[Ya.UNAVAILABLE=14]="UNAVAILABLE",Ya[Ya.DATA_LOSS=15]="DATA_LOSS";var Ja=new Zi(Qi.Y);function $a(){return Ja}function Xa(){return $a()}var tu=new Zi(Qi.Y);function eu(){return tu}var nu=new Zi(Qi.Y);function ru(){return nu}var iu=new co(Qi.Y);function ou(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=iu,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var su=new co(Yr);function au(){return su}var uu,hu,cu,fu,lu=(pu.Ui=function(t){return new pu(t.Y)},pu.prototype.has=function(t){return null!=this.xi.get(t)},pu.prototype.get=function(t){return this.xi.get(t)},pu.prototype.first=function(){return this.ji.yt()},pu.prototype.last=function(){return this.ji._t()},pu.prototype.tt=function(){return this.ji.tt()},pu.prototype.indexOf=function(t){var e=this.xi.get(t);return e?this.ji.indexOf(e):-1},Object.defineProperty(pu.prototype,"size",{get:function(){return this.ji.size},enumerable:!0,configurable:!0}),pu.prototype.forEach=function(n){this.ji.It(function(t,e){return n(t),!1})},pu.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.xi.gt(t.key,t),e.ji.gt(t,null))},pu.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.xi.remove(t),this.ji.remove(e)):this},pu.prototype.isEqual=function(t){if(!(t instanceof pu))return!1;if(this.size!==t.size)return!1;for(var e=this.ji.Et(),n=t.ji.Et();e.Vt();){var r=e.Ct().key,i=n.Ct().key;if(!r.isEqual(i))return!1}return!0},pu.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},pu.prototype.copy=function(t,e){var n=new pu;return n.Y=this.Y,n.xi=t,n.ji=e,n},pu);function pu(n){this.Y=n?function(t,e){return n(t,e)||Qi.Y(t.key,e.key)}:function(t,e){return Qi.Y(t.key,e.key)},this.xi=eu(),this.ji=new Zi(this.Y)}(hu=uu=uu||{})[hu.Li=0]="__PRIVATE_Added",hu[hu.Bi=1]="__PRIVATE_Removed",hu[hu.Mi=2]="__PRIVATE_Modified",hu[hu.qi=3]="__PRIVATE_Metadata",(fu=cu=cu||{})[fu.Qi=0]="__PRIVATE_Local",fu[fu.Gi=1]="__PRIVATE_Synced";function du(t,e,n,r){this.he=t,this.removedTargetIds=e,this.key=n,this.ce=r}function yu(t,e){this.targetId=t,this.ae=e}var vu,mu,gu=(Au.prototype.track=function(t){var e=t.doc.key,n=this.Wi.get(e);n?t.type!==uu.Li&&n.type===uu.qi?this.Wi=this.Wi.gt(e,t):t.type===uu.qi&&n.type!==uu.Bi?this.Wi=this.Wi.gt(e,{type:n.type,doc:t.doc}):t.type===uu.Mi&&n.type===uu.Mi?this.Wi=this.Wi.gt(e,{type:uu.Mi,doc:t.doc}):t.type===uu.Mi&&n.type===uu.Li?this.Wi=this.Wi.gt(e,{type:uu.Li,doc:t.doc}):t.type===uu.Bi&&n.type===uu.Li?this.Wi=this.Wi.remove(e):t.type===uu.Bi&&n.type===uu.Mi?this.Wi=this.Wi.gt(e,{type:uu.Bi,doc:n.doc}):t.type===uu.Li&&n.type===uu.Bi?this.Wi=this.Wi.gt(e,{type:uu.Mi,doc:t.doc}):Fr("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.Wi=this.Wi.gt(e,t)},Au.prototype.zi=function(){var n=[];return this.Wi.It(function(t,e){n.push(e)}),n},Au),wu=(Nu.Xi=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:uu.Li,doc:t})}),new Nu(t,e,lu.Ui(e),i,n,r,!0,!1)},Object.defineProperty(Nu.prototype,"hasPendingWrites",{get:function(){return!this.Hi.tt()},enumerable:!0,configurable:!0}),Nu.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Ji===t.Ji&&this.Hi.isEqual(t.Hi)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.Ki.isEqual(t.Ki)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Nu),bu=(Tu.ie=function(t,e){var n,r=((n={})[t]=Eu.ee(t,e),n);return new Tu(Gi.MIN,r,au(),$a(),ou())},Tu),Eu=(Iu.ee=function(t,e){return new Iu(Yu(),e,ou(),ou(),ou())},Iu);function Iu(t,e,n,r,i){this.resumeToken=t,this.re=e,this.ue=n,this.se=r,this.oe=i}function Tu(t,e,n,r,i){this.ki=t,this.$i=e,this.Zi=n,this.te=r,this.ne=i}function Nu(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.Ki=n,this.docChanges=r,this.Hi=i,this.fromCache=o,this.Ji=s,this.Yi=a}function Au(){this.Wi=new Zi(Qi.Y)}(mu=vu=vu||{})[mu.fe=0]="__PRIVATE_NoChange",mu[mu.Li=1]="__PRIVATE_Added",mu[mu.Bi=2]="__PRIVATE_Removed",mu[mu.le=3]="__PRIVATE_Current",mu[mu.de=4]="__PRIVATE_Reset";function Su(t,e,n,r){void 0===n&&(n=Yu()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var ku=(Object.defineProperty(_u.prototype,"re",{get:function(){return this.pe},enumerable:!0,configurable:!0}),Object.defineProperty(_u.prototype,"resumeToken",{get:function(){return this.me},enumerable:!0,configurable:!0}),Object.defineProperty(_u.prototype,"be",{get:function(){return 0!==this.ve},enumerable:!0,configurable:!0}),Object.defineProperty(_u.prototype,"ye",{get:function(){return this.ge},enumerable:!0,configurable:!0}),_u.prototype._e=function(t){0<t.length&&(this.ge=!0,this.me=t)},_u.prototype.Ie=function(){var n=ou(),r=ou(),i=ou();return this.we.forEach(function(t,e){switch(e){case uu.Li:n=n.add(t);break;case uu.Mi:r=r.add(t);break;case uu.Bi:i=i.add(t);break;default:Fr("Encountered invalid change type: "+e)}}),new Eu(this.me,this.pe,n,r,i)},_u.prototype.Te=function(){this.ge=!1,this.we=Cu()},_u.prototype.Ee=function(t,e){this.ge=!0,this.we=this.we.gt(t,e)},_u.prototype.Re=function(t){this.ge=!0,this.we=this.we.remove(t)},_u.prototype.Ae=function(){this.ve+=1},_u.prototype.De=function(){this.ve-=1},_u.prototype.Pe=function(){this.ge=!0,this.pe=!0},_u),Du=(Ru.prototype.Oe=function(t){for(var e=0,n=t.he;e<n.length;e++){var r=n[e];t.ce instanceof Vs?this.Fe(r,t.ce):t.ce instanceof qs&&this.xe(r,t.key,t.ce)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.xe(r,t.key,t.ce)},Ru.prototype.je=function(n){var r=this;this.Ue(n,function(t){var e=r.Le(t);switch(n.state){case vu.fe:r.Be(t)&&e._e(n.resumeToken);break;case vu.Li:e.De(),e.be||e.Te(),e._e(n.resumeToken);break;case vu.Bi:e.De(),e.be||r.removeTarget(t),jr(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case vu.le:r.Be(t)&&(e.Pe(),e._e(n.resumeToken));break;case vu.de:r.Be(t)&&(r.Me(t),e._e(n.resumeToken));break;default:Fr("Unknown target watch change state: "+n.state)}})},Ru.prototype.Ue=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):gi(this.Ce,e)},Ru.prototype.qe=function(t){var e=t.targetId,n=t.ae.count,r=this.Qe(e);if(r){var i=r.target;if(i.Jn())if(0===n){var o=new Qi(i.path);this.xe(e,o,new qs(o,Gi.K()))}else jr(1===n,"Single document existence filter with count: "+n);else this.Ge(e)!==n&&(this.Me(e),this.Ne=this.Ne.add(e))}},Ru.prototype.We=function(i){var o=this,s={};gi(this.Ce,function(t,e){var n=o.Qe(t);if(n){if(e.re&&n.target.Jn()){var r=new Qi(n.target.path);null!==o.Ve.get(r)||o.ze(t,r)||o.xe(t,r,new qs(r,i))}e.ye&&(s[t]=e.Ie(),e.Te())}});var r=ou();this.ke.forEach(function(t,e){var n=!0;e.Wt(function(t){var e=o.Qe(t);return!e||e.Vi===fa.Ci||(n=!1)}),n&&(r=r.add(t))});var t=new bu(i,s,this.Ne,this.Ve,r);return this.Ve=$a(),this.ke=Ou(),this.Ne=new co(Yr),t},Ru.prototype.Fe=function(t,e){if(this.Be(t)){var n=this.ze(t,e.key)?uu.Mi:uu.Li;this.Le(t).Ee(e.key,n),this.Ve=this.Ve.gt(e.key,e),this.ke=this.ke.gt(e.key,this.Ke(e.key).add(t))}},Ru.prototype.xe=function(t,e,n){if(this.Be(t)){var r=this.Le(t);this.ze(t,e)?r.Ee(e,uu.Bi):r.Re(e),this.ke=this.ke.gt(e,this.Ke(e).delete(t)),n&&(this.Ve=this.Ve.gt(e,n))}},Ru.prototype.removeTarget=function(t){delete this.Ce[t]},Ru.prototype.Ge=function(t){var e=this.Le(t).Ie();return this.Se.He(t).size+e.ue.size-e.oe.size},Ru.prototype.Ae=function(t){this.Le(t).Ae()},Ru.prototype.Le=function(t){return this.Ce[t]||(this.Ce[t]=new ku),this.Ce[t]},Ru.prototype.Ke=function(t){var e=this.ke.get(t);return e||(e=new co(Yr),this.ke=this.ke.gt(t,e)),e},Ru.prototype.Be=function(t){var e=null!==this.Qe(t);return e||Mr("WatchChangeAggregator","Detected inactive target",t),e},Ru.prototype.Qe=function(t){var e=this.Ce[t];return e&&e.be?null:this.Se.Je(t)},Ru.prototype.Me=function(e){var n=this;jr(!this.Ce[e].be,"Should only reset active targets"),this.Ce[e]=new ku,this.Se.He(e).forEach(function(t){n.xe(e,t,null)})},Ru.prototype.ze=function(t,e){return this.Se.He(t).has(e)},Ru);function Ru(t){this.Se=t,this.Ce={},this.Ve=$a(),this.ke=Ou(),this.Ne=new co(Yr)}function _u(){this.ve=0,this.we=Cu(),this.me=Yu(),this.pe=!1,this.ge=!0}function Ou(){return new Zi(Qi.Y)}function Cu(){return new Zi(Qi.Y)}var xu,Lu,Pu=((xu={})[ka.ASCENDING.name]="ASCENDING",xu[ka.DESCENDING.name]="DESCENDING",xu),Uu=((Lu={})[ba.LESS_THAN.name]="LESS_THAN",Lu[ba.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",Lu[ba.GREATER_THAN.name]="GREATER_THAN",Lu[ba.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",Lu[ba.EQUAL.name]="EQUAL",Lu[ba.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",Lu[ba.IN.name]="IN",Lu[ba.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",Lu),Mu=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Vu(t,e){jr(!oa(t),e+" is missing")}function qu(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Fr("can't parse "+t)}var Fu=(Gu.prototype.Ye=function(){return this.options.Xe?"":new Uint8Array(0)},Gu.prototype.$e=function(t){return t},Gu.prototype.Ze=function(t){var e=void 0===t.code?ii.UNKNOWN:Ka(t.code);return new oi(e,t.message||"")},Gu.prototype.tr=function(t){return this.options.Xe||oa(t)?t:{value:t}},Gu.prototype.nr=function(t){var e;return oa(e="object"==typeof t?t.value:t)?null:e},Gu.prototype.J=function(t){return this.options.Xe?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},Gu.prototype.W=function(t){if("string"==typeof t)return this.ir(t);jr(!!t,"Cannot deserialize null or undefined timestamp.");var e=qu(t.seconds||"0"),n=t.nanos||0;return new Bi(e,n)},Gu.prototype.ir=function(t){var e=0,n=Mu.exec(t);if(jr(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new Bi(o,e)},Gu.prototype.er=function(t){return this.options.Xe?t.toBase64():this.$e(t.toUint8Array())},Gu.prototype.rr=function(t){return"string"==typeof t?(jr(this.options.Xe,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Ju.fromBase64String(t)):(jr(!this.options.Xe,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Ju.fromUint8Array(t))},Gu.prototype.toVersion=function(t){return this.J(t.J())},Gu.prototype.fromVersion=function(t){return jr(!!t,"Trying to deserialize version that isn't set"),Gi.W(this.W(t))},Gu.prototype.ur=function(t,e){return this.sr(t).child("documents").child(e).st()},Gu.prototype.or=function(t){var e=zi.ot(t);return jr(this.hr(e),"Tried to deserialize invalid key "+e.toString()),e},Gu.prototype.cr=function(t){return this.ur(this.s,t.path)},Gu.prototype.ar=function(t){var e=this.or(t);return jr(e.get(1)===this.s.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.s.projectId),jr(!e.get(3)&&!this.s.database||e.get(3)===this.s.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.s.database),new Qi(this.lr(e))},Gu.prototype.dr=function(t){return this.ur(this.s,t)},Gu.prototype.vr=function(t){var e=this.or(t);return 4===e.length?zi.ht:this.lr(e)},Object.defineProperty(Gu.prototype,"wr",{get:function(){return new zi(["projects",this.s.projectId,"databases",this.s.database]).st()},enumerable:!0,configurable:!0}),Gu.prototype.sr=function(t){return new zi(["projects",t.projectId,"databases",t.database])},Gu.prototype.lr=function(t){return jr(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.$(5)},Gu.prototype.hr=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},Gu.prototype.mr=function(t){if(t instanceof os)return{nullValue:"NULL_VALUE"};if(t instanceof ss)return{booleanValue:t.value()};if(t instanceof ks)return{integerValue:""+t.value()};if(t instanceof Ds){var e=t.value();if(this.options.Xe){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof Rs?{stringValue:t.value()}:t instanceof Ps?{mapValue:this.pr(t)}:t instanceof Us?{arrayValue:this.gr(t)}:t instanceof _s?{timestampValue:this.J(t.Zt)}:t instanceof Ls?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Cs?{bytesValue:this.er(t.value())}:t instanceof xs?{referenceValue:this.ur(t.s,t.key.path)}:Fr("Unknown FieldValue "+JSON.stringify(t))},Gu.prototype.br=function(t){var e=this;if("nullValue"in t)return os.xn;if("booleanValue"in t)return ss.of(t.booleanValue);if("integerValue"in t)return new ks(qu(t.integerValue));if("doubleValue"in t){if(this.options.Xe){if("NaN"===t.doubleValue)return Ds.Ln;if("Infinity"===t.doubleValue)return Ds.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return Ds.NEGATIVE_INFINITY}return new Ds(t.doubleValue)}if("stringValue"in t)return new Rs(t.stringValue);if("mapValue"in t)return this.yr(t.mapValue.fields||{});if("arrayValue"in t){Vu(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Us(n.map(function(t){return e.br(t)}))}if("timestampValue"in t)return Vu(t.timestampValue,"timestampValue"),new _s(this.W(t.timestampValue));if("geoPointValue"in t){Vu(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new Ls(new ji(r,i))}if("bytesValue"in t){Vu(t.bytesValue,"bytesValue");var o=this.rr(t.bytesValue);return new Cs(o)}if("referenceValue"in t){Vu(t.referenceValue,"referenceValue");var s=this.or(t.referenceValue),a=new Xr(s.get(1),s.get(3)),u=new Qi(this.lr(s));return new xs(a,u)}return Fr("Unknown Value proto "+JSON.stringify(t))},Gu.prototype._r=function(t,e){return{name:this.cr(t),fields:this.Ir(e)}},Gu.prototype.Tr=function(t){return jr(!t.an,"Can't serialize documents with mutations."),{name:this.cr(t.key),fields:this.Ir(t.data()),updateTime:this.J(t.version.J())}},Gu.prototype.Er=function(t,e){var n=this,r=this.ar(t.name),i=this.fromVersion(t.updateTime);return new Vs(r,i,{hasCommittedMutations:!!e},void 0,t,function(t){return n.br(t)})},Gu.prototype.Ir=function(t){var n=this,r={};return t.forEach(function(t,e){r[t]=n.mr(e)}),r},Gu.prototype.yr=function(t){var n=this,e=t,r=Ps.EMPTY;return wi(e,function(t,e){r=r.set(new Hi([t]),n.br(e))}),r},Gu.prototype.pr=function(t){return{fields:this.Ir(t)}},Gu.prototype.gr=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.mr(t))}),{values:n}},Gu.prototype.Rr=function(t){var e=this;jr(!!t.found,"Tried to deserialize a found document from a missing document."),Vu(t.found.name,"doc.found.name"),Vu(t.found.updateTime,"doc.found.updateTime");var n=this.ar(t.found.name),r=this.fromVersion(t.found.updateTime);return new Vs(n,r,{},void 0,t.found,function(t){return e.br(t)})},Gu.prototype.Ar=function(t){jr(!!t.missing,"Tried to deserialize a missing document from a found document."),jr(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.ar(t.missing),n=this.fromVersion(t.readTime);return new qs(e,n)},Gu.prototype.Dr=function(t){return"found"in t?this.Rr(t):"missing"in t?this.Ar(t):Fr("invalid batch get response: "+JSON.stringify(t))},Gu.prototype.Pr=function(t){switch(t){case vu.Li:return"ADD";case vu.le:return"CURRENT";case vu.fe:return"NO_CHANGE";case vu.Bi:return"REMOVE";case vu.de:return"RESET";default:return Fr("Unknown WatchTargetChangeState: "+t)}},Gu.prototype.Sr=function(t){if(t instanceof yu)return{filter:{count:t.ae.count,targetId:t.targetId}};if(t instanceof du){if(t.ce instanceof Vs){var e=t.ce;return{documentChange:{document:{name:this.cr(e.key),fields:this.Ir(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.he,removedTargetIds:t.removedTargetIds}}}if(t.ce instanceof qs)return e=t.ce,{documentDelete:{document:this.cr(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.ce)return{documentRemove:{document:this.cr(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof Su){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return Ga.OK;switch(t){case ii.OK:return Ga.OK;case ii.CANCELLED:return Ga.CANCELLED;case ii.UNKNOWN:return Ga.UNKNOWN;case ii.DEADLINE_EXCEEDED:return Ga.DEADLINE_EXCEEDED;case ii.RESOURCE_EXHAUSTED:return Ga.RESOURCE_EXHAUSTED;case ii.INTERNAL:return Ga.INTERNAL;case ii.UNAVAILABLE:return Ga.UNAVAILABLE;case ii.UNAUTHENTICATED:return Ga.UNAUTHENTICATED;case ii.INVALID_ARGUMENT:return Ga.INVALID_ARGUMENT;case ii.NOT_FOUND:return Ga.NOT_FOUND;case ii.ALREADY_EXISTS:return Ga.ALREADY_EXISTS;case ii.PERMISSION_DENIED:return Ga.PERMISSION_DENIED;case ii.FAILED_PRECONDITION:return Ga.FAILED_PRECONDITION;case ii.ABORTED:return Ga.ABORTED;case ii.OUT_OF_RANGE:return Ga.OUT_OF_RANGE;case ii.UNIMPLEMENTED:return Ga.UNIMPLEMENTED;case ii.DATA_LOSS:return Ga.DATA_LOSS;default:return Fr("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.Pr(t.state),targetIds:t.targetIds,resumeToken:this.$e(t.resumeToken),cause:n}}}return Fr("Unrecognized watch change: "+JSON.stringify(t))},Gu.prototype.Cr=function(t){var e,n=this;if("targetChange"in t){Vu(t.targetChange,"targetChange");var r=this.Vr(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.Ye(),s=t.targetChange.cause,a=s&&this.Ze(s);e=new Su(r,i,o,a||null)}else if("documentChange"in t){Vu(t.documentChange,"documentChange");var u=t.documentChange;Vu(u.document,"documentChange.name"),Vu(u.document.name,"documentChange.document.name"),Vu(u.document.updateTime,"documentChange.document.updateTime");var h=this.ar(u.document.name),c=this.fromVersion(u.document.updateTime),f=new Vs(h,c,{},void 0,u.document,function(t){return n.br(t)}),l=u.targetIds||[],p=u.removedTargetIds||[];e=new du(l,p,f.key,f)}else if("documentDelete"in t){Vu(t.documentDelete,"documentDelete");var d=t.documentDelete;Vu(d.document,"documentDelete.document"),h=this.ar(d.document),c=d.readTime?this.fromVersion(d.readTime):Gi.K(),f=new qs(h,c),p=d.removedTargetIds||[],e=new du([],p,f.key,f)}else if("documentRemove"in t){Vu(t.documentRemove,"documentRemove");var y=t.documentRemove;Vu(y.document,"documentRemove"),h=this.ar(y.document),p=y.removedTargetIds||[],e=new du([],p,h,null)}else{if(!("filter"in t))return Fr("Unknown change type "+JSON.stringify(t));Vu(t.filter,"filter");var v=t.filter;Vu(v.targetId,"filter.targetId");var m=v.count||0,g=new Wa(m),w=v.targetId;e=new yu(w,g)}return e},Gu.prototype.Vr=function(t){return"NO_CHANGE"===t?vu.fe:"ADD"===t?vu.Li:"REMOVE"===t?vu.Bi:"CURRENT"===t?vu.le:"RESET"===t?vu.de:Fr("Got unexpected TargetChange.state: "+t)},Gu.prototype.kr=function(t){if(!("targetChange"in t))return Gi.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Gi.MIN:e.readTime?this.fromVersion(e.readTime):Gi.MIN},Gu.prototype.Nr=function(t){var e,n=this;if(t instanceof Bo)e={update:this._r(t.key,t.value)};else if(t instanceof zo)e={delete:this.cr(t.key)};else if(t instanceof Go)e={update:this._r(t.key,t.data),updateMask:this.Or(t.ln)};else if(t instanceof Yo)e={transform:{document:this.cr(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.Fr(t)})}};else{if(!(t instanceof Wo))return Fr("Unknown mutation type "+t.type);e={verify:this.cr(t.key)}}return t.cn.un||(e.currentDocument=this.xr(t.cn)),e},Gu.prototype.jr=function(t){var e=this,n=t.currentDocument?this.Ur(t.currentDocument):Fo.NONE;if(t.update){Vu(t.update.name,"name");var r=this.ar(t.update.name),i=this.yr(t.update.fields||{});if(t.updateMask){var o=this.Lr(t.updateMask);return new Go(r,i,o,n)}return new Bo(r,i,n)}if(t.delete)return r=this.ar(t.delete),new zo(r,n);if(t.transform){r=this.ar(t.transform.document);var s=t.transform.fieldTransforms.map(function(t){return e.Br(t)});return jr(!0===n.exists,'Transforms only support precondition "exists == true"'),new Yo(r,s)}return t.verify?(r=this.ar(t.verify),new Wo(r,n)):Fr("unknown mutation proto: "+JSON.stringify(t))},Gu.prototype.xr=function(t){return jr(!t.un,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Fr("Unknown precondition")},Gu.prototype.Ur=function(t){return void 0!==t.updateTime?Fo.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Fo.exists(t.exists):Fo.NONE},Gu.prototype.Mr=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);r.isEqual(Gi.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.br(t)})),new No(r,i)},Gu.prototype.qr=function(t,e){var n=this;return t&&0<t.length?(jr(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.Mr(t,e)})):[]},Gu.prototype.Fr=function(t){var e=this,n=t.transform;if(n instanceof lo)return{fieldPath:t.field.st(),setToServerValue:"REQUEST_TIME"};if(n instanceof po)return{fieldPath:t.field.st(),appendMissingElements:{values:n.elements.map(function(t){return e.mr(t)})}};if(n instanceof yo)return{fieldPath:t.field.st(),removeAllFromArray:{values:n.elements.map(function(t){return e.mr(t)})}};if(n instanceof vo)return{fieldPath:t.field.st(),increment:this.mr(n.$t)};throw Fr("Unknown transform: "+t.transform)},Gu.prototype.Br=function(t){var e=this,n=null;if("setToServerValue"in t)jr("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=lo.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new po(r.map(function(t){return e.br(t)}))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new yo(r.map(function(t){return e.br(t)}));else if("increment"in t){var i=this.br(t.increment);jr(i instanceof as,"NUMERIC_ADD transform requires a NumberValue"),n=new vo(i)}else Fr("Unknown transform proto: "+JSON.stringify(t));var o=Hi.lt(t.fieldPath);return new Do(o,n)},Gu.prototype.Qr=function(t){return{documents:[this.dr(t.path)]}},Gu.prototype.Gr=function(t){var e=t.documents.length;jr(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return wa.ei(this.vr(n)).wi()},Gu.prototype.Wr=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(jr(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.dr(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(jr(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.dr(n.Z()),e.structuredQuery.from=[{collectionId:n.it()}]);var r=this.zr(t.filters);r&&(e.structuredQuery.where=r);var i=this.Kr(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.tr(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.Hr(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.Hr(t.endAt)),e},Gu.prototype.Jr=function(t){var e=this.vr(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){jr(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=this.Yr(n.where));var a=[];n.orderBy&&(a=this.Xr(n.orderBy));var u=null;n.limit&&(u=this.nr(n.limit));var h=null;n.startAt&&(h=this.$r(n.startAt));var c=null;return n.endAt&&(c=this.$r(n.endAt)),new wa(e,i,a,s,u,aa.Yn,h,c).wi()},Gu.prototype.Zr=function(t){var e=this.tu(t.Vi);return null==e?null:{"goog-listen-tags":e}},Gu.prototype.tu=function(t){switch(t){case fa.Pi:return null;case fa.Si:return"existence-filter-mismatch";case fa.Ci:return"limbo-document";default:return Fr("Unrecognized query purpose: "+t)}},Gu.prototype.wi=function(t){var e,n=t.target;return(e=n.Jn()?{documents:this.Qr(n)}:{query:this.Wr(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.$e(t.resumeToken)),e},Gu.prototype.zr=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof Ea?e.nu(t):Fr("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},Gu.prototype.Yr=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.iu(t)]:void 0!==t.fieldFilter?[this.eu(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.Yr(t)}).reduce(function(t,e){return t.concat(e)}):Fr("Unknown filter: "+JSON.stringify(t)):[]},Gu.prototype.Kr=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.ru(t)})},Gu.prototype.Xr=function(t){var e=this;return t.map(function(t){return e.uu(t)})},Gu.prototype.Hr=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.mr(t)})}},Gu.prototype.$r=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.br(t)});return new Da(r,n)},Gu.prototype.su=function(t){return Pu[t.name]},Gu.prototype.ou=function(t){switch(t){case"ASCENDING":return ka.ASCENDING;case"DESCENDING":return ka.DESCENDING;default:return}},Gu.prototype.hu=function(t){return Uu[t.name]},Gu.prototype.cu=function(t){switch(t){case"EQUAL":return ba.EQUAL;case"GREATER_THAN":return ba.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return ba.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return ba.LESS_THAN;case"LESS_THAN_OR_EQUAL":return ba.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return ba.ARRAY_CONTAINS;case"IN":return ba.IN;case"ARRAY_CONTAINS_ANY":return ba.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Fr("Unspecified operator");default:return Fr("Unknown operator")}},Gu.prototype.au=function(t){return{fieldPath:t.st()}},Gu.prototype.fu=function(t){return Hi.lt(t.fieldPath)},Gu.prototype.ru=function(t){return{field:this.au(t.field),direction:this.su(t.dir)}},Gu.prototype.uu=function(t){return new Ra(this.fu(t.field),this.ou(t.direction))},Gu.prototype.eu=function(t){return Ea.create(this.fu(t.fieldFilter.field),this.cu(t.fieldFilter.op),this.br(t.fieldFilter.value))},Gu.prototype.nu=function(t){if(t.op===ba.EQUAL){if(t.value.isEqual(Ds.Ln))return{unaryFilter:{field:this.au(t.field),op:"IS_NAN"}};if(t.value.isEqual(os.xn))return{unaryFilter:{field:this.au(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.au(t.field),op:this.hu(t.op),value:this.mr(t.value)}}},Gu.prototype.iu=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fu(t.unaryFilter.field);return Ea.create(e,ba.EQUAL,Ds.Ln);case"IS_NULL":var n=this.fu(t.unaryFilter.field);return Ea.create(n,ba.EQUAL,os.xn);case"OPERATOR_UNSPECIFIED":return Fr("Unspecified filter");default:return Fr("Unknown filter")}},Gu.prototype.Or=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.st())}),{fieldPaths:e}},Gu.prototype.Lr=function(t){var e=(t.fieldPaths||[]).map(function(t){return Hi.lt(t)});return ko.nn(e)},Gu),ju=(Bu.lu=function(t){Bu.platform&&Fr("Platform already defined"),Bu.platform=t},Bu.t=function(){return Bu.platform||Fr("Platform not set"),Bu.platform},Bu);function Bu(){}function Gu(t,e){this.s=t,this.options=e}function Yu(){return ju.t().Ye}function zu(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new oi(ii.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function Wu(){if("undefined"==typeof Uint8Array)throw new oi(ii.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Hu(){if(!ju.t().du)throw new oi(ii.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}function Qu(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var Zu,Ku,Ju=(eh.fromBase64String=function(t){Ii("Blob.fromBase64String",arguments,1),Ai("Blob.fromBase64String","string",1,t),Hu();try{return new eh(ju.t().atob(t))}catch(t){throw new oi(ii.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},eh.fromUint8Array=function(t){if(Ii("Blob.fromUint8Array",arguments,1),Wu(),!(t instanceof Uint8Array))throw Pi("Blob.fromUint8Array","Uint8Array",1,t);return new eh(Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join(""))},eh.prototype.toBase64=function(){return Ii("Blob.toBase64",arguments,0),Hu(),ju.t().btoa(this.vu)},eh.prototype.toUint8Array=function(){Ii("Blob.toUint8Array",arguments,0),Wu();for(var t=new Uint8Array(this.vu.length),e=0;e<this.vu.length;e++)t[e]=this.vu.charCodeAt(e);return t},eh.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},eh.prototype.isEqual=function(t){return this.vu===t.vu},eh.prototype.Mn=function(){return 2*this.vu.length},eh.prototype.q=function(t){return Yr(this.vu,t.vu)},eh),$u=zu(Ju,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Xu=(th.prototype.mu=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},th.prototype.next=function(){var t=++this.previousValue;return this.pu&&this.pu(t),t},th.bu=-1,th);function th(t,e){var n=this;this.previousValue=t,e&&(e.wu=function(t){return n.mu(t)},this.pu=function(t){return e.gu(t)})}function eh(t){Hu(),this.vu=t}(Ku=Zu=Zu||{}).yu="all",Ku._u="listen_stream_idle",Ku.Iu="listen_stream_connection_backoff",Ku.Tu="write_stream_idle",Ku.Eu="write_stream_connection_backoff",Ku.Ru="online_state_timeout",Ku.Au="client_metadata_refresh",Ku.Du="lru_garbage_collection",Ku.Pu="retry_transaction";var nh=(hh.Ou=function(t,e,n,r,i){var o=new hh(t,e,Date.now()+n,r,i);return o.start(n),o},hh.prototype.start=function(t){var e=this;this.Fu=setTimeout(function(){return e.xu()},t)},hh.prototype.ju=function(){return this.xu()},hh.prototype.cancel=function(t){null!==this.Fu&&(this.clearTimeout(),this.Nu.reject(new oi(ii.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},hh.prototype.xu=function(){var e=this;this.Su.Uu(function(){return null!==e.Fu?(e.clearTimeout(),e.op().then(function(t){return e.Nu.resolve(t)})):Promise.resolve()})},hh.prototype.clearTimeout=function(){null!==this.Fu&&(this.ku(this),clearTimeout(this.Fu),this.Fu=null)},hh),rh=(Object.defineProperty(uh.prototype,"Wu",{get:function(){return this.Bu},enumerable:!0,configurable:!0}),uh.prototype.Uu=function(t){this.enqueue(t)},uh.prototype.zu=function(t){this.Ku(),this.Hu(t)},uh.prototype.Ju=function(t){return this.Ku(),this.Hu(t)},uh.prototype.Yu=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.Ku(),this.Bu?[3,2]:(this.Bu=!0,[4,this.Ju(e)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},uh.prototype.enqueue=function(t){return this.Ku(),this.Bu?new Promise(function(t){}):this.Hu(t)},uh.prototype.Hu=function(t){var n=this,e=this.Lu.then(function(){return n.Qu=!0,t().catch(function(t){n.qu=t,n.Qu=!1;var e=t.stack||t.message||"";throw Vr("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.Qu=!1,t})});return this.Lu=e},uh.prototype.Xu=function(t,e,n){var r=this;this.Ku(),jr(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.Gu.indexOf(t)&&(e=0);var i=nh.Ou(this,t,e,n,function(t){return r.$u(t)});return this.Mu.push(i),i},uh.prototype.Ku=function(){this.qu&&Fr("AsyncQueue is already failed: "+(this.qu.stack||this.qu.message))},uh.prototype.Zu=function(){jr(this.Qu,"verifyOpInProgress() called when no op in progress on this queue.")},uh.prototype.ts=function(){return this.Ju(function(){return Promise.resolve()})},uh.prototype.ns=function(t){for(var e=0,n=this.Mu;e<n.length;e++)if(n[e].Cu===t)return!0;return!1},uh.prototype.es=function(r){var i=this;return this.ts().then(function(){jr(r===Zu.yu||i.ns(r),"Attempted to drain to missing operation "+r),i.Mu.sort(function(t,e){return t.Vu-e.Vu});for(var t=0,e=i.Mu;t<e.length;t++){var n=e[t];if(n.ju(),r!==Zu.yu&&n.Cu===r)break}return i.ts()})},uh.prototype.rs=function(t){this.Gu.push(t)},uh.prototype.$u=function(t){var e=this.Mu.indexOf(t);jr(0<=e,"Delayed operation not found."),this.Mu.splice(e,1)},uh),ih="",oh="",sh="",ah="";function uh(){this.Lu=Promise.resolve(),this.Bu=!1,this.Mu=[],this.qu=null,this.Qu=!1,this.Gu=[]}function hh(t,e,n,r,i){this.Su=t,this.Cu=e,this.Vu=n,this.op=r,this.ku=i,this.Nu=new Qu,this.then=this.Nu.promise.then.bind(this.Nu.promise),this.catch=this.Nu.promise.catch.bind(this.Nu.promise),this.Nu.promise.catch(function(t){})}function ch(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=lh(e)),e=fh(t.get(n),e);return lh(e)}function fh(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=ih+sh;break;case ih:n+=ih+ah;break;default:n+=o}}return n}function lh(t){return t+ih+oh}function ph(t){var e=t.length;if(jr(2<=e,"Invalid path "+t),2===e)return jr(t.charAt(0)===ih&&t.charAt(1)===oh,"Non-empty path "+t+" had length 2"),zi.ht;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf(ih,o);switch((s<0||n<s)&&Fr('Invalid encoded resource path: "'+t+'"'),t.charAt(s+1)){case oh:var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case sh:i+=t.substring(o,s),i+="\0";break;case ah:i+=t.substring(o,s+1);break;default:Fr('Invalid encoded resource path: "'+t+'"')}o=s+2}return new zi(r)}var dh=(Vh.prototype.Yt=function(t,e,n){e&&jr(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.us;jr(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var s=r[i];e=o.Yt(e,s)}}return e},Vh.prototype.Jt=function(t,e){e&&jr(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(a=r[n]).key.isEqual(t)&&(e=a.Jt(e,e,this.Bn));for(var i=e,o=0,s=this.mutations;o<s.length;o++){var a;(a=s[o]).key.isEqual(t)&&(e=a.Jt(e,i,this.Bn))}return e},Vh.prototype.ss=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.Jt(t.key,n.get(t.key));e&&(i=i.gt(t.key,e))}),i},Vh.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},ou())},Vh.prototype.isEqual=function(t){return this.batchId===t.batchId&&zr(this.mutations,t.mutations)&&zr(this.baseMutations,t.baseMutations)},Vh),yh=(Mh.from=function(t,e,n,r){jr(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=ru(),o=t.mutations,s=0;s<o.length;s++)i=i.gt(o[s].key,n[s].version);return new Mh(t,e,n,r,i)},Mh),vh=(Uh.prototype.tt=function(){return this.cs.tt()},Uh.prototype.ls=function(t,e){var n=new mh(t,e);this.cs=this.cs.add(n),this.as=this.as.add(n)},Uh.prototype.ds=function(t,e){var n=this;t.forEach(function(t){return n.ls(t,e)})},Uh.prototype.vs=function(t,e){this.ws(new mh(t,e))},Uh.prototype.ms=function(t,e){var n=this;t.forEach(function(t){return n.vs(t,e)})},Uh.prototype.ps=function(t){var e=this,n=Qi.EMPTY,r=new mh(n,t),i=new mh(n,t+1),o=[];return this.as.Gt([r,i],function(t){e.ws(t),o.push(t.key)}),o},Uh.prototype.gs=function(){var e=this;this.cs.forEach(function(t){return e.ws(t)})},Uh.prototype.ws=function(t){this.cs=this.cs.delete(t),this.as=this.as.delete(t)},Uh.prototype.bs=function(t){var e=Qi.EMPTY,n=new mh(e,t),r=new mh(e,t+1),i=ou();return this.as.Gt([n,r],function(t){i=i.add(t.key)}),i},Uh.prototype.ys=function(t){var e=new mh(t,0),n=this.cs.zt(e);return null!==n&&t.isEqual(n.key)},Uh),mh=(Ph.Qn=function(t,e){return Qi.Y(t.key,e.key)||Yr(t._s,e._s)},Ph.fs=function(t,e){return Yr(t._s,e._s)||Qi.Y(t.key,e.key)},Ph),gh=(Lh.prototype.get=function(t){var e=this.Is(t),n=this.Ts[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(s.isEqual(t))return a}},Lh.prototype.has=function(t){return void 0!==this.get(t)},Lh.prototype.set=function(t,e){var n=this.Is(t),r=this.Ts[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.Ts[n]=[[t,e]]},Lh.prototype.delete=function(t){var e=this.Is(t),n=this.Ts[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.Ts[e]:n.splice(r,1),!0;return!1},Lh.prototype.forEach=function(a){wi(this.Ts,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];a(o,s)}})},Lh.prototype.tt=function(){return bi(this.Ts)},Lh),wh=(xh.prototype.catch=function(t){return this.next(void 0,t)},xh.prototype.next=function(r,i){var o=this;return this.Ds&&Fr("Called next() or catch() twice for PersistencePromise"),this.Ds=!0,this.As?this.error?this.Ps(i,this.error):this.Ss(r,this.result):new xh(function(e,n){o.Es=function(t){o.Ss(r,t).next(e,n)},o.Rs=function(t){o.Ps(i,t).next(e,n)}})},xh.prototype.Cs=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},xh.prototype.Vs=function(t){try{var e=t();return e instanceof xh?e:xh.resolve(e)}catch(t){return xh.reject(t)}},xh.prototype.Ss=function(t,e){return t?this.Vs(function(){return t(e)}):xh.resolve(e)},xh.prototype.Ps=function(t,e){return t?this.Vs(function(){return t(e)}):xh.reject(e)},xh.resolve=function(n){return new xh(function(t,e){t(n)})},xh.reject=function(n){return new xh(function(t,e){e(n)})},xh.ks=function(t){return new xh(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},xh.Ns=function(t){for(var n=xh.resolve(!1),e=function(e){n=n.next(function(t){return t?xh.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},xh.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.ks(i)},xh),bh=(Object.defineProperty(Ch.prototype,"readTime",{get:function(){return jr(void 0!==this.xs,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this.xs},set:function(t){jr(void 0===this.xs||this.xs.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this.xs=t},enumerable:!0,configurable:!0}),Ch.prototype.js=function(t,e){this.Us(),this.readTime=e,this.Os.set(t.key,t)},Ch.prototype.Ls=function(t,e){this.Us(),e&&(this.readTime=e),this.Os.set(t,null)},Ch.prototype.Bs=function(t,e){this.Us();var n=this.Os.get(e);return void 0!==n?wh.resolve(n):this.Ms(t,e)},Ch.prototype.getEntries=function(t,e){return this.qs(t,e)},Ch.prototype.apply=function(t){return this.Us(),this.Fs=!0,this.Qs(t)},Ch.prototype.Us=function(){jr(!this.Fs,"Changes have already been applied.")},Ch),Eh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ih=(Oh.prototype.Ws=function(t){this.Gs.push(t)},Oh.prototype.zs=function(){this.Gs.forEach(function(t){return t()})},Oh),Th=(_h.Hs=function(o,t,s){return jr(_h.Js(),"IndexedDB not supported in current environment."),Mr("SimpleDb","Opening database:",o),new wh(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new _h(e))},i.onblocked=function(){r(new oi(ii.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new oi(ii.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Mr("SimpleDb",'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;s.createOrUpgrade(e,i.transaction,t.oldVersion,Lc).next(function(){Mr("SimpleDb","Database upgrade to version "+Lc+" complete")})}}).Cs()},_h.delete=function(t){return Mr("SimpleDb","Removing database:",t),qh(window.indexedDB.deleteDatabase(t)).Cs()},_h.Js=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(_h.Ys())return!0;if(void 0===window.navigator)return!1;var t=l(),e=_h.Ks(t),n=0<e&&e<10,r=_h.Xs(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},_h.Ys=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.$s)},_h.Zs=function(t,e){return t.store(e)},_h.Ks=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},_h.Xs=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},_h.prototype.to=function(e){this.db.onversionchange=function(t){return e(t)}},_h.prototype.runTransaction=function(r,h,c){return p(this,void 0,void 0,function(){var o,s,a,e,u,n;return y(this,function(t){switch(t.label){case 0:o=r.startsWith("readonly"),s=r.endsWith("idempotent"),a=0,e=function(){var e,n,r,i;return y(this,function(t){switch(t.label){case 0:++a,e=Ah.open(u.db,o?"readonly":"readwrite",h),t.label=1;case 1:return t.trys.push([1,3,,4]),(n=c(e).catch(function(t){return e.abort(t),wh.reject(t)}).Cs()).catch(function(){}),[4,e.no];case 2:return t.sent(),[2,{value:n}];case 3:return r=t.sent(),i=s&&"FirebaseError"!==r.name&&a<3,Mr("SimpleDb","Transaction failed with error: %s. Retrying: %s.",r.message,i),i?[3,4]:[2,{value:Promise.reject(r)}];case 4:return[2]}})},u=this,t.label=1;case 1:return[5,e()];case 2:return"object"==typeof(n=t.sent())?[2,n.value]:[3,1];case 3:return[2]}})})},_h.prototype.close=function(){this.db.close()},_h),Nh=(Object.defineProperty(Rh.prototype,"As",{get:function(){return this.eo},enumerable:!0,configurable:!0}),Object.defineProperty(Rh.prototype,"uo",{get:function(){return this.ro},enumerable:!0,configurable:!0}),Object.defineProperty(Rh.prototype,"cursor",{set:function(t){this.io=t},enumerable:!0,configurable:!0}),Rh.prototype.done=function(){this.eo=!0},Rh.prototype.so=function(t){this.ro=t},Rh.prototype.delete=function(){return qh(this.io.delete())},Rh),Ah=(Dh.open=function(t,e,n){return new Dh(t.transaction(n,e))},Object.defineProperty(Dh.prototype,"no",{get:function(){return this.oo.promise},enumerable:!0,configurable:!0}),Dh.prototype.abort=function(t){t&&this.oo.reject(t),this.aborted||(Mr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Dh.prototype.store=function(t){var e=this.transaction.objectStore(t);return jr(!!e,"Object store not part of transaction: "+t),new Sh(e)},Dh),Sh=(kh.prototype.put=function(t,e){return qh(void 0!==e?(Mr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Mr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},kh.prototype.add=function(t){return Mr("SimpleDb","ADD",this.store.name,t,t),qh(this.store.add(t))},kh.prototype.get=function(e){var n=this;return qh(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Mr("SimpleDb","GET",n.store.name,e,t),t})},kh.prototype.delete=function(t){return Mr("SimpleDb","DELETE",this.store.name,t),qh(this.store.delete(t))},kh.prototype.count=function(){return Mr("SimpleDb","COUNT",this.store.name),qh(this.store.count())},kh.prototype.ho=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.co(n,function(t,e){r.push(e)}).next(function(){return r})},kh.prototype.ao=function(t,e){Mr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.fo=!1;var r=this.cursor(n);return this.co(r,function(t,e,n){return n.delete()})},kh.prototype.lo=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.co(r,e)},kh.prototype.do=function(i){var t=this.cursor({});return new wh(function(n,r){t.onerror=function(t){var e=jh(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},kh.prototype.co=function(t,s){var a=[];return new wh(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new Nh(e),r=s(e.primaryKey,e.value,n);if(r instanceof wh){var i=r.catch(function(t){return n.done(),wh.reject(t)});a.push(i)}n.As?o():null===n.uo?e.continue():e.continue(n.uo)}else o()}}).next(function(){return wh.ks(a)})},kh.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(jr(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},kh.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.fo?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},kh);function kh(t){this.store=t}function Dh(t){var n=this;this.transaction=t,this.aborted=!1,this.oo=new Qu,this.transaction.oncomplete=function(){n.oo.resolve()},this.transaction.onabort=function(){t.error?n.oo.reject(t.error):n.oo.resolve()},this.transaction.onerror=function(t){var e=jh(t.target.error);n.oo.reject(e)}}function Rh(t){this.io=t,this.eo=!1,this.ro=null}function _h(t){this.db=t,12.2===_h.Ks(l())&&Vr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Oh(){this.Gs=[]}function Ch(){this.Os=new gh(function(t){return t.toString()}),this.Fs=!1}function xh(t){var e=this;this.Es=null,this.Rs=null,this.result=void 0,this.error=void 0,this.As=!1,this.Ds=!1,t(function(t){e.As=!0,e.result=t,e.Es&&e.Es(t)},function(t){e.As=!0,e.error=t,e.Rs&&e.Rs(t)})}function Lh(t){this.Is=t,this.Ts={}}function Ph(t,e){this.key=t,this._s=e}function Uh(){this.cs=new co(mh.Qn),this.as=new co(mh.fs)}function Mh(t,e,n,r,i){this.batch=t,this.os=e,this.us=n,this.streamToken=r,this.hs=i}function Vh(t,e,n,r){this.batchId=t,this.Bn=e,this.baseMutations=n,jr(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}function qh(t){return new wh(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=jh(t.target.error);r(e)}})}var Fh=!1;function jh(t){var e=Th.Ks(l());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new oi("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Fh||(Fh=!0,setTimeout(function(){throw r},0)),r}}return t}var Bh=(Gh.po=function(t,e,n,r){return jr(""!==t.uid,"UserID must not be an empty string."),new Gh(t._()?t.uid:"",e,n,r)},Gh.prototype.bo=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Hh(t).lo({index:Gc.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},Gh.prototype.yo=function(e,t,n){return this._o(e).next(function(t){return t.lastStreamToken=Wh(n),Zh(e).put(t)})},Gh.prototype.Io=function(t){return this._o(t).next(function(t){return t.lastStreamToken})},Gh.prototype.To=function(e,n){return this._o(e).next(function(t){return t.lastStreamToken=Wh(n),Zh(e).put(t)})},Gh.prototype.Eo=function(h,c,f,l){var p=this,d=Qh(h),y=Hh(h);return y.add({}).next(function(t){jr("number"==typeof t,"Auto-generated key is not a number");for(var e=new dh(t,c,f,l),n=p.serializer.Ro(p.userId,e),r=[],i=new co(function(t,e){return Yr(t.st(),e.st())}),o=0,s=l;o<s.length;o++){var a=s[o],u=Wc.key(p.userId,a.key.path,t);i=i.add(a.key.path.Z()),r.push(y.put(n)),r.push(d.put(u,Wc.PLACEHOLDER))}return i.forEach(function(t){r.push(p.vo.Ao(h,t))}),h.Ws(function(){p.mo[t]=e.keys()}),wh.ks(r).next(function(){return e})})},Gh.prototype.Do=function(t,e){var n=this;return Hh(t).get(e).next(function(t){return t?(jr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.Po(t)):null})},Gh.prototype.So=function(t,n){var r=this;return this.mo[n]?wh.resolve(this.mo[n]):this.Do(t,n).next(function(t){if(t){var e=t.keys();return r.mo[n]=e}return null})},Gh.prototype.Co=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Hh(t).lo({index:Gc.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(jr(e.batchId>=i,"Should have found mutation after "+i),o=r.serializer.Po(e)),n.done()}).next(function(){return o})},Gh.prototype.Vo=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Hh(t).lo({index:Gc.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},Gh.prototype.ko=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Hh(t).ho(Gc.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.Po(t)})})},Gh.prototype.No=function(a,u){var h=this,t=Wc.prefixForPath(this.userId,u.path),e=IDBKeyRange.lowerBound(t),c=[];return Qh(a).lo({range:e},function(e,t,n){var r=e[0],i=e[1],o=e[2],s=ph(i);if(r===h.userId&&u.path.isEqual(s))return Hh(a).get(o).next(function(t){if(!t)throw Fr("Dangling document-mutation reference found: "+e+" which points to "+o);jr(t.userId===h.userId,"Unexpected user '"+t.userId+"' for mutation batch "+o),c.push(h.serializer.Po(t))});n.done()}).next(function(){return c})},Gh.prototype.Oo=function(r,t){var u=this,h=new co(Yr),i=[];return t.forEach(function(a){var t=Wc.prefixForPath(u.userId,a.path),e=IDBKeyRange.lowerBound(t),n=Qh(r).lo({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=ph(i);r===u.userId&&a.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),wh.ks(i).next(function(){return u.Fo(r,h)})},Gh.prototype.xo=function(t,e){var a=this;jr(!e.Jn(),"Document queries shouldn't go down this path"),jr(!e.Ei(),"CollectionGroup queries should be handled in LocalDocumentsView");var u=e.path,h=u.length+1,n=Wc.prefixForPath(this.userId,u),r=IDBKeyRange.lowerBound(n),c=new co(Yr);return Qh(t).lo({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=ph(i);r===a.userId&&u.et(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return a.Fo(t,c)})},Gh.prototype.Fo=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Hh(t).get(e).next(function(t){if(null===t)throw Fr("Dangling document-mutation reference found, which points to "+e);jr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.Po(t))}))}),wh.ks(i).next(function(){return r})},Gh.prototype.jo=function(e,n){var r=this;return zh(e.Uo,this.userId,n).next(function(t){return e.Ws(function(){r.Lo(n.batchId)}),wh.forEach(t,function(t){return r.wo.Bo(e,t)})})},Gh.prototype.Lo=function(t){delete this.mo[t]},Gh.prototype.Mo=function(n){var o=this;return this.bo(n).next(function(t){if(!t)return wh.resolve();var e=IDBKeyRange.lowerBound(Wc.prefixForUser(o.userId)),i=[];return Qh(n).lo({range:e},function(t,e,n){if(t[0]===o.userId){var r=ph(t[1]);i.push(r)}else n.done()}).next(function(){jr(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.st()}))})})},Gh.prototype.ys=function(t,e){return Yh(t,this.userId,e)},Gh.prototype._o=function(t){var e=this;return Zh(t).get(this.userId).next(function(t){return t||new Bc(e.userId,-1,"")})},Gh);function Gh(t,e,n,r){this.userId=t,this.serializer=e,this.vo=n,this.wo=r,this.mo={}}function Yh(t,o,e){var n=Wc.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),a=!1;return Qh(t).lo({range:r,fo:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(a=!0),n.done()}).next(function(){return a})}function zh(t,e,n){var r=t.store(Gc.store),i=t.store(Wc.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.lo({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){jr(1===a,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=Wc.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return wh.ks(o).next(function(){return h})}function Wh(t){return t instanceof Uint8Array?(jr(Th.Ys(),"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function Hh(t){return Ef.Zs(t,Gc.store)}function Qh(t){return Ef.Zs(t,Wc.store)}function Zh(t){return Ef.Zs(t,Bc.store)}var Kh,Jh;(Jh=Kh=Kh||{})[Jh.qo=0]="__PRIVATE_QueryCache",Jh[Jh.Qo=1]="__PRIVATE_SyncEngine";var $h=(sc.prototype.next=function(){var t=this.zo;return this.zo+=2,t},sc.prototype.after=function(t){return this.Wo(t+2),this.next()},sc.prototype.Wo=function(t){jr((1&t)===this.Go,"Cannot supply target ID from different generator ID"),this.zo=t},sc.Ko=function(){return new sc(Kh.qo,2)},sc.Ho=function(){return new sc(Kh.Qo)},sc),Xh=(oc.prototype.Xo=function(e,n){var r=this;return this.Yo.No(e,n).next(function(t){return r.$o(e,n,t)})},oc.prototype.$o=function(t,r,i){return this.Jo.Bs(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].Jt(r,t);return t})},oc.prototype.Zo=function(t,e,i){var o=Xa();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].Jt(t,e);o=o.gt(t,e)}),o},oc.prototype.th=function(e,t){var n=this;return this.Jo.getEntries(e,t).next(function(t){return n.nh(e,t)})},oc.prototype.nh=function(r,i){var o=this;return this.Yo.Oo(r,i).next(function(t){var e=o.Zo(r,i,t),n=$a();return e.forEach(function(t,e){e=e||new qs(t,Gi.K()),n=n.gt(t,e)}),n})},oc.prototype.ih=function(t,e,n){return e.Jn()?this.eh(t,e.path):e.Ei()?this.rh(t,e,n):this.uh(t,e,n)},oc.prototype.eh=function(t,e){return this.Xo(t,new Qi(e)).next(function(t){var e=eu();return t instanceof Vs&&(e=e.gt(t.key,t)),e})},oc.prototype.rh=function(n,r,i){var o=this;jr(r.path.tt(),"Currently we only support collection group queries at the root.");var s=r.collectionGroup,a=eu();return this.vo.sh(n,s).next(function(t){return wh.forEach(t,function(t){var e=r.di(t.child(s));return o.uh(n,e,i).next(function(t){t.forEach(function(t,e){a=a.gt(t,e)})})}).next(function(){return a})})},oc.prototype.uh=function(e,n,t){var c,f,r=this;return this.Jo.ih(e,n,t).next(function(t){return c=t,r.Yo.xo(e,n)}).next(function(t){return f=t,r.oh(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],a=s.key,u=c.get(a),h=s.Jt(u,u,r.Bn);c=h instanceof Vs?c.gt(a,h):c.remove(a)}})}).next(function(){return c.forEach(function(t,e){n.matches(e)||(c=c.remove(t))}),c})},oc.prototype.oh=function(t,e,n){for(var r=ou(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Go&&null===n.get(u.key)&&(r=r.add(u.key))}var h=n;return this.Jo.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Vs&&(h=h.gt(t,e))}),h})},oc),tc=(ic.fh=function(t,e){for(var n=ou(),r=ou(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case uu.Li:n=n.add(s.doc.key);break;case uu.Bi:r=r.add(s.doc.key)}}return new ic(t,e.fromCache,n,r)},ic),ec="LocalStore",nc=(rc.prototype.start=function(){return this.Dh()},rc.prototype.Ph=function(i){return p(this,void 0,void 0,function(){var e,v,n,r=this;return y(this,function(t){switch(t.label){case 0:return e=this.Yo,v=this.Eh,[4,this.persistence.runTransaction("Handle user change","readonly-idempotent",function(d){var y;return r.Yo.ko(d).next(function(t){return y=t,e=r.persistence.bh(i),v=new Xh(r.yh,e,r.persistence.Rh()),e.ko(d)}).next(function(t){for(var e=[],n=[],r=ou(),i=0,o=y;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var a=0,u=s.mutations;a<u.length;a++){var h=u[a];r=r.add(h.key)}}for(var c=0,f=t;c<f.length;c++){s=f[c],n.push(s.batchId);for(var l=0,p=s.mutations;l<p.length;l++)h=p[l],r=r.add(h.key)}return v.th(d,r).next(function(t){return{Sh:t,Ch:e,Vh:n}})})})];case 1:return n=t.sent(),this.Yo=e,this.Eh=v,this.lh.Ah(this.Eh),[2,n]}})})},rc.prototype.kh=function(a){var u,h=this,c=Bi.now(),t=a.reduce(function(t,e){return t.add(e.key)},ou());return this.persistence.runTransaction("Locally write mutations","readwrite-idempotent",function(s){return h.Eh.th(s,t).next(function(t){u=t;for(var e=[],n=0,r=a;n<r.length;n++){var i=r[n],o=i.fn(u.get(i.key));null!=o&&e.push(new Go(i.key,o,o.ln(),Fo.exists(!0)))}return h.Yo.Eo(s,c,e,a)})}).then(function(t){var e=t.ss(u);return{batchId:t.batchId,Os:e}})},rc.prototype.Nh=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly-idempotent",function(e){return n.Yo.So(e,t).next(function(t){return t?n.Eh.th(e,t):wh.resolve(null)})})},rc.prototype.yo=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary-idempotent",function(t){var e=r.batch.keys(),n=i.yh.Oh({Fh:!0});return i.Yo.yo(t,r.batch,r.streamToken).next(function(){return i.xh(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.Yo.Mo(t)}).next(function(){return i.Eh.th(t,e)})})},rc.prototype.jh=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary-idempotent",function(e){var n;return r.Yo.Do(e,t).next(function(t){return jr(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.Yo.jo(e,t)}).next(function(){return r.Yo.Mo(e)}).next(function(){return r.Eh.th(e,n)})})},rc.prototype.Vo=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly-idempotent",function(t){return e.Yo.Vo(t)})},rc.prototype.Io=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly-idempotent",function(t){return e.Yo.Io(t)})},rc.prototype.To=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary-idempotent",function(t){return n.Yo.To(t,e)})},rc.prototype.Uh=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly-idempotent",function(t){return e.Ih.Uh(t)})},rc.prototype.Lh=function(u){var h=this,c=u.ki,f=this.vh;return this.persistence.runTransaction("Apply remote event","readwrite-primary-idempotent",function(o){var i=h.yh.Oh({Fh:!0});f=h.vh;var s=[];gi(u.$i,function(t,e){var n=f.get(t);if(n){s.push(h.Ih.Bh(o,e.oe,t).next(function(){return h.Ih.Mh(o,e.ue,t)}));var r=e.resumeToken;if(0<r.length){var i=n.Oi(r,c).Ni(o.qh);f=f.gt(t,i),rc.Qh(n,i,e)&&s.push(h.Ih.Gh(o,i))}}});var a=$a(),n=ou();if(u.te.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){u.te.forEach(function(t,e){var n=r.get(t);e instanceof qs&&e.version.isEqual(Gi.MIN)?(i.Ls(t,c),a=a.gt(t,e)):null==n||0<e.version.h(n.version)||0===e.version.h(n.version)&&n.hasPendingWrites?(jr(!Gi.MIN.isEqual(c),"Cannot add a document when the remote version is zero"),i.js(e,c),a=a.gt(t,e)):Mr(ec,"Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),u.ne.has(t)&&s.push(h.persistence.wo.Wh(o,t))})})),!c.isEqual(Gi.MIN)){var t=h.Ih.Uh(o).next(function(t){return jr(0<=c.h(t),"Watch stream reverted to previous snapshot?? "+c+" < "+t),h.Ih.zh(o,o.qh,c)});s.push(t)}return wh.ks(s).next(function(){return i.apply(o)}).next(function(){return h.Eh.nh(o,a)})}).then(function(t){return h.vh=f,t})},rc.Qh=function(t,e,n){return jr(0<e.resumeToken.length,"Attempted to persist target data with no resume token"),0===t.resumeToken.length||e.ki.H()-t.ki.H()>=this.Kh||0<n.ue.size+n.se.size+n.oe.size},rc.prototype.Hh=function(t){for(var n=this,e=0,r=t;e<r.length;e++){var i=r[e],o=i.targetId;if(this.dh.ds(i.hh,o),this.dh.ms(i.ah,o),!i.fromCache){var s=this.vh.get(o);jr(null!==s,"Can't set limbo-free snapshot version for unknown target: "+o);var a=s.ki,u=s.Fi(a);this.vh=this.vh.gt(o,u)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite-idempotent",function(e){return wh.forEach(t,function(t){return wh.forEach(t.ah,function(t){return n.persistence.wo.vs(e,t)})})})},rc.prototype.Jh=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly-idempotent",function(t){return void 0===e&&(e=-1),n.Yo.Co(t,e)})},rc.prototype.Yh=function(e){var n=this;return this.persistence.runTransaction("read document","readonly-idempotent",function(t){return n.Eh.Xo(t,e)})},rc.prototype.Xh=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite-idempotent",function(e){var n;return i.Ih.$h(e,r).next(function(t){return t?(n=t,wh.resolve(n)):i.Ih.Zh(e).next(function(t){return n=new za(r,t,fa.Pi,e.qh),i.Ih.tc(e,n).next(function(){return n})})})}).then(function(t){return null===i.vh.get(t.targetId)&&(i.vh=i.vh.gt(t.targetId,t),i.wh.set(r,t.targetId)),t})},rc.prototype.$h=function(t,e){var n=this.wh.get(e);return void 0!==n?wh.resolve(this.vh.get(n)):this.Ih.$h(t,e)},rc.prototype.nc=function(n,r){var i=this,o=this.vh.get(n);jr(null!==o,"Tried to release nonexistent target: "+n);var t=r?"readwrite-idempotent":"readwrite-primary-idempotent";return this.persistence.runTransaction("Release target",t,function(e){var t=i.dh.ps(n);return r?wh.resolve():wh.forEach(t,function(t){return i.persistence.wo.vs(e,t)}).next(function(){i.persistence.wo.removeTarget(e,o)})}).then(function(){i.vh=i.vh.remove(n),i.wh.delete(o.target)})},rc.prototype.ic=function(t,n){var r=this,i=Gi.MIN,o=ou();return this.persistence.runTransaction("Execute query","readonly-idempotent",function(e){return r.$h(e,t.wi()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.Ih.ec(e,t.targetId).next(function(t){o=t})}).next(function(){return r.lh.ih(e,t,n?i:Gi.MIN,n?o:ou())}).next(function(t){return{documents:t,rc:o}})})},rc.prototype.uc=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly-idempotent",function(t){return n.Ih.ec(t,e)})},rc.prototype.sc=function(){return this.persistence.sc()},rc.prototype.oc=function(t){this.Yo.Lo(t)},rc.prototype.hc=function(t){this.persistence.hc(t)},rc.prototype.xh=function(t,i,o){var e=this,s=i.batch,n=s.keys(),a=wh.resolve();return n.forEach(function(r){a=a.next(function(){return o.Bs(t,r)}).next(function(t){var e=t,n=i.hs.get(r);jr(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.h(n)<0)&&((e=s.Yt(r,e,i))?o.js(e,i.os):jr(!t,"Mutation batch "+s+" applied to document "+t+" resulted in null"))})}),a.next(function(){return e.Yo.jo(t,s)})},rc.prototype.cc=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary-idempotent",function(t){return e.ac(t,n.vh)})},rc.prototype.fc=function(e){var n=this,t=this.vh.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly-idempotent",function(t){return n.Ih.Je(t,e).next(function(t){return t?t.target:null})})},rc.prototype.lc=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly-idempotent",function(t){return r.yh.lc(t,r.mh)}).then(function(t){var e=t.dc,n=t.readTime;return r.mh=n,e})},rc.prototype.Dh=function(){return p(this,void 0,void 0,function(){var e,n=this;return y(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly-idempotent",function(t){return n.yh.vc(t)})];case 1:return e.mh=t.sent(),[2]}})})},rc.Kh=3e8,rc);function rc(t,e,n){this.persistence=t,this.lh=e,this.dh=new vh,this.vh=new Zi(Yr),this.wh=new gh(function(t){return t.canonicalId()}),this.mh=Gi.MIN,jr(t.ph,"LocalStore was passed an unstarted persistence implementation"),this.persistence.wo.gh(this.dh),this.Yo=t.bh(n),this.yh=t._h(),this.Ih=t.Th(),this.Eh=new Xh(this.yh,this.Yo,this.persistence.Rh()),this.lh.Ah(this.Eh)}function ic(t,e,n,r){this.targetId=t,this.fromCache=e,this.hh=n,this.ah=r}function oc(t,e,n){this.Jo=t,this.Yo=e,this.vo=n}function sc(t,e){jr((1&(this.Go=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.Wo(void 0!==e?e:this.Go)}function ac(e){return p(this,void 0,void 0,function(){return y(this,function(t){if(e.code!==ii.FAILED_PRECONDITION||e.message!==Eh)throw e;return Mr(ec,"Unexpectedly lost primary lease"),[2]})})}function uc(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Yr(n,i);return 0===s?Yr(r,o):s}var hc=(wc.prototype.pc=function(){return++this.mc},wc.prototype.gc=function(t){var e=[t,this.pc()];if(this.buffer.size<this.wc)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();uc(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(wc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),wc),cc={bc:!1,yc:0,_c:0,Ic:0},fc=(gc.Ac=function(t){return new gc(t,gc.Dc,gc.Pc)},gc.Sc=-1,gc.Cc=1048576,gc.kc=new gc(gc.Vc=41943040,gc.Dc=10,gc.Pc=1e3),gc.DISABLED=new gc(gc.Sc,0,0),gc),lc=(mc.prototype.start=function(){jr(null===this.xc,"Cannot start an already started LruScheduler"),this.Nc.params.Tc!==fc.Sc&&this.jc()},mc.prototype.stop=function(){this.xc&&(this.xc.cancel(),this.xc=null)},Object.defineProperty(mc.prototype,"ph",{get:function(){return null!==this.xc},enumerable:!0,configurable:!0}),mc.prototype.jc=function(){var t=this;jr(null===this.xc,"Cannot schedule GC while a task is pending");var e=this.Fc?3e5:6e4;Mr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.xc=this.Su.Xu(Zu.Du,e,function(){return t.xc=null,t.Fc=!0,t.Oc.cc(t.Nc).then(function(){return t.jc()}).catch(ac)})},mc),pc=(vc.prototype.Lc=function(t,e){return this.Uc.Bc(t).next(function(t){return Math.floor(e/100*t)})},vc.prototype.Mc=function(t,e){var n=this;if(0===e)return wh.resolve(Xu.bu);var r=new hc(e);return this.Uc.Ue(t,function(t){return r.gc(t.sequenceNumber)}).next(function(){return n.Uc.qc(t,function(t){return r.gc(t)})}).next(function(){return r.maxValue})},vc.prototype.Qc=function(t,e,n){return this.Uc.Qc(t,e,n)},vc.prototype.Gc=function(t,e){return this.Uc.Gc(t,e)},vc.prototype.ac=function(e,n){var r=this;return this.params.Tc===fc.Sc?(Mr("LruGarbageCollector","Garbage collection skipped; disabled"),wh.resolve(cc)):this.Wc(e).next(function(t){return t<r.params.Tc?(Mr("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.Tc),cc):r.zc(e,n)})},vc.prototype.Wc=function(t){return this.Uc.Wc(t)},vc.prototype.zc=function(e,n){var r,i,o,s,a,u,h,c=this,f=Date.now();return this.Lc(e,this.params.Ec).next(function(t){return i=t>c.params.Rc?(Mr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.Rc+" from "+t),c.params.Rc):t,s=Date.now(),c.Mc(e,i)}).next(function(t){return r=t,a=Date.now(),c.Qc(e,r,n)}).next(function(t){return o=t,u=Date.now(),c.Gc(e,r)}).next(function(t){return h=Date.now(),Pr()<=Ar.DEBUG&&Mr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(a-s)+"ms\n\tRemoved "+o+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(h-u)+"ms\nTotal Duration: "+(h-f)+"ms"),wh.resolve({bc:!0,yc:i,_c:o,Ic:t})})},vc),dc=(yc.prototype.Zh=function(e){var n=this;return this.Hc(e).next(function(t){return t.highestTargetId=n.Kc.after(t.highestTargetId),n.Jc(e,t).next(function(){return t.highestTargetId})})},yc.prototype.Uh=function(t){return this.Hc(t).next(function(t){return Gi.W(new Bi(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},yc.prototype.Yc=function(t){return Ic(t.Uo)},yc.prototype.zh=function(e,n,r){var i=this;return this.Hc(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.J()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Jc(e,t)})},yc.prototype.tc=function(e,n){var r=this;return this.Xc(e,n).next(function(){return r.Hc(e).next(function(t){return t.targetCount+=1,r.$c(n,t),r.Jc(e,t)})})},yc.prototype.Gh=function(t,e){return this.Xc(t,e)},yc.prototype.Zc=function(e,t){var n=this;return this.ta(e,t.targetId).next(function(){return bc(e).delete(t.targetId)}).next(function(){return n.Hc(e)}).next(function(t){return jr(0<t.targetCount,"Removing from an empty target cache"),t.targetCount-=1,n.Jc(e,t)})},yc.prototype.Qc=function(r,i,o){var s=this,a=0,u=[];return bc(r).lo(function(t,e){var n=s.serializer.na(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(a++,u.push(s.Zc(r,n)))}).next(function(){return wh.ks(u)}).next(function(){return a})},yc.prototype.Ue=function(t,r){var i=this;return bc(t).lo(function(t,e){var n=i.serializer.na(e);r(n)})},yc.prototype.Hc=function(t){return Ec(t.Uo)},yc.prototype.Jc=function(t,e){return(n=t,Ef.Zs(n,nf.store)).put(nf.key,e);var n},yc.prototype.Xc=function(t,e){return bc(t).put(this.serializer.ia(e))},yc.prototype.$c=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},yc.prototype.ea=function(t){return this.Hc(t).next(function(t){return t.targetCount})},yc.prototype.$h=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),s=null;return bc(t).lo({range:n,index:tf.queryTargetsIndexName},function(t,e,n){var r=o.serializer.na(e);i.isEqual(r.target)&&(s=r,n.done())}).next(function(){return s})},yc.prototype.Mh=function(n,t,r){var i=this,o=[],s=Tc(n);return t.forEach(function(t){var e=ch(t.path);o.push(s.put(new ef(r,e))),o.push(i.wo.ls(n,t))}),wh.ks(o)},yc.prototype.Bh=function(n,t,r){var i=this,o=Tc(n);return wh.forEach(t,function(t){var e=ch(t.path);return wh.ks([o.delete([r,e]),i.wo.vs(n,t)])})},yc.prototype.ta=function(t,e){var n=Tc(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},yc.prototype.ec=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Tc(t),o=ou();return r.lo({range:n,fo:!0},function(t,e,n){var r=ph(t[1]),i=new Qi(r);o=o.add(i)}).next(function(){return o})},yc.prototype.ys=function(t,e){var n=ch(e.path),r=IDBKeyRange.bound([n],[Wr(n)],!1,!0),i=0;return Tc(t).lo({index:ef.documentTargetsIndex,fo:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},yc.prototype.Je=function(t,e){var n=this;return bc(t).get(e).next(function(t){return t?n.serializer.na(t):null})},yc);function yc(t,e){this.wo=t,this.serializer=e,this.Kc=$h.Ko()}function vc(t,e){this.Uc=t,this.params=e}function mc(t,e,n){this.Nc=t,this.Su=e,this.Oc=n,this.Fc=!1,this.xc=null}function gc(t,e,n){this.Tc=t,this.Ec=e,this.Rc=n}function wc(t){this.wc=t,this.buffer=new co(uc),this.mc=0}function bc(t){return Ef.Zs(t,tf.store)}function Ec(t){return Th.Zs(t,nf.store).get(nf.key).next(function(t){return jr(null!==t,"Missing metadata row."),t})}function Ic(t){return Ec(t).next(function(t){return t.highestListenSequenceNumber})}function Tc(t){return Ef.Zs(t,ef.store)}var Nc,Ac=(Sc.prototype.js=function(t,e,n){return Rc(t).put(_c(e),n)},Sc.prototype.Ls=function(t,e){var n=Rc(t),r=_c(e);return n.delete(r)},Sc.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.ra(e,t)})},Sc.prototype.Bs=function(t,e){var n=this;return Rc(t).get(_c(e)).next(function(t){return n.ua(t)})},Sc.prototype.sa=function(t,e){var n=this;return Rc(t).get(_c(e)).next(function(t){var e=n.ua(t);return e?{oa:e,size:Oc(t)}:null})},Sc.prototype.getEntries=function(t,e){var r=this,i=Xa();return this.ha(t,e,function(t,e){var n=r.ua(e);i=i.gt(t,n)}).next(function(){return i})},Sc.prototype.ca=function(t,e){var r=this,i=Xa(),o=new Zi(Qi.Y);return this.ha(t,e,function(t,e){var n=r.ua(e);o=n?(i=i.gt(t,n),o.gt(t,Oc(e))):(i=i.gt(t,null),o.gt(t,0))}).next(function(){return{aa:i,fa:o}})},Sc.prototype.ha=function(t,e,i){if(e.tt())return wh.resolve();var n=IDBKeyRange.bound(e.first().path.ut(),e.last().path.ut()),o=e.Et(),s=o.Ct();return Rc(t).lo({range:n},function(t,e,n){for(var r=Qi.wt(t);s&&Qi.Y(s,r)<0;)i(s,null),s=o.Ct();s&&s.isEqual(r)&&(i(s,e),s=o.Vt()?o.Ct():null),s?n.so(s.path.ut()):n.done()}).next(function(){for(;s;)i(s,null),s=o.Vt()?o.Ct():null})},Sc.prototype.ih=function(t,i,e){var o=this;jr(!i.Ei(),"CollectionGroup queries should be handled in LocalDocumentsView");var s=eu(),a=i.path.length+1,n={};if(e.isEqual(Gi.MIN)){var r=i.path.ut();n.range=IDBKeyRange.lowerBound(r)}else{var u=i.path.ut(),h=this.serializer.la(e);n.range=IDBKeyRange.lowerBound([u,h],!0),n.index=Kc.collectionReadTimeIndex}return Rc(t).lo(n,function(t,e,n){if(t.length===a){var r=o.serializer.da(e);i.path.et(r.key.path)?r instanceof Vs&&i.matches(r)&&(s=s.gt(r.key,r)):n.done()}}).next(function(){return s})},Sc.prototype.lc=function(t,e){var r=this,i=$a(),o=this.serializer.la(e),n=Rc(t),s=IDBKeyRange.lowerBound(o,!0);return n.lo({index:Kc.readTimeIndex,range:s},function(t,e){var n=r.serializer.da(e);i=i.gt(n.key,n),o=e.readTime}).next(function(){return{dc:i,readTime:r.serializer.va(o)}})},Sc.prototype.vc=function(t){var r=this,e=Rc(t),i=Gi.MIN;return e.lo({index:Kc.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(i=r.serializer.va(e.readTime)),n.done()}).next(function(){return i})},Sc.prototype.Oh=function(t){return new Sc.wa(this,!!t&&t.Fh)},Sc.prototype.ma=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Sc.prototype.getMetadata=function(t){return Dc(t).get(Jc.key).next(function(t){return jr(!!t,"Missing document cache metadata"),t})},Sc.prototype.ra=function(t,e){return Dc(t).put(Jc.key,e)},Sc.prototype.ua=function(t){if(t){var e=this.serializer.da(t);return e instanceof qs&&e.version.isEqual(Gi.K())?null:e}return null},Sc.wa=(t(kc,Nc=bh),kc.prototype.Qs=function(s){var a=this,u=[],h=0,c=new co(function(t,e){return Yr(t.st(),e.st())});return this.Os.forEach(function(t,e){var n=a.ga.get(t);if(jr(void 0!==n,"Cannot modify a document that wasn't read (for "+t+")"),e){jr(!a.readTime.isEqual(Gi.MIN),"Cannot add a document with a read time of zero");var r=a.pa.serializer.ba(e,a.readTime);c=c.add(t.path.Z());var i=Oc(r);h+=i-n,u.push(a.pa.js(s,t,r))}else if(h-=n,a.Fh){var o=a.pa.serializer.ba(new qs(t,Gi.K()),a.readTime);u.push(a.pa.js(s,t,o))}else u.push(a.pa.Ls(s,t))}),c.forEach(function(t){u.push(a.pa.vo.Ao(s,t))}),u.push(this.pa.updateMetadata(s,h)),wh.ks(u)},kc.prototype.Ms=function(t,e){var n=this;return this.pa.sa(t,e).next(function(t){return null===t?(n.ga.set(e,0),null):(n.ga.set(e,t.size),t.oa)})},kc.prototype.qs=function(t,e){var n=this;return this.pa.ca(t,e).next(function(t){var e=t.aa;return t.fa.forEach(function(t,e){n.ga.set(t,e)}),e})},kc),Sc);function Sc(t,e){this.serializer=t,this.vo=e}function kc(t,e){var n=Nc.call(this)||this;return n.pa=t,n.Fh=e,n.ga=new gh(function(t){return t.toString()}),n}function Dc(t){return Ef.Zs(t,Jc.store)}function Rc(t){return Ef.Zs(t,Kc.store)}function _c(t){return t.path.ut()}function Oc(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Fr("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var Cc=(Vc.prototype.Ao=function(t,e){return this.ya.add(e),wh.resolve()},Vc.prototype.sh=function(t,e){return wh.resolve(this.ya.getEntries(e))},Vc),xc=(Mc.prototype.add=function(t){jr(t.length%2==1,"Expected a collection path.");var e=t.it(),n=t.Z(),r=this.index[e]||new co(zi.Y),i=!r.has(n);return this.index[e]=r.add(n),i},Mc.prototype.has=function(t){var e=t.it(),n=t.Z(),r=this.index[e];return r&&r.has(n)},Mc.prototype.getEntries=function(t){return(this.index[t]||new co(zi.Y)).ut()},Mc),Lc=9,Pc=(Uc.prototype.createOrUpgrade=function(n,r,t,e){var i=this;jr(t<e&&0<=t&&e<=Lc,"Unexpected schema upgrade from v"+t+" to v{toVersion}.");var o,s=new Ah(r);t<1&&1<=e&&(n.createObjectStore(Fc.store),(o=n).createObjectStore(Bc.store,{keyPath:Bc.keyPath}),o.createObjectStore(Gc.store,{keyPath:Gc.keyPath,autoIncrement:!0}).createIndex(Gc.userMutationsIndex,Gc.userMutationsKeyPath,{unique:!0}),o.createObjectStore(Wc.store),hf(n),n.createObjectStore(Kc.store));var a,u=wh.resolve();return t<3&&3<=e&&(0!==t&&((a=n).deleteObjectStore(ef.store),a.deleteObjectStore(tf.store),a.deleteObjectStore(nf.store),hf(n)),u=u.next(function(){return t=s.store(nf.store),e=new nf(0,0,Gi.MIN.J(),0),t.put(nf.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(u=u.next(function(){return r=n,(i=s).store(Gc.store).ho().next(function(t){r.deleteObjectStore(Gc.store),r.createObjectStore(Gc.store,{keyPath:Gc.keyPath,autoIncrement:!0}).createIndex(Gc.userMutationsIndex,Gc.userMutationsKeyPath,{unique:!0});var e=i.store(Gc.store),n=t.map(function(t){return e.put(t)});return wh.ks(n)});var r,i})),u=u.next(function(){n.createObjectStore(cf.store,{keyPath:cf.keyPath})})),t<5&&5<=e&&(u=u.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(u=u.next(function(){return n.createObjectStore(Jc.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(u=u.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(u=u.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(u=u.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(Kc.store)).createIndex(Kc.readTimeIndex,Kc.readTimeIndexPath,{unique:!1}),t.createIndex(Kc.collectionReadTimeIndex,Kc.collectionReadTimeIndexPath,{unique:!1})})),u},Uc.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Kc.store).lo(function(t,e){n+=Oc(e)}).next(function(){var t=new Jc(n);return e.store(Jc.store).put(Jc.key,t)})},Uc.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(Bc.store),e=r.store(Gc.store);return t.ho().next(function(t){return wh.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.ho(Gc.userMutationsIndex,t).next(function(t){return wh.forEach(t,function(t){jr(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.Po(t);return zh(r,n.userId,e).next(function(){})})})})})},Uc.prototype.ensureSequenceNumbers=function(t){var s=t.store(ef.store),e=t.store(Kc.store);return Ic(t).next(function(i){var o=[];return e.lo(function(t,e){var n=new zi(t),r=[0,ch(n)];o.push(s.get(r).next(function(t){return t?wh.resolve():(e=n,s.put(new ef(0,ch(e),i)));var e}))}).next(function(){return wh.ks(o)})})},Uc.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.it(),n=t.Z();return r.put({collectionId:e,parent:ch(n)})}}t.createObjectStore(rf.store,{keyPath:rf.keyPath});var r=e.store(rf.store),o=new xc;return e.store(Kc.store).lo({fo:!0},function(t,e){var n=new zi(t);return i(n.Z())}).next(function(){return e.store(Wc.store).lo({fo:!0},function(t,e){t[0];var n=t[1],r=(t[2],ph(n));return i(r.Z())})})},Uc);function Uc(t){this.serializer=t}function Mc(){this.index={}}function Vc(){this.ya=new xc}function qc(t,e){this.seconds=t,this.nanoseconds=e}var Fc=(jc.store="owner",jc.key="owner",jc);function jc(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var Bc=(zc.store="mutationQueues",zc.keyPath="userId",zc),Gc=(Yc.store="mutations",Yc.keyPath="batchId",Yc.userMutationsIndex="userMutationsIndex",Yc.userMutationsKeyPath=["userId","batchId"],Yc);function Yc(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}function zc(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var Wc=(Hc.prefixForUser=function(t){return[t]},Hc.prefixForPath=function(t,e){return[t,ch(e)]},Hc.key=function(t,e,n){return[t,ch(e),n]},Hc.store="documentMutations",Hc.PLACEHOLDER=new Hc,Hc);function Hc(){}function Qc(t,e){this.path=t,this.readTime=e}function Zc(t,e){this.path=t,this.version=e}var Kc=(Xc.store="remoteDocuments",Xc.readTimeIndex="readTimeIndex",Xc.readTimeIndexPath="readTime",Xc.collectionReadTimeIndex="collectionReadTimeIndex",Xc.collectionReadTimeIndexPath=["parentPath","readTime"],Xc),Jc=($c.store="remoteDocumentGlobal",$c.key="remoteDocumentGlobalKey",$c);function $c(t){this.byteSize=t}function Xc(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}var tf=(uf.store="targets",uf.keyPath="targetId",uf.queryTargetsIndexName="queryTargetsIndex",uf.queryTargetsKeyPath=["canonicalId","targetId"],uf),ef=(af.store="targetDocuments",af.keyPath=["targetId","path"],af.documentTargetsIndex="documentTargetsIndex",af.documentTargetsKeyPath=["path","targetId"],af),nf=(sf.key="targetGlobalKey",sf.store="targetGlobal",sf),rf=(of.store="collectionParents",of.keyPath=["collectionId","parent"],of);function of(t,e){this.collectionId=t,this.parent=e}function sf(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}function af(t,e,n){this.targetId=t,this.path=e,jr(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}function uf(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}function hf(t){t.createObjectStore(ef.store,{keyPath:ef.keyPath}).createIndex(ef.documentTargetsIndex,ef.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(tf.store,{keyPath:tf.keyPath}).createIndex(tf.queryTargetsIndexName,tf.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(nf.store)}var cf=(ff.store="clientMetadata",ff.keyPath="clientId",ff);function ff(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}var lf=s(s(s([Bc.store,Gc.store,Wc.store,Kc.store,tf.store,Fc.store,nf.store,ef.store],[cf.store]),[Jc.store]),[rf.store]),pf=(df.prototype.Ao=function(t,e){var n=this;if(jr(e.length%2==1,"Expected a collection path."),this._a.has(e))return wh.resolve();var r=e.it(),i=e.Z();t.Ws(function(){n._a.add(e)});var o={collectionId:r,parent:ch(i)};return yf(t).put(o)},df.prototype.sh=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Wr(i),""],!1,!0);return yf(t).ho(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(ph(r.parent))}return o})},df);function df(){this._a=new xc}function yf(t){return Ef.Zs(t,rf.store)}var vf=(mf.prototype.da=function(t){if(t.document)return this.Ia.Er(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Qi.wt(t.noDocument.path),n=this.Ta(t.noDocument.readTime);return new qs(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=Qi.wt(t.unknownDocument.path),n=this.Ta(t.unknownDocument.version),new Fs(e,n)):Fr("Unexpected DbRemoteDocument")},mf.prototype.ba=function(t,e){var n=this.la(e),r=t.key.path.Z().ut();if(t instanceof Vs){var i=t.proto?t.proto:this.Ia.Tr(t),o=t.hasCommittedMutations;return new Kc(null,null,i,o,n,r)}if(t instanceof qs){var s=t.key.path.ut(),a=this.Ea(t.version);return o=t.hasCommittedMutations,new Kc(null,new Qc(s,a),null,o,n,r)}if(t instanceof Fs){s=t.key.path.ut();var u=this.Ea(t.version);return new Kc(new Zc(s,u),null,null,!0,n,r)}return Fr("Unexpected MaybeDocument")},mf.prototype.la=function(t){var e=t.J();return[e.seconds,e.nanoseconds]},mf.prototype.va=function(t){var e=new Bi(t[0],t[1]);return Gi.W(e)},mf.prototype.Ea=function(t){var e=t.J();return new qc(e.seconds,e.nanoseconds)},mf.prototype.Ta=function(t){var e=new Bi(t.seconds,t.nanoseconds);return Gi.W(e)},mf.prototype.Ro=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.Ia.Nr(t)}),i=e.mutations.map(function(t){return n.Ia.Nr(t)});return new Gc(t,e.batchId,e.Bn.toMillis(),r,i)},mf.prototype.Po=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.Ia.jr(t)}),r=t.mutations.map(function(t){return e.Ia.jr(t)}),i=Bi.fromMillis(t.localWriteTimeMs);return new dh(t.batchId,i,n,r)},mf.prototype.Ra=function(t){var e=[];return t.forEach(function(t){e.push(ch(t.path))}),e},mf.prototype.Aa=function(t){for(var e=ou(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new Qi(ph(i)))}return e},mf.prototype.na=function(t){var e,n=this.Ta(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.Ta(t.lastLimboFreeSnapshotVersion):Gi.MIN,i=t.resumeToken;return e=void 0!==t.query.documents?this.Ia.Gr(t.query):this.Ia.Jr(t.query),new za(e,t.targetId,fa.Pi,t.lastListenSequenceNumber,n,r,i)},mf.prototype.ia=function(t){jr(fa.Pi===t.Vi,"Only queries with purpose "+fa.Pi+" may be stored, got "+t.Vi);var e,n,r=this.Ea(t.ki),i=this.Ea(t.lastLimboFreeSnapshotVersion);return e=t.target.Jn()?this.Ia.Qr(t.target):this.Ia.Wr(t.target),n=t.resumeToken instanceof Uint8Array?(jr(Th.Ys(),"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new tf(t.targetId,t.target.canonicalId(),r,n,t.sequenceNumber,i,e)},mf);function mf(t){this.Ia=t}var gf,wf="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",bf=(t(Tf,gf=Ih),Tf),Ef=(If.Zs=function(t,e){if(t instanceof bf)return Th.Zs(t.Uo,e);throw Fr("IndexedDbPersistence must use instances of IndexedDbTransaction")},If.Ua=function(n){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:if(!If.Js())throw new oi(ii.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(e=new If(n.allowTabSynchronization,n.persistenceKey,n.clientId,n.platform,n.La,n.Da,n.serializer,n.Pa)).start()];case 1:return t.sent(),[2,e]}})})},If.prototype.start=function(){var e=this;return jr(!this.ph,"IndexedDbPersistence double-started!"),jr(null!==this.window,"Expected 'window' to be defined"),Th.Hs(this.Fa,Lc,new Pc(this.serializer)).then(function(t){return e.Ba=t,e.Ma()}).then(function(){return e.qa(),e.Qa(),e.Ga(),e.Ba.runTransaction("readonly-idempotent",[nf.store],function(t){return Ic(t)})}).then(function(t){e.Wa=new Xu(t,e.Pa)}).then(function(){e.Sa=!0}).catch(function(t){return e.Ba&&e.Ba.close(),Promise.reject(t)})},If.prototype.za=function(n){var t=this;return this.Oa=function(e){return p(t,void 0,void 0,function(){return y(this,function(t){return this.ph?[2,n(e)]:[2]})})},n(this.isPrimary)},If.prototype.Ka=function(n){var t=this;this.Ba.to(function(e){return p(t,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return null!==e.newVersion?[3,2]:[4,n()];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},If.prototype.hc=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Da.Uu(function(){return p(e,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.ph?[4,this.Ma()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},If.prototype.Ma=function(){var n=this;return this.Ba.runTransaction("readwrite-idempotent",lf,function(e){return Af(e).put(new cf(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.Ha(e).next(function(t){t||(n.isPrimary=!1,n.Da.Uu(function(){return n.Oa(!1)}))})}).next(function(){return n.Ja(e)}).next(function(t){return n.isPrimary&&!t?n.Ya(e).next(function(){return!1}):!!t&&n.Xa(e).next(function(){return!0})})}).catch(function(t){if(!n.allowTabSynchronization)throw t;return Mr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.Da.Uu(function(){return n.Oa(t)}),n.isPrimary=t})},If.prototype.Ha=function(t){var e=this;return Nf(t).get(Fc.key).next(function(t){return wh.resolve(e.$a(t))})},If.prototype.Za=function(t){return Af(t).delete(this.clientId)},If.prototype.tf=function(){return p(this,void 0,void 0,function(){var i=this;return y(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.nf(this.Na,18e5)?[3,2]:(this.Na=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary-idempotent",function(t){var r=If.Zs(t,cf.store);return r.ho().next(function(t){var e=i.if(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return wh.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:t.sent().forEach(function(t){i.window.localStorage.removeItem(i.ef(t.clientId))}),t.label=2;case 2:return[2]}})})},If.prototype.Ga=function(){var t=this;this.ka=this.Da.Xu(Zu.Au,4e3,function(){return t.Ma().then(function(){return t.tf()}).then(function(){return t.Ga()})})},If.prototype.$a=function(t){return!!t&&t.ownerId===this.clientId},If.prototype.Ja=function(e){var i=this;return Nf(e).get(Fc.key).next(function(t){if(null!==t&&i.nf(t.leaseTimestampMs,5e3)&&!i.rf(t.ownerId)){if(i.$a(t)&&i.networkEnabled)return!0;if(!i.$a(t)){if(!t.allowTabSynchronization)throw new oi(ii.FAILED_PRECONDITION,wf);return!1}}return!(!i.networkEnabled||!i.inForeground)||Af(e).ho().next(function(t){return void 0===i.if(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Mr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},If.prototype.shutdown=function(){return p(this,void 0,void 0,function(){var e=this;return y(this,function(t){switch(t.label){case 0:return this.Sa=!1,this.uf(),this.ka&&(this.ka.cancel(),this.ka=null),this.sf(),this.hf(),[4,this.Ba.runTransaction("readwrite-idempotent",[Fc.store,cf.store],function(t){return e.Ya(t).next(function(){return e.Za(t)})})];case 1:return t.sent(),this.Ba.close(),this.cf(),[2]}})})},If.prototype.if=function(t,e){var n=this;return t.filter(function(t){return n.nf(t.updateTimeMs,e)&&!n.rf(t.clientId)})},If.prototype.sc=function(){var e=this;return this.Ba.runTransaction("readonly-idempotent",[cf.store],function(t){return Af(t).ho().next(function(t){return e.if(t,18e5).map(function(t){return t.clientId})})})},If.clearPersistence=function(n){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return If.Js()?(e=n+If.xa,[4,Th.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(If.prototype,"ph",{get:function(){return this.Sa},enumerable:!0,configurable:!0}),If.prototype.bh=function(t){return jr(this.ph,"Cannot initialize MutationQueue before persistence is started."),Bh.po(t,this.serializer,this.vo,this.wo)},If.prototype.Th=function(){return jr(this.ph,"Cannot initialize TargetCache before persistence is started."),this.Ih},If.prototype._h=function(){return jr(this.ph,"Cannot initialize RemoteDocumentCache before persistence is started."),this.Jo},If.prototype.Rh=function(){return jr(this.ph,"Cannot initialize IndexManager before persistence is started."),this.vo},If.prototype.runTransaction=function(n,t,r){var i=this;Mr("IndexedDbPersistence","Starting transaction:",n);var o,e=t.endsWith("idempotent"),s=t.startsWith("readonly")?e?"readonly-idempotent":"readonly":e?"readwrite-idempotent":"readwrite";return this.Ba.runTransaction(s,lf,function(e){return o=new bf(e,i.Wa.next()),"readwrite-primary"===t||"readwrite-primary-idempotent"===t?i.Ha(e).next(function(t){return!!t||i.Ja(e)}).next(function(t){if(!t)throw Vr("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.Da.Uu(function(){return i.Oa(!1)}),new oi(ii.FAILED_PRECONDITION,Eh);return r(o)}).next(function(t){return i.Xa(e).next(function(){return t})}):i.af(e).next(function(){return r(o)})}).then(function(t){return o.zs(),t})},If.prototype.af=function(t){var e=this;return Nf(t).get(Fc.key).next(function(t){if(null!==t&&e.nf(t.leaseTimestampMs,5e3)&&!e.rf(t.ownerId)&&!e.$a(t)&&!t.allowTabSynchronization)throw new oi(ii.FAILED_PRECONDITION,wf)})},If.prototype.Xa=function(t){var e=new Fc(this.clientId,this.allowTabSynchronization,Date.now());return Nf(t).put(Fc.key,e)},If.Js=function(){return Th.Js()},If.ff=function(t){var e=t.s.projectId;return t.s.o||(e+="."+t.s.database),"firestore/"+t.persistenceKey+"/"+e+"/"},If.prototype.Ya=function(t){var e=this,n=Nf(t);return n.get(Fc.key).next(function(t){return e.$a(t)?(Mr("IndexedDbPersistence","Releasing primary lease."),n.delete(Fc.key)):wh.resolve()})},If.prototype.nf=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Vr("Detected an update time that is in the future: "+t+" > "+n),1))},If.prototype.qa=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Va=function(){t.Da.Uu(function(){return t.inForeground="visible"===t.document.visibilityState,t.Ma()})},this.document.addEventListener("visibilitychange",this.Va),this.inForeground="visible"===this.document.visibilityState)},If.prototype.sf=function(){this.Va&&(jr(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.Va),this.Va=null)},If.prototype.Qa=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.Ca=function(){t.uf(),t.Da.Uu(function(){return t.shutdown()})},this.window.addEventListener("unload",this.Ca))},If.prototype.hf=function(){this.Ca&&(jr("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.Ca),this.Ca=null)},If.prototype.rf=function(t){try{var e=null!==this.ja.getItem(this.ef(t));return Mr("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Vr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},If.prototype.uf=function(){try{this.ja.setItem(this.ef(this.clientId),String(Date.now()))}catch(t){Vr("Failed to set zombie client id.",t)}},If.prototype.cf=function(){try{this.ja.removeItem(this.ef(this.clientId))}catch(t){}},If.prototype.ef=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},If.xa="main",If);function If(t,e,n,r,i,o,s,a){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Da=o,this.Pa=a,this.Sa=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ca=null,this.inForeground=!1,this.Va=null,this.ka=null,this.Na=Number.NEGATIVE_INFINITY,this.Oa=function(t){return Promise.resolve()},this.wo=new Sf(this,i),this.Fa=e+If.xa,this.serializer=new vf(s),this.document=r.document,this.Ih=new dc(this.wo,this.serializer),this.vo=new pf,this.Jo=new Ac(this.serializer,this.vo),!r.window||!r.window.localStorage)throw new oi(ii.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.ja=this.window.localStorage}function Tf(t,e){var n=gf.call(this)||this;return n.Uo=t,n.qh=e,n}function Nf(t){return t.store(Fc.store)}function Af(t){return t.store(cf.store)}var Sf=(kf.prototype.Bc=function(t){var n=this.df(t);return this.db.Th().ea(t).next(function(e){return n.next(function(t){return e+t})})},kf.prototype.df=function(t){var e=0;return this.qc(t,function(t){e++}).next(function(){return e})},kf.prototype.Ue=function(t,e){return this.db.Th().Ue(t,e)},kf.prototype.qc=function(t,n){return this.vf(t,function(t,e){return n(e)})},kf.prototype.gh=function(t){this.lf=t},kf.prototype.ls=function(t,e){return Df(t,e)},kf.prototype.vs=function(t,e){return Df(t,e)},kf.prototype.Qc=function(t,e,n){return this.db.Th().Qc(t,e,n)},kf.prototype.Bo=function(t,e){return Df(t,e)},kf.prototype.wf=function(t,e){return this.lf.ys(e)?wh.resolve(!0):(r=e,i=!1,Zh(n=t).do(function(t){return Yh(n,t,r).next(function(t){return t&&(i=!0),wh.resolve(!t)})}).next(function(){return i}));var n,r,i},kf.prototype.Gc=function(r,i){var o=this,s=this.db._h().Oh(),a=[],u=0;return this.vf(r,function(e,t){if(t<=i){var n=o.wf(r,e).next(function(t){if(!t)return u++,s.Bs(r,e).next(function(){return s.Ls(e),Tc(r).delete([0,ch(e.path)])})});a.push(n)}}).next(function(){return wh.ks(a)}).next(function(){return s.apply(r)}).next(function(){return u})},kf.prototype.removeTarget=function(t,e){var n=e.Ni(t.qh);return this.db.Th().Gh(t,n)},kf.prototype.Wh=function(t,e){return Df(t,e)},kf.prototype.vf=function(t,o){var s,e=Tc(t),a=Xu.bu;return e.lo({index:ef.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(a!==Xu.bu&&o(new Qi(ph(s)),a),a=i,s=r):a=Xu.bu}).next(function(){a!==Xu.bu&&o(new Qi(ph(s)),a)})},kf.prototype.Wc=function(t){return this.db._h().ma(t)},kf);function kf(t,e){this.db=t,this.lf=null,this.Nc=new pc(this,e)}function Df(t,e){return Tc(t).put((n=e,r=t.qh,new ef(0,ch(n.path),r)));var n,r}var Rf=(Cf.prototype.Ah=function(t){this.mf=t},Cf.prototype.ih=function(e,r,i,o){var s=this;return jr(void 0!==this.mf,"setLocalDocumentsView() not called"),r.vi()?this.pf(e,r):i.isEqual(Gi.MIN)?this.pf(e,r):this.mf.th(e,o).next(function(t){var n=s.gf(r,t);return(r._i()||r.Ii())&&s.bf(r.Zn,n,o,i)?s.pf(e,r):(Pr()<=Ar.DEBUG&&Mr("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),s.mf.ih(e,r,i).next(function(e){return n.forEach(function(t){e=e.gt(t.key,t)}),e}))})},Cf.prototype.gf=function(n,t){var r=new co(function(t,e){return n.mi(t,e)});return t.forEach(function(t,e){e instanceof Vs&&n.matches(e)&&(r=r.add(e))}),r},Cf.prototype.bf=function(t,e,n,r){if(n.size!==e.size)return!0;var i=t===aa.Yn?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.h(r))},Cf.prototype.pf=function(t,e){return Pr()<=Ar.DEBUG&&Mr("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.mf.ih(t,e,Gi.MIN)},Cf),_f=(Of.prototype.bo=function(t){return wh.resolve(0===this.Yo.length)},Of.prototype.yo=function(t,e,n){var r=e.batchId,i=this.If(r,"acknowledged");jr(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.Yo[i];return jr(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,wh.resolve()},Of.prototype.Io=function(t){return wh.resolve(this.lastStreamToken)},Of.prototype.To=function(t,e){return this.lastStreamToken=e,wh.resolve()},Of.prototype.Eo=function(t,e,n,r){jr(0!==r.length,"Mutation batches should not be empty");var i=this.yf;this.yf++,0<this.Yo.length&&jr(this.Yo[this.Yo.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new dh(i,e,n,r);this.Yo.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this._f=this._f.add(new mh(u.key,i)),this.vo.Ao(t,u.key.path.Z())}return wh.resolve(o)},Of.prototype.Do=function(t,e){return wh.resolve(this.Tf(e))},Of.prototype.So=function(t,e){var n=this.Tf(e);return jr(null!=n,"Failed to find local mutation batch."),wh.resolve(n.keys())},Of.prototype.Co=function(t,e){var n=e+1,r=this.Ef(n),i=r<0?0:r;return wh.resolve(this.Yo.length>i?this.Yo[i]:null)},Of.prototype.Vo=function(){return wh.resolve(0===this.Yo.length?-1:this.yf-1)},Of.prototype.ko=function(t){return wh.resolve(this.Yo.slice())},Of.prototype.No=function(t,n){var r=this,e=new mh(n,0),i=new mh(n,Number.POSITIVE_INFINITY),o=[];return this._f.Gt([e,i],function(t){jr(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=r.Tf(t._s);jr(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),wh.resolve(o)},Of.prototype.Oo=function(t,e){var r=this,i=new co(Yr);return e.forEach(function(e){var t=new mh(e,0),n=new mh(e,Number.POSITIVE_INFINITY);r._f.Gt([t,n],function(t){jr(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),i=i.add(t._s)})}),wh.resolve(this.Rf(i))},Of.prototype.xo=function(t,e){jr(!e.Ei(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;Qi.dt(i)||(i=i.child(""));var o=new mh(new Qi(i),0),s=new co(Yr);return this._f.Wt(function(t){var e=t.key.path;return!!n.et(e)&&(e.length===r&&(s=s.add(t._s)),!0)},o),wh.resolve(this.Rf(s))},Of.prototype.Rf=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.Tf(t);null!==e&&r.push(e)}),r},Of.prototype.jo=function(n,r){var i=this;jr(0===this.If(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.Yo.shift();var o=this._f;return wh.forEach(r.mutations,function(t){var e=new mh(t.key,r.batchId);return o=o.delete(e),i.wo.Bo(n,t.key)}).next(function(){i._f=o})},Of.prototype.Lo=function(t){},Of.prototype.ys=function(t,e){var n=new mh(e,0),r=this._f.zt(n);return wh.resolve(e.isEqual(r&&r.key))},Of.prototype.Mo=function(t){return 0===this.Yo.length&&jr(this._f.tt(),"Document leak -- detected dangling mutation references when queue is empty."),wh.resolve()},Of.prototype.If=function(t,e){var n=this.Ef(t);return jr(0<=n&&n<this.Yo.length,"Batches must exist to be "+e),n},Of.prototype.Ef=function(t){return 0===this.Yo.length?0:t-this.Yo[0].batchId},Of.prototype.Tf=function(t){var e=this.Ef(t);if(e<0||e>=this.Yo.length)return null;var n=this.Yo[e];return jr(n.batchId===t,"If found batch must match"),n},Of);function Of(t,e){this.vo=t,this.wo=e,this.Yo=[],this.yf=1,this.lastStreamToken=Yu(),this._f=new co(mh.Qn)}function Cf(){}var xf,Lf,Pf,Uf,Mf=(Kf.prototype.js=function(t,e,n){jr(!n.isEqual(Gi.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.Af(e);return this.docs=this.docs.gt(r,{oa:e,size:s,readTime:n}),this.size+=s-o,this.vo.Ao(t,r.path.Z())},Kf.prototype.Ls=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Kf.prototype.Bs=function(t,e){var n=this.docs.get(e);return wh.resolve(n?n.oa:null)},Kf.prototype.getEntries=function(t,e){var n=this,r=Xa();return e.forEach(function(t){var e=n.docs.get(t);r=r.gt(t,e?e.oa:null)}),wh.resolve(r)},Kf.prototype.ih=function(t,e,n){jr(!e.Ei(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=eu(),i=new Qi(e.path.child("")),o=this.docs.Rt(i);o.Vt();){var s=o.Ct(),a=s.key,u=s.value,h=u.oa,c=u.readTime;if(!e.path.et(a.path))break;c.h(n)<=0||h instanceof Vs&&e.matches(h)&&(r=r.gt(h.key,h))}return wh.resolve(r)},Kf.prototype.Df=function(t,e){return wh.forEach(this.docs,function(t){return e(t)})},Kf.prototype.lc=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},Kf.prototype.vc=function(t){return wh.resolve(Gi.MIN)},Kf.prototype.Oh=function(t){return new Kf.wa(this)},Kf.prototype.ma=function(t){return wh.resolve(this.size)},Kf.wa=(t(Jf,Uf=bh),Jf.prototype.Qs=function(n){var r=this,i=[];return this.Os.forEach(function(t,e){e?i.push(r.pa.js(n,e,r.readTime)):r.pa.Ls(t)}),wh.ks(i)},Jf.prototype.Ms=function(t,e){return this.pa.Bs(t,e)},Jf.prototype.qs=function(t,e){return this.pa.getEntries(t,e)},Jf),Kf),Vf=(Zf.prototype.Ue=function(t,n){return this.Pf.forEach(function(t,e){return n(e)}),wh.resolve()},Zf.prototype.Uh=function(t){return wh.resolve(this.lastRemoteSnapshotVersion)},Zf.prototype.Yc=function(t){return wh.resolve(this.Sf)},Zf.prototype.Zh=function(t){var e=this.Kc.after(this.highestTargetId);return this.highestTargetId=e,wh.resolve(e)},Zf.prototype.zh=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Sf&&(this.Sf=e),wh.resolve()},Zf.prototype.Xc=function(t){this.Pf.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.Sf&&(this.Sf=t.sequenceNumber)},Zf.prototype.tc=function(t,e){return jr(!this.Pf.has(e.target),"Adding a target that already exists"),this.Xc(e),this.targetCount+=1,wh.resolve()},Zf.prototype.Gh=function(t,e){return jr(this.Pf.has(e.target),"Updating a non-existent target"),this.Xc(e),wh.resolve()},Zf.prototype.Zc=function(t,e){return jr(0<this.targetCount,"Removing a target from an empty cache"),jr(this.Pf.has(e.target),"Removing a non-existent target from the cache"),this.Pf.delete(e.target),this.Cf.ps(e.targetId),this.targetCount-=1,wh.resolve()},Zf.prototype.Qc=function(n,r,i){var o=this,s=0,a=[];return this.Pf.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.Pf.delete(t),a.push(o.ta(n,e.targetId)),s++)}),wh.ks(a).next(function(){return s})},Zf.prototype.ea=function(t){return wh.resolve(this.targetCount)},Zf.prototype.$h=function(t,e){var n=this.Pf.get(e)||null;return wh.resolve(n)},Zf.prototype.Je=function(t,e){return Fr("Not yet implemented.")},Zf.prototype.Mh=function(e,t,n){this.Cf.ds(t,n);var r=this.persistence.wo,i=[];return r&&t.forEach(function(t){i.push(r.ls(e,t))}),wh.ks(i)},Zf.prototype.Bh=function(e,t,n){this.Cf.ms(t,n);var r=this.persistence.wo,i=[];return r&&t.forEach(function(t){i.push(r.vs(e,t))}),wh.ks(i)},Zf.prototype.ta=function(t,e){return this.Cf.ps(e),wh.resolve()},Zf.prototype.ec=function(t,e){var n=this.Cf.bs(e);return wh.resolve(n)},Zf.prototype.ys=function(t,e){return wh.resolve(this.Cf.ys(e))},Zf),qf=(Qf.Nf=function(t,e){return new Qf(t,function(t){return new Bf(t,e)})},Qf.Of=function(t){return new Qf(t,function(t){return new jf(t)})},Qf.prototype.shutdown=function(){return this.Sa=!1,Promise.resolve()},Object.defineProperty(Qf.prototype,"ph",{get:function(){return this.Sa},enumerable:!0,configurable:!0}),Qf.prototype.sc=function(){return p(this,void 0,void 0,function(){return y(this,function(t){return[2,[this.clientId]]})})},Qf.prototype.za=function(t){return t(!0)},Qf.prototype.Ka=function(){},Qf.prototype.hc=function(t){},Qf.prototype.Rh=function(){return this.vo},Qf.prototype.bh=function(t){var e=this.Vf[t.I()];return e||(e=new _f(this.vo,this.wo),this.Vf[t.I()]=e),e},Qf.prototype.Th=function(){return this.Ih},Qf.prototype._h=function(){return this.Jo},Qf.prototype.runTransaction=function(t,e,n){var r=this;Mr("MemoryPersistence","Starting transaction:",t);var i=new Ff(this.Wa.next());return this.wo.Ff(),n(i).next(function(t){return r.wo.xf(i).next(function(){return t})}).Cs().then(function(t){return i.zs(),t})},Qf.prototype.jf=function(e,n){return wh.Ns((t=this.Vf,r=[],wi(t,function(t,e){return r.push(e)}),r).map(function(t){return function(){return t.ys(e,n)}}));var t,r},Qf),Ff=(t(Hf,Pf=Ih),Hf),jf=(Object.defineProperty(Wf.prototype,"Lf",{get:function(){if(this.Uf)return this.Uf;throw Fr("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),Wf.prototype.gh=function(t){this.lf=t},Wf.prototype.ls=function(t,e){return this.Lf.delete(e),wh.resolve()},Wf.prototype.vs=function(t,e){return this.Lf.add(e),wh.resolve()},Wf.prototype.Bo=function(t,e){return this.Lf.add(e),wh.resolve()},Wf.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.Th();return r.ec(t,e.targetId).next(function(t){t.forEach(function(t){return n.Lf.add(t)})}).next(function(){return r.Zc(t,e)})},Wf.prototype.Ff=function(){this.Uf=new Set},Wf.prototype.xf=function(t){var n=this,r=this.persistence._h().Oh();return wh.forEach(this.Lf,function(e){return n.Bf(t,e).next(function(t){t||r.Ls(e)})}).next(function(){return n.Uf=null,r.apply(t)})},Wf.prototype.Wh=function(t,e){var n=this;return this.Bf(t,e).next(function(t){t?n.Lf.delete(e):n.Lf.add(e)})},Wf.prototype.kf=function(t){return 0},Wf.prototype.Bf=function(t,e){var n=this;return wh.Ns([function(){return n.persistence.Th().ys(t,e)},function(){return n.persistence.jf(t,e)},function(){return wh.resolve(n.lf.ys(e))}])},Wf),Bf=(zf.prototype.Ff=function(){},zf.prototype.xf=function(t){return wh.resolve()},zf.prototype.Ue=function(t,e){return this.persistence.Th().Ue(t,e)},zf.prototype.Bc=function(t){var n=this.qf(t);return this.persistence.Th().ea(t).next(function(e){return n.next(function(t){return e+t})})},zf.prototype.qf=function(t){var e=0;return this.qc(t,function(t){e++}).next(function(){return e})},zf.prototype.qc=function(n,r){var i=this;return wh.forEach(this.Mf,function(t,e){return i.wf(n,t,e).next(function(t){return t?wh.resolve():r(e)})})},zf.prototype.gh=function(t){this.lf=t},zf.prototype.Qc=function(t,e,n){return this.persistence.Th().Qc(t,e,n)},zf.prototype.Gc=function(t,n){var r=this,i=0,e=this.persistence._h(),o=e.Oh();return e.Df(t,function(e){return r.wf(t,e,n).next(function(t){t||(i++,o.Ls(e))})}).next(function(){return o.apply(t)}).next(function(){return i})},zf.prototype.Bo=function(t,e){return this.Mf.set(e,t.qh),wh.resolve()},zf.prototype.removeTarget=function(t,e){var n=e.Ni(t.qh);return this.persistence.Th().Gh(t,n)},zf.prototype.ls=function(t,e){return this.Mf.set(e,t.qh),wh.resolve()},zf.prototype.vs=function(t,e){return this.Mf.set(e,t.qh),wh.resolve()},zf.prototype.Wh=function(t,e){return this.Mf.set(e,t.qh),wh.resolve()},zf.prototype.kf=function(t){var e=t.key.toString().length;return t instanceof Vs&&(e+=t.data().Fn()),e},zf.prototype.wf=function(t,e,n){var r=this;return wh.Ns([function(){return r.persistence.jf(t,e)},function(){return wh.resolve(r.lf.ys(e))},function(){return r.persistence.Th().ys(t,e)},function(){var t=r.Mf.get(e);return wh.resolve(void 0!==t&&n<t)}])},zf.prototype.Wc=function(t){return this.persistence._h().ma(t)},zf),Gf=(Yf.prototype.reset=function(){this.zf=0},Yf.prototype.Jf=function(){this.zf=this.Wf},Yf.prototype.Yf=function(t){var e=this;this.cancel();var n=Math.floor(this.zf+this.Xf()),r=Math.max(0,Date.now()-this.Hf),i=Math.max(0,n-r);0<this.zf&&Mr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.zf+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Kf=this.Da.Xu(this.Cu,i,function(){return e.Hf=Date.now(),t()}),this.zf*=this.Gf,this.zf<this.Qf&&(this.zf=this.Qf),this.zf>this.Wf&&(this.zf=this.Wf)},Yf.prototype.cancel=function(){null!==this.Kf&&(this.Kf.cancel(),this.Kf=null)},Yf.prototype.Xf=function(){return(Math.random()-.5)*this.zf},Yf);function Yf(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Da=t,this.Cu=e,this.Qf=n,this.Gf=r,this.Wf=i,this.zf=0,this.Kf=null,this.Hf=Date.now(),this.reset()}function zf(t,e){this.persistence=t,this.lf=null,this.Mf=new gh(function(t){return ch(t.path)}),this.Nc=new pc(this,e)}function Wf(t){this.persistence=t,this.lf=null,this.Uf=null}function Hf(t){var e=Pf.call(this)||this;return e.qh=t,e}function Qf(t,e){var n=this;this.clientId=t,this.Vf={},this.Wa=new Xu(0),this.Sa=!1,this.Sa=!0,this.wo=e(this),this.Ih=new Vf(this),this.vo=new Cc,this.Jo=new Mf(this.vo,function(t){return n.wo.kf(t)})}function Zf(t){this.persistence=t,this.Pf=new gh(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Gi.MIN,this.highestTargetId=0,this.Sf=0,this.Cf=new vh,this.targetCount=0,this.Kc=$h.Ko()}function Kf(t,e){this.vo=t,this.Af=e,this.docs=new Zi(Qi.Y),this.size=0}function Jf(t){var e=Uf.call(this)||this;return e.pa=t,e}(Lf=xf=xf||{})[Lf.$f=0]="__PRIVATE_Initial",Lf[Lf.Zf=1]="__PRIVATE_Starting",Lf[Lf.tl=2]="__PRIVATE_Open",Lf[Lf.Error=3]="Error",Lf[Lf.nl=4]="__PRIVATE_Backoff";var $f,Xf,tl=(cl.prototype.ol=function(){return this.state===xf.Zf||this.state===xf.tl||this.state===xf.nl},cl.prototype.hl=function(){return this.state===xf.tl},cl.prototype.start=function(){this.state!==xf.Error?(jr(this.state===xf.$f,"Already started"),this.auth()):this.cl()},cl.prototype.stop=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.ol()?[4,this.close(xf.$f)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},cl.prototype.al=function(){jr(!this.ol(),"Can only inhibit backoff in a stopped state"),this.state=xf.$f,this.sl.reset()},cl.prototype.fl=function(){var t=this;this.hl()&&null===this.ul&&(this.ul=this.Da.Xu(this.il,6e4,function(){return t.ll()}))},cl.prototype.dl=function(t){this.vl(),this.stream.send(t)},cl.prototype.ll=function(){return p(this,void 0,void 0,function(){return y(this,function(t){return this.hl()?[2,this.close(xf.$f)]:[2]})})},cl.prototype.vl=function(){this.ul&&(this.ul.cancel(),this.ul=null)},cl.prototype.close=function(e,n){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return jr(this.ol(),"Only started streams should be closed."),jr(e===xf.Error||oa(n),"Can't provide an error when not in an error state."),this.vl(),this.sl.cancel(),this.rl++,e!==xf.Error?this.sl.reset():n&&n.code===ii.RESOURCE_EXHAUSTED?(Vr(n.toString()),Vr("Using maximum backoff delay to prevent overloading the backend."),this.sl.Jf()):n&&n.code===ii.UNAUTHENTICATED&&this.el.P(),null!==this.stream&&(this.wl(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.ml(n)];case 1:return t.sent(),[2]}})})},cl.prototype.wl=function(){},cl.prototype.auth=function(){var n=this;jr(this.state===xf.$f,"Must be in initial state to auth"),this.state=xf.Zf;var t=this.pl(this.rl),e=this.rl;this.el.getToken().then(function(t){n.rl===e&&n.gl(t)},function(e){t(function(){var t=new oi(ii.UNKNOWN,"Fetching auth token failed: "+e.message);return n.bl(t)})})},cl.prototype.gl=function(t){var e=this;jr(this.state===xf.Zf,"Trying to start stream in a non-starting state");var n=this.pl(this.rl);this.stream=this.yl(t),this.stream._l(function(){n(function(){return jr(e.state===xf.Zf,"Expected stream to be in state Starting, but was "+e.state),e.state=xf.tl,e.listener._l()})}),this.stream.ml(function(t){n(function(){return e.bl(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},cl.prototype.cl=function(){var t=this;jr(this.state===xf.Error,"Should only perform backoff when in Error state"),this.state=xf.nl,this.sl.Yf(function(){return p(t,void 0,void 0,function(){return y(this,function(t){return jr(this.state===xf.nl,"Backoff elapsed but state is now: "+this.state),this.state=xf.$f,this.start(),jr(this.ol(),"PersistentStream should have started"),[2]})})})},cl.prototype.bl=function(t){return jr(this.ol(),"Can't handle server close on non-started stream"),Mr("PersistentStream","close with error: "+t),this.stream=null,this.close(xf.Error,t)},cl.prototype.pl=function(e){var n=this;return function(t){n.Da.Uu(function(){return n.rl===e?t():(Mr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},cl),el=(t(hl,Xf=tl),hl.prototype.yl=function(t){return this.connection.Il("Listen",t)},hl.prototype.onMessage=function(t){this.sl.reset();var e=this.serializer.Cr(t),n=this.serializer.kr(t);return this.listener.Tl(e,n)},hl.prototype.watch=function(t){var e={};e.database=this.serializer.wr,e.addTarget=this.serializer.wi(t);var n=this.serializer.Zr(t);n&&(e.labels=n),this.dl(e)},hl.prototype.El=function(t){var e={};e.database=this.serializer.wr,e.removeTarget=t,this.dl(e)},hl),nl=(t(ul,$f=tl),Object.defineProperty(ul.prototype,"Al",{get:function(){return this.Rl},enumerable:!0,configurable:!0}),ul.prototype.start=function(){this.Rl=!1,$f.prototype.start.call(this)},ul.prototype.wl=function(){this.Rl&&this.Dl([])},ul.prototype.yl=function(t){return this.connection.Il("Write",t)},ul.prototype.onMessage=function(t){if(jr(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.Rl){this.sl.reset();var e=this.serializer.qr(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.Pl(n,e)}return jr(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.Rl=!0,this.listener.Sl()},ul.prototype.Cl=function(){jr(this.hl(),"Writing handshake requires an opened stream"),jr(!this.Rl,"Handshake already completed");var t={};t.database=this.serializer.wr,this.dl(t)},ul.prototype.Dl=function(t){var e=this;jr(this.hl(),"Writing mutations requires an opened stream"),jr(this.Rl,"Handshake must be complete before writing mutations"),jr(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.Nr(t)})};this.dl(n)},ul),rl=(al.prototype.Vl=function(t){return new nl(this.Da,this.connection,this.credentials,this.serializer,t)},al.prototype.kl=function(t){return new el(this.Da,this.connection,this.credentials,this.serializer,t)},al.prototype.commit=function(t){var e=this,n={database:this.serializer.wr,writes:t.map(function(t){return e.serializer.Nr(t)})};return this.Nl("Commit",n).then(function(t){return e.serializer.qr(t.writeResults,t.commitTime)})},al.prototype.lookup=function(e){var i=this,t={database:this.serializer.wr,documents:e.map(function(t){return i.serializer.cr(t)})};return this.Ol("BatchGetDocuments",t).then(function(t){var n=$a();t.forEach(function(t){var e=i.serializer.Dr(t);n=n.gt(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);jr(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},al.prototype.Nl=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.Nl(e,n,t)}).catch(function(t){throw t.code===ii.UNAUTHENTICATED&&r.credentials.P(),t})},al.prototype.Ol=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.Ol(e,n,t)}).catch(function(t){throw t.code===ii.UNAUTHENTICATED&&r.credentials.P(),t})},al),il=(sl.documentId=function(){return sl.xl},sl.prototype.isEqual=function(t){if(!(t instanceof sl))throw Pi("isEqual","FieldPath",1,t);return this.Fl.isEqual(t.Fl)},sl.xl=new sl(Hi.ft().st()),sl),ol=new RegExp("[~\\*/\\[\\]]");function sl(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(){if(!(t instanceof Array)||t.length<1)throw new oi(ii.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Vi(1,"element")+".")}();for(var n=0;n<t.length;++n)if(Ai("FieldPath","string",n,t[n]),0===t[n].length)throw new oi(ii.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Fl=new Hi(t)}function al(t,e,n,r){this.Da=t,this.connection=e,this.credentials=n,this.serializer=r}function ul(t,e,n,r,i){var o=$f.call(this,t,Zu.Eu,Zu.Tu,e,n,i)||this;return o.serializer=r,o.Rl=!1,o.lastStreamToken=Yu(),o}function hl(t,e,n,r,i){var o=Xf.call(this,t,Zu.Iu,Zu._u,e,n,i)||this;return o.serializer=r,o}function cl(t,e,n,r,i,o){this.Da=t,this.il=n,this.connection=r,this.el=i,this.listener=o,this.state=xf.$f,this.rl=0,this.ul=null,this.stream=null,this.sl=new Gf(t,e)}var fl,ll,pl,dl,yl,vl,ml,gl=(Pl.delete=function(){return Ei("FieldValue.delete",arguments),wl.instance},Pl.serverTimestamp=function(){return Ei("FieldValue.serverTimestamp",arguments),bl.instance},Pl.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Ti("FieldValue.arrayUnion",arguments,1),new El(t)},Pl.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Ti("FieldValue.arrayRemove",arguments,1),new Il(t)},Pl.increment=function(t){return Ai("FieldValue.increment","number",1,t),Ii("FieldValue.increment",arguments,1),new Tl(t)},Pl.prototype.isEqual=function(t){return this===t},Pl),wl=(t(Ll,ml=gl),Ll.instance=new Ll,Ll),bl=(t(xl,vl=gl),xl.instance=new xl,xl),El=(t(Cl,yl=gl),Cl),Il=(t(Ol,dl=gl),Ol),Tl=(t(_l,pl=gl),_l),Nl=zu(gl,"Use FieldValue.<field>() instead."),Al=/^__.*__$/,Sl=(Rl.prototype.Bl=function(t,e){var n=[];return null!==this.ln?n.push(new Go(t,this.data,this.ln,e)):n.push(new Bo(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Yo(t,this.fieldTransforms)),n},Rl),kl=(Dl.prototype.Bl=function(t,e){var n=[new Go(t,this.data,this.ln,e)];return 0<this.fieldTransforms.length&&n.push(new Yo(t,this.fieldTransforms)),n},Dl);function Dl(t,e,n){this.data=t,this.ln=e,this.fieldTransforms=n}function Rl(t,e,n){this.data=t,this.ln=e,this.fieldTransforms=n}function _l(t){var e=pl.call(this,"FieldValue.increment")||this;return e.Ll=t,e}function Ol(t){var e=dl.call(this,"FieldValue.arrayRemove")||this;return e.Ul=t,e}function Cl(t){var e=yl.call(this,"FieldValue.arrayUnion")||this;return e.Ul=t,e}function xl(){return vl.call(this,"FieldValue.serverTimestamp")||this}function Ll(){return ml.call(this,"FieldValue.delete")||this}function Pl(t){this.jl=t}function Ul(t){switch(t){case fl.Set:case fl.Ml:case fl.ql:return!0;case fl.Ql:case fl.Gl:return!1;default:throw Fr("Unexpected case for UserDataSource: "+t)}}(ll=fl=fl||{})[ll.Set=0]="Set",ll[ll.ql=1]="__PRIVATE_Update",ll[ll.Ml=2]="__PRIVATE_MergeSet",ll[ll.Ql=3]="__PRIVATE_Argument",ll[ll.Gl=4]="__PRIVATE_ArrayArgument";var Ml=(jl.prototype.Hl=function(t){var e=null==this.path?null:this.path.child(t),n=new jl(this.Wl,this.methodName,e,!1,this.fieldTransforms,this.ln);return n.Jl(t),n},jl.prototype.Yl=function(t){var e=null==this.path?null:this.path.child(t),n=new jl(this.Wl,this.methodName,e,!1,this.fieldTransforms,this.ln);return n.Kl(),n},jl.prototype.Xl=function(t){return new jl(this.Wl,this.methodName,null,!0,this.fieldTransforms,this.ln)},jl.prototype.$l=function(t){var e=null===this.path||this.path.tt()?"":" (found in field "+this.path.toString()+")";return new oi(ii.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},jl.prototype.contains=function(e){return void 0!==this.ln.find(function(t){return e.et(t)})||void 0!==this.fieldTransforms.find(function(t){return e.et(t.field)})},jl.prototype.Kl=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.Jl(this.path.get(t))},jl.prototype.Jl=function(t){if(0===t.length)throw this.$l("Document fields must not be empty");if(Ul(this.Wl)&&Al.test(t))throw this.$l('Document fields cannot begin and end with "__"')},jl),Vl=function(t,e){this.s=t,this.key=e},ql=(Fl.prototype.td=function(t,e){var n=new Ml(fl.Set,t,Hi.ht);Gl("Data must be an object, but it was:",n,e);var r=this.nd(e,n);return new Sl(r,null,n.fieldTransforms)},Fl.prototype.ed=function(t,e,n){var r=new Ml(fl.Ml,t,Hi.ht);Gl("Data must be an object, but it was:",r,e);var i,o,s=this.nd(e,r);if(n){for(var a=new co(Hi.Y),u=0,h=n;u<h.length;u++){var c=h[u],f=void 0;if(c instanceof il)f=c.Fl;else{if("string"!=typeof c)throw Fr("Expected stringOrFieldPath to be a string or a FieldPath");f=zl(t,c)}if(!r.contains(f))throw new oi(ii.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");a=a.add(f)}i=ko.tn(a),o=r.fieldTransforms.filter(function(t){return i.in(t.field)})}else i=ko.nn(r.ln),o=r.fieldTransforms;return new Sl(s,i,o)},Fl.prototype.rd=function(o,t){var s=this,a=new Ml(fl.ql,o,Hi.ht);Gl("Data must be an object, but it was:",a,t);var u=new co(Hi.Y),h=Ps.EMPTY;wi(t,function(t,e){var n=zl(o,t),r=a.Yl(n);if((e=s.ud(e,r))instanceof wl)u=u.add(n);else{var i=s.nd(e,r);null!=i&&(u=u.add(n),h=h.set(n,i))}});var e=ko.tn(u);return new kl(h,e,a.fieldTransforms)},Fl.prototype.sd=function(t,e,n,r){var i=new Ml(fl.ql,t,Hi.ht),o=[Yl(t,e)],s=[n];if(r.length%2!=0)throw new oi(ii.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var a=0;a<r.length;a+=2)o.push(Yl(t,r[a])),s.push(r[a+1]);var u=new co(Hi.Y),h=Ps.EMPTY;for(a=0;a<o.length;++a){var c=o[a],f=i.Yl(c),l=this.ud(s[a],f);if(l instanceof wl)u=u.add(c);else{var p=this.nd(l,f);null!=p&&(u=u.add(c),h=h.set(c,p))}}var d=ko.tn(u);return new kl(h,d,i.fieldTransforms)},Fl.prototype.od=function(t,e,n){void 0===n&&(n=!1);var r=new Ml(n?fl.Gl:fl.Ql,t,Hi.ht),i=this.nd(e,r);return jr(null!=i,"Parsed data should not be null."),jr(0===r.fieldTransforms.length,"Field transforms should have been disallowed."),i},Fl.prototype.ud=function(t,e){try{return this.Zl(t)}catch(t){var n=Wl(t);throw e.$l(n)}},Fl.prototype.nd=function(t,e){if(Bl(t=this.ud(t,e)))return Gl("Unsupported field value:",e,t),this.hd(t,e);if(t instanceof gl)return this.ad(t,e),null;if(e.path&&e.ln.push(e.path),t instanceof Array){if(e.zl&&e.Wl!==fl.Gl)throw e.$l("Nested arrays are not supported");return this.fd(t,e)}return this.ld(t,e)},Fl.prototype.hd=function(t,r){var i=this,o=new Zi(Yr);return bi(t)?r.path&&0<r.path.length&&r.ln.push(r.path):wi(t,function(t,e){var n=i.nd(e,r.Hl(t));null!=n&&(o=o.gt(t,n))}),new Ps(o)},Fl.prototype.fd=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=o[i],a=this.nd(s,e.Xl(r));null==a&&(a=os.xn),n.push(a),r++}return new Us(n)},Fl.prototype.ad=function(t,e){if(!Ul(e.Wl))throw e.$l(t.jl+"() can only be used with update() and set()");if(null===e.path)throw e.$l(t.jl+"() is not currently supported inside arrays");if(t instanceof wl){if(e.Wl!==fl.Ml)throw e.Wl===fl.ql?(jr(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.$l("FieldValue.delete() can only appear at the top level of your update data")):e.$l("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.ln.push(e.path)}else if(t instanceof bl)e.fieldTransforms.push(new Do(e.path,lo.instance));else if(t instanceof El){var n=this.dd(t.jl,t.Ul),r=new po(n);e.fieldTransforms.push(new Do(e.path,r))}else if(t instanceof Il){n=this.dd(t.jl,t.Ul);var i=new yo(n);e.fieldTransforms.push(new Do(e.path,i))}else if(t instanceof Tl){var o=this.od("FieldValue.increment",t.Ll),s=new vo(o);e.fieldTransforms.push(new Do(e.path,s))}else Fr("Unknown FieldValue type: "+t)},Fl.prototype.ld=function(t,e){if(null===t)return os.xn;if("number"==typeof t)return sa(t)?new ks(t):new Ds(t);if("boolean"==typeof t)return ss.of(t);if("string"==typeof t)return new Rs(t);if(t instanceof Date)return new _s(Bi.fromDate(t));if(t instanceof Bi)return new _s(new Bi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof ji)return new Ls(t);if(t instanceof Ju)return new Cs(t);if(t instanceof Vl)return new xs(t.s,t.key);throw e.$l("Unsupported field value: "+Ci(t))},Fl.prototype.dd=function(r,t){var i=this;return t.map(function(t,e){var n=new Ml(fl.Ql,r,Hi.ht);return i.nd(t,n.Xl(e))})},Fl);function Fl(t){this.Zl=t}function jl(t,e,n,r,i,o){this.Wl=t,this.methodName=e,this.path=n,this.zl=r,void 0===i&&this.Kl(),this.zl=void 0!==r&&r,this.fieldTransforms=i||[],this.ln=o||[]}function Bl(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Bi||t instanceof ji||t instanceof Ju||t instanceof Vl||t instanceof gl)}function Gl(t,e,n){if(!Bl(n)||!Oi(n)){var r=Ci(n);throw"an object"===r?e.$l(t+" a custom object"):e.$l(t+" "+r)}}function Yl(t,e){if(e instanceof il)return e.Fl;if("string"==typeof e)return zl(t,e);throw new oi(ii.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function zl(e,t){try{return function(e){if(0<=e.search(ol))throw new oi(ii.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(il.bind.apply(il,s([void 0],e.split("."))))}catch(t){throw new oi(ii.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t).Fl}catch(t){var n=Wl(t);throw new oi(ii.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function Wl(t){return t instanceof Error?t.message:t.toString()}var Hl=(tp.prototype.lookup=function(r){return p(this,void 0,void 0,function(){var e,n=this;return y(this,function(t){switch(t.label){case 0:if(this.bd(),0<this.mutations.length)throw new oi(ii.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.vd.lookup(r)];case 1:return(e=t.sent()).forEach(function(t){t instanceof qs||t instanceof Vs?n.yd(t):Fr("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},tp.prototype.set=function(t,e){this.write(e.Bl(t,this.cn(t))),this.gd.add(t)},tp.prototype.update=function(t,e){try{this.write(e.Bl(t,this._d(t)))}catch(t){this.pd=t}this.gd.add(t)},tp.prototype.delete=function(t){this.write([new zo(t,this.cn(t))]),this.gd.add(t)},tp.prototype.commit=function(){return p(this,void 0,void 0,function(){var e,n=this;return y(this,function(t){switch(t.label){case 0:if(this.bd(),this.pd)throw this.pd;return e=this.wd,this.mutations.forEach(function(t){e=e.remove(t.key)}),e.forEach(function(t,e){n.mutations.push(new Wo(t,n.cn(t)))}),[4,this.vd.commit(this.mutations)];case 1:return t.sent(),this.md=!0,[2]}})})},tp.prototype.yd=function(t){var e;if(t instanceof Vs)e=t.version;else{if(!(t instanceof qs))throw Fr("Document in a transaction was a "+t.constructor.name);e=Gi.K()}var n=this.wd.get(t.key);if(null!==n){if(!e.isEqual(n))throw new oi(ii.ABORTED,"Document version changed between two reads.")}else this.wd=this.wd.gt(t.key,e)},tp.prototype.cn=function(t){var e=this.wd.get(t);return!this.gd.has(t)&&e?Fo.updateTime(e):Fo.NONE},tp.prototype._d=function(t){var e=this.wd.get(t);if(this.gd.has(t)||!e)return Fo.exists(!0);if(e.isEqual(Gi.K()))throw new oi(ii.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Fo.updateTime(e)},tp.prototype.write=function(t){this.bd(),this.mutations=this.mutations.concat(t)},tp.prototype.bd=function(){jr(!this.md,"A transaction object cannot be used after its update callback has been invoked.")},tp),Ql=(Xl.prototype.Ad=function(){var t=this;0===this.Td&&(this.Dd(Qr.l),jr(null===this.Ed,"onlineStateTimer shouldn't be started yet"),this.Ed=this.Su.Xu(Zu.Ru,1e4,function(){return t.Ed=null,jr(t.state===Qr.l,"Timer should be canceled if we transitioned to a different state."),t.Pd("Backend didn't respond within 10 seconds."),t.Dd(Qr.m),Promise.resolve()}))},Xl.prototype.Sd=function(t){this.state===Qr.v?(this.Dd(Qr.l),jr(0===this.Td,"watchStreamFailures must be 0"),jr(null===this.Ed,"onlineStateTimer must be null")):(this.Td++,1<=this.Td&&(this.Cd(),this.Pd("Connection failed 1 times. Most recent error: "+t.toString()),this.Dd(Qr.m)))},Xl.prototype.set=function(t){this.Cd(),this.Td=0,t===Qr.v&&(this.Rd=!1),this.Dd(t)},Xl.prototype.Dd=function(t){t!==this.state&&(this.state=t,this.Id(t))},Xl.prototype.Pd=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Rd?(Vr(e),this.Rd=!1):Mr("OnlineStateTracker",e)},Xl.prototype.Cd=function(){null!==this.Ed&&(this.Ed.cancel(),this.Ed=null)},Xl),Zl="RemoteStore",Kl=($l.prototype.start=function(){return this.enableNetwork()},$l.prototype.enableNetwork=function(){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.xd()?(e=this.Qd,[4,this.Oc.Io()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.Kd()?this.Hd():this.Ud.set(Qr.l),[4,this.Jd()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},$l.prototype.disableNetwork=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.Yd()];case 1:return t.sent(),this.Ud.set(Qr.m),[2]}})})},$l.prototype.Yd=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.Qd.stop()];case 1:return t.sent(),[4,this.Ld.stop()];case 2:return t.sent(),0<this.Vd.length&&(Mr(Zl,"Stopping write stream with "+this.Vd.length+" pending writes"),this.Vd=[]),this.Xd(),[2]}})})},$l.prototype.shutdown=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return Mr(Zl,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.Yd()];case 1:return t.sent(),this.Od.shutdown(),this.Ud.set(Qr.l),[2]}})})},$l.prototype.listen=function(t){vi(this.kd,t.targetId)||(this.kd[t.targetId]=t,this.Kd()?this.Hd():this.Ld.hl()&&this.$d(t))},$l.prototype.Zd=function(t){jr(vi(this.kd,t),"unlisten called on target no currently watched: "+t),delete this.kd[t],this.Ld.hl()&&this.tv(t),bi(this.kd)&&(this.Ld.hl()?this.Ld.fl():this.xd()&&this.Ud.set(Qr.l))},$l.prototype.Je=function(t){return this.kd[t]||null},$l.prototype.He=function(t){return this.nv.He(t)},$l.prototype.$d=function(t){this.Nd.Ae(t.targetId),this.Ld.watch(t)},$l.prototype.tv=function(t){this.Nd.Ae(t),this.Ld.El(t)},$l.prototype.Hd=function(){jr(this.Kd(),"startWatchStream() called when shouldStartWatchStream() is false."),this.Nd=new Du(this),this.Ld.start(),this.Ud.Ad()},$l.prototype.Kd=function(){return this.xd()&&!this.Ld.ol()&&!bi(this.kd)},$l.prototype.xd=function(){return this.isPrimary&&this.networkEnabled},$l.prototype.Xd=function(){this.Nd=null},$l.prototype.Bd=function(){return p(this,void 0,void 0,function(){var n=this;return y(this,function(t){return gi(this.kd,function(t,e){n.$d(e)}),[2]})})},$l.prototype.Md=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){return void 0===e&&jr(!this.Kd(),"Watch stream was stopped gracefully while still needed."),this.Xd(),this.Kd()?(this.Ud.Sd(e),this.Hd()):this.Ud.set(Qr.l),[2]})})},$l.prototype.qd=function(n,r){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.Ud.set(Qr.v),n instanceof Su&&n.state===vu.Bi&&n.cause?[2,this.iv(n)]:(n instanceof du?this.Nd.Oe(n):n instanceof yu?this.Nd.qe(n):(jr(n instanceof Su,"Expected watchChange to be an instance of WatchTargetChange"),this.Nd.je(n)),r.isEqual(Gi.MIN)?[3,3]:[4,this.Oc.Uh()]);case 1:return e=t.sent(),0<=r.h(e)?[4,this.ev(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},$l.prototype.ev=function(r){var i=this;jr(!r.isEqual(Gi.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.Nd.We(r);return gi(t.$i,function(t,e){if(0<e.resumeToken.length){var n=i.kd[t];n&&(i.kd[t]=n.Oi(e.resumeToken,r))}}),t.Zi.forEach(function(t){var e=i.kd[t];if(e){i.kd[t]=e.Oi(Yu(),e.ki),i.tv(t);var n=new za(e.target,t,fa.Si,e.sequenceNumber);i.$d(n)}}),this.nv.Lh(t)},$l.prototype.iv=function(t){var n=this;jr(!!t.cause,"Handling target error without a cause");var r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return p(n,void 0,void 0,function(){return y(this,function(t){return vi(this.kd,e)?(delete this.kd[e],this.Nd.removeTarget(e),[2,this.nv.rv(e,r)]):[2]})})})}),i},$l.prototype.Jd=function(){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return this.uv()?(e=0<this.Vd.length?this.Vd[this.Vd.length-1].batchId:-1,[4,this.Oc.Jh(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this.Vd.length&&this.Qd.fl(),[3,4]);case 2:return this.sv(n),[4,this.Jd()];case 3:t.sent(),t.label=4;case 4:return this.ov()&&this.hv(),[2]}})})},$l.prototype.uv=function(){return this.xd()&&this.Vd.length<10},$l.prototype.cv=function(){return this.Vd.length},$l.prototype.sv=function(t){jr(this.uv(),"addToWritePipeline called when pipeline is full"),this.Vd.push(t),this.Qd.hl()&&this.Qd.Al&&this.Qd.Dl(t.mutations)},$l.prototype.ov=function(){return this.xd()&&!this.Qd.ol()&&0<this.Vd.length},$l.prototype.hv=function(){jr(this.ov(),"startWriteStream() called when shouldStartWriteStream() is false."),this.Qd.start()},$l.prototype.Gd=function(){return p(this,void 0,void 0,function(){return y(this,function(t){return this.Qd.Cl(),[2]})})},$l.prototype.zd=function(){var r=this;return this.Oc.To(this.Qd.lastStreamToken).then(function(){for(var t=0,e=r.Vd;t<e.length;t++){var n=e[t];r.Qd.Dl(n.mutations)}}).catch(ac)},$l.prototype.Pl=function(t,e){var n=this;jr(0<this.Vd.length,"Got result for empty write pipeline");var r=this.Vd.shift(),i=yh.from(r,t,e,this.Qd.lastStreamToken);return this.nv.av(i).then(function(){return n.Jd()})},$l.prototype.Wd=function(n){return p(this,void 0,void 0,function(){var e=this;return y(this,function(t){return void 0===n&&jr(!this.ov(),"Write stream was stopped gracefully while still needed."),n&&0<this.Vd.length?[2,(this.Qd.Al?this.fv(n):this.lv(n)).then(function(){e.ov()&&e.hv()})]:[2]})})},$l.prototype.lv=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){return Za(e.code)?(Mr(Zl,"RemoteStore error before completed handshake; resetting stream token: ",this.Qd.lastStreamToken),this.Qd.lastStreamToken=Yu(),[2,this.Oc.To(Yu()).catch(ac)]):[2]})})},$l.prototype.fv=function(i){return p(this,void 0,void 0,function(){var n,r=this;return y(this,function(t){return Za(e=i.code)&&e!==ii.ABORTED?(n=this.Vd.shift(),this.Qd.al(),[2,this.nv.dv(n.batchId,i).then(function(){return r.Jd()})]):[2];var e})})},$l.prototype.vv=function(){return new Hl(this.vd)},$l.prototype.jd=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.Yd()];case 1:return t.sent(),this.Ud.set(Qr.l),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},$l.prototype.wv=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.xd()?(Mr(Zl,"RemoteStore restarting streams for new credential"),[4,this.jd()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},$l.prototype.mv=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.Yd()];case 3:t.sent(),this.Ud.set(Qr.l),t.label=4;case 4:return[2]}})})},$l),Jl="firestore_clients";function $l(t,e,n,r,i){var o=this;this.Oc=t,this.vd=e,this.Vd=[],this.kd={},this.Nd=null,this.networkEnabled=!1,this.isPrimary=!1,this.Od=i,this.Od.Fd(function(t){n.Uu(function(){return p(o,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.xd()?(Mr(Zl,"Restarting streams for network reachability change."),[4,this.jd()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Ud=new Ql(n,r),this.Ld=this.vd.kl({_l:this.Bd.bind(this),ml:this.Md.bind(this),Tl:this.qd.bind(this)}),this.Qd=this.vd.Vl({_l:this.Gd.bind(this),ml:this.Wd.bind(this),Sl:this.zd.bind(this),Pl:this.Pl.bind(this)})}function Xl(t,e){this.Su=t,this.Id=e,this.state=Qr.l,this.Td=0,this.Ed=null,this.Rd=!0}function tp(t){this.vd=t,this.wd=ru(),this.mutations=[],this.md=!1,this.pd=null,this.gd=new Set}function ep(t,e){return jr(-1===e.indexOf("_"),"Client key cannot contain '_', but was '"+e+"'"),Jl+"_"+t+"_"+e}var np="firestore_mutations";function rp(t,e,n){var r=np+"_"+t+"_"+n;return e._()&&(r+="_"+e.uid),r}var ip="firestore_targets";function op(t,e){return ip+"_"+t+"_"+e}var sp="SharedClientState",ap=(gp.pv=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new oi(r.error.code,r.error.message)),i?new gp(t,e,r.state,o):(Vr(sp,"Failed to parse mutation state for ID '"+e+"': "+n),null)},gp.prototype.gv=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},gp),up=(mp.pv=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new oi(n.error.code,n.error.message)),r?new mp(t,n.state,i):(Vr(sp,"Failed to parse target state for ID '"+t+"': "+e),null)},mp.prototype.gv=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},mp),hp=(vp.pv=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=au(),o=0;r&&o<n.activeTargetIds.length;++o)r=sa(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new vp(t,i):(Vr(sp,"Failed to parse client data for instance '"+t+"': "+e),null)},vp),cp=(yp.pv=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in Qr&&"string"==typeof e.clientId?new yp(e.clientId,Qr[e.onlineState]):(Vr(sp,"Failed to parse online state: "+t),null)},yp),fp=(dp.prototype.bv=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},dp.prototype.yv=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},dp.prototype.gv=function(){var t={activeTargetIds:this.activeTargetIds.ut(),updateTimeMs:Date.now()};return JSON.stringify(t)},dp),lp=(pp.Js=function(t){return!(!t.window||null==t.window.localStorage)},pp.prototype.start=function(){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,h,c,f,l=this;return y(this,function(t){switch(t.label){case 0:return jr(!this.ph,"WebStorageSharedClientState already started"),jr(null!==this.nv,"syncEngine property must be set before calling start()"),jr(null!==this.Id,"onlineStateHandler property must be set before calling start()"),[4,this.nv.sc()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this._v&&(o=this.getItem(ep(this.persistenceKey,i)))&&(s=hp.pv(i,o))&&(this.Iv[s.clientId]=s);for(this.kv(),(a=this.storage.getItem(this.Vv))&&(u=this.Nv(a))&&this.Ov(u),h=0,c=this.Rv;h<c.length;h++)f=c[h],this.Ev(f);return this.Rv=[],this.platform.window.addEventListener("unload",function(){return l.shutdown()}),this.ph=!0,[2]}})})},pp.prototype.gu=function(t){this.setItem(this.Dv,JSON.stringify(t))},pp.prototype.Fv=function(){var n=au();return wi(this.Iv,function(t,e){n=n.Kt(e.activeTargetIds)}),n},pp.prototype.xv=function(t){for(var e in this.Iv)if(this.Iv.hasOwnProperty(e)&&this.Iv[e].activeTargetIds.has(t))return!0;return!1},pp.prototype.jv=function(t){this.Uv(t,"pending")},pp.prototype.Lv=function(t,e,n){this.Uv(t,e,n),this.Bv(t)},pp.prototype.Mv=function(t){var e="not-current";if(this.xv(t)){var n=this.storage.getItem(op(this.persistenceKey,t));if(n){var r=up.pv(t,n);r&&(e=r.state)}}return this.qv.bv(t),this.kv(),e},pp.prototype.Qv=function(t){this.qv.yv(t),this.kv()},pp.prototype.Gv=function(t){return this.qv.activeTargetIds.has(t)},pp.prototype.Wv=function(t){this.removeItem(op(this.persistenceKey,t))},pp.prototype.zv=function(t,e,n){this.Kv(t,e,n)},pp.prototype.Ph=function(t,e,n){var r=this;e.forEach(function(t){r.Bv(t)}),this.currentUser=t,n.forEach(function(t){r.jv(t)})},pp.prototype.Hv=function(t){this.Jv(t)},pp.prototype.shutdown=function(){this.ph&&(this.platform.window.removeEventListener("storage",this.Tv),this.removeItem(this.Av),this.ph=!1)},pp.prototype.getItem=function(t){var e=this.storage.getItem(t);return Mr(sp,"READ",t,e),e},pp.prototype.setItem=function(t,e){Mr(sp,"SET",t,e),this.storage.setItem(t,e)},pp.prototype.removeItem=function(t){Mr(sp,"REMOVE",t),this.storage.removeItem(t)},pp.prototype.Ev=function(a){var t=this;if(a.storageArea===this.storage){if(Mr(sp,"EVENT",a.key,a.newValue),a.key===this.Av)return void Vr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Da.Uu(function(){return p(t,void 0,void 0,function(){var e,n,r,i,o,s;return y(this,function(t){if(!this.ph)return this.Rv.push(a),[2];if(null===a.key)return[2];if(this.Pv.test(a.key)){if(null==a.newValue)return n=this.Yv(a.key),[2,this.Xv(n,null)];if(e=this.$v(a.key,a.newValue))return[2,this.Xv(e.clientId,e)]}else if(this.Sv.test(a.key)){if(null!==a.newValue&&(r=this.Zv(a.key,a.newValue)))return[2,this.tw(r)]}else if(this.Cv.test(a.key)){if(null!==a.newValue&&(i=this.nw(a.key,a.newValue)))return[2,this.iw(i)]}else if(a.key===this.Vv){if(null!==a.newValue&&(o=this.Nv(a.newValue)))return[2,this.Ov(o)]}else a.key===this.Dv&&(jr(!!this.wu,"Missing sequenceNumberHandler"),(s=function(t){var e=Xu.bu;if(null!=t)try{var n=JSON.parse(t);jr("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Vr(sp,"Failed to read sequence number from WebStorage",t)}return e}(a.newValue))!==Xu.bu&&this.wu(s));return[2]})})})}},Object.defineProperty(pp.prototype,"qv",{get:function(){return this.Iv[this._v]},enumerable:!0,configurable:!0}),pp.prototype.kv=function(){this.setItem(this.Av,this.qv.gv())},pp.prototype.Uv=function(t,e,n){var r=new ap(this.currentUser,t,e,n),i=rp(this.persistenceKey,this.currentUser,t);this.setItem(i,r.gv())},pp.prototype.Bv=function(t){var e=rp(this.persistenceKey,this.currentUser,t);this.removeItem(e)},pp.prototype.Jv=function(t){var e={clientId:this._v,onlineState:Qr[t]};this.storage.setItem(this.Vv,JSON.stringify(e))},pp.prototype.Kv=function(t,e,n){var r=op(this.persistenceKey,t),i=new up(t,e,n);this.setItem(r,i.gv())},pp.prototype.Yv=function(t){var e=this.Pv.exec(t);return e?e[1]:null},pp.prototype.$v=function(t,e){var n=this.Yv(t);return jr(null!==n,"Cannot parse client state key '"+t+"'"),hp.pv(n,e)},pp.prototype.Zv=function(t,e){var n=this.Sv.exec(t);jr(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return ap.pv(new ri(i),r,e)},pp.prototype.nw=function(t,e){var n=this.Cv.exec(t);jr(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return up.pv(r,e)},pp.prototype.Nv=function(t){return cp.pv(t)},pp.prototype.tw=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){return e.user.uid!==this.currentUser.uid?(Mr(sp,"Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.nv.ew(e.batchId,e.state,e.error)]})})},pp.prototype.iw=function(t){return this.nv.rw(t.targetId,t.state,t.error)},pp.prototype.Xv=function(t,e){var n=this,r=this.Fv();e?this.Iv[t]=e:delete this.Iv[t];var i=this.Fv(),o=[],s=[];return i.forEach(function(e){return p(n,void 0,void 0,function(){return y(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return p(n,void 0,void 0,function(){return y(this,function(t){return i.has(e)||s.push(e),[2]})})}),this.nv.uw(o,s)},pp.prototype.Ov=function(t){this.Iv[t.clientId]&&this.Id(t.onlineState)},pp);function pp(t,e,n,r,i){if(this.Da=t,this.platform=e,this.persistenceKey=n,this._v=r,this.nv=null,this.Id=null,this.wu=null,this.Iv={},this.Tv=this.Ev.bind(this),this.ph=!1,this.Rv=[],!pp.Js(this.platform))throw new oi(ii.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.Av=ep(this.persistenceKey,this._v),this.Dv="firestore_sequence_number_"+this.persistenceKey,this.Iv[this._v]=new fp,this.Pv=new RegExp("^"+Jl+"_"+o+"_([^_]*)$"),this.Sv=new RegExp("^"+np+"_"+o+"_(\\d+)(?:_(.*))?$"),this.Cv=new RegExp("^"+ip+"_"+o+"_(\\d+)$"),this.Vv="firestore_online_state_"+this.persistenceKey,this.platform.window.addEventListener("storage",this.Tv)}function dp(){this.activeTargetIds=au()}function yp(t,e){this.clientId=t,this.onlineState=e}function vp(t,e){this.clientId=t,this.activeTargetIds=e}function mp(t,e,n){this.targetId=t,this.state=e,jr(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}function gp(t,e,n,r){this.user=t,this.batchId=e,this.state=n,jr(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}function wp(t){this.key=t}function bp(t){this.key=t}var Ep=(Np.prototype.jv=function(t){},Np.prototype.Lv=function(t,e,n){},Np.prototype.Mv=function(t){return this.sw.bv(t),this.ow[t]||"not-current"},Np.prototype.zv=function(t,e,n){this.ow[t]=e},Np.prototype.Qv=function(t){this.sw.yv(t)},Np.prototype.Gv=function(t){return this.sw.activeTargetIds.has(t)},Np.prototype.Wv=function(t){delete this.ow[t]},Np.prototype.Fv=function(){return this.sw.activeTargetIds},Np.prototype.xv=function(t){return this.sw.activeTargetIds.has(t)},Np.prototype.start=function(){return this.sw=new fp,Promise.resolve()},Np.prototype.Ph=function(t,e,n){},Np.prototype.Hv=function(t){},Np.prototype.shutdown=function(){},Np.prototype.gu=function(t){},Np),Ip=(Object.defineProperty(Tp.prototype,"lw",{get:function(){return this.hw},enumerable:!0,configurable:!0}),Tp.prototype.dw=function(t,e){var a=this,u=e?e.vw:new gu,h=e?e.fw:this.fw,c=e?e.Hi:this.Hi,f=h,l=!1,p=this.query._i()&&h.size===this.query.limit?h.last():null,d=this.query.Ii()&&h.size===this.query.limit?h.first():null;if(t.It(function(t,e){var n=h.get(t),r=e instanceof Vs?e:null;r&&(jr(t.isEqual(r.key),"Mismatching keys found in document changes: "+t+" != "+r.key),r=a.query.matches(r)?r:null);var i=!!n&&a.Hi.has(n.key),o=!!r&&(r.an||a.Hi.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:uu.qi,doc:r}),s=!0):a.ww(n,r)||(u.track({type:uu.Mi,doc:r}),s=!0,(p&&0<a.query.mi(r,p)||d&&a.query.mi(r,d)<0)&&(l=!0)):!n&&r?(u.track({type:uu.Li,doc:r}),s=!0):n&&!r&&(u.track({type:uu.Bi,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query._i()||this.query.Ii())for(;f.size>this.query.limit;){var n=this.query._i()?f.last():f.first();f=f.delete(n.key),c=c.delete(n.key),u.track({type:uu.Bi,doc:n})}return jr(!l||!e,"View was refilled using docs that themselves needed refilling."),{fw:f,vw:u,bf:l,Hi:c}},Tp.prototype.ww=function(t,e){return t.an&&e.hasCommittedMutations&&!e.an},Tp.prototype.Qs=function(t,e,n){var o=this;jr(!t.bf,"Cannot apply changes that need a refill");var r=this.fw;this.fw=t.fw,this.Hi=t.Hi;var i=t.vw.zi();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.query.mi(t.doc,e.doc);function n(t){switch(t){case uu.Li:return 1;case uu.Mi:case uu.qi:return 2;case uu.Bi:return 0;default:return Fr("Unknown ChangeType: "+t)}}var r,i}),this.mw(n);var s=e?this.pw():[],a=0===this.aw.size&&this.re?cu.Gi:cu.Qi,u=a!==this.cw;return this.cw=a,0!==i.length||u?{snapshot:new wu(this.query,t.fw,r,i,t.Hi,a===cu.Qi,u,!1),gw:s}:{gw:s}},Tp.prototype.bw=function(t){return this.re&&t===Qr.m?(this.re=!1,this.Qs({fw:this.fw,vw:new gu,Hi:this.Hi,bf:!1},!1)):{gw:[]}},Tp.prototype.yw=function(t){return!this.hw.has(t)&&!!this.fw.has(t)&&!this.fw.get(t).an},Tp.prototype.mw=function(t){var e=this;t&&(t.ue.forEach(function(t){return e.hw=e.hw.add(t)}),t.se.forEach(function(t){return jr(e.hw.has(t),"Modified document "+t+" not found in view.")}),t.oe.forEach(function(t){return e.hw=e.hw.delete(t)}),this.re=t.re)},Tp.prototype.pw=function(){var e=this;if(!this.re)return[];var n=this.aw;this.aw=ou(),this.fw.forEach(function(t){e.yw(t.key)&&(e.aw=e.aw.add(t.key))});var r=[];return n.forEach(function(t){e.aw.has(t)||r.push(new bp(t))}),this.aw.forEach(function(t){n.has(t)||r.push(new wp(t))}),r},Tp.prototype._w=function(t){this.hw=t.rc,this.aw=ou();var e=this.dw(t.documents);return this.Qs(e,!0)},Tp.prototype.Iw=function(){return wu.Xi(this.query,this.fw,this.Hi,this.cw===cu.Qi)},Tp);function Tp(t,e){this.query=t,this.hw=e,this.cw=null,this.re=!1,this.aw=ou(),this.Hi=ou(),this.fw=new lu(t.mi.bind(t))}function Np(){this.sw=new fp,this.ow={},this.nv=null,this.Id=null,this.wu=null}function Ap(t,e,n){this.query=t,this.targetId=e,this.view=n}function Sp(t){this.key=t,this.Sw=!1}function kp(){this.sm=null,this.targetId=0,this.listeners=[]}function Dp(){}var Rp=(Bp.prototype.run=function(){this.Rw()},Bp.prototype.Rw=function(){var t=this;this.sl.Yf(function(){return p(t,void 0,void 0,function(){var e,n,r=this;return y(this,function(t){return e=this.Tw.vv(),(n=this.Aw(e))&&n.then(function(t){r.Su.Uu(function(){return e.commit().then(function(){r.Nu.resolve(t)}).catch(function(t){r.Dw(t)})})}).catch(function(t){r.Dw(t)}),[2]})})})},Bp.prototype.Aw=function(t){try{var e=this.updateFunction(t);return!oa(e)&&e.catch&&e.then?e:(this.Nu.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Nu.reject(t),null}},Bp.prototype.Dw=function(t){var e=this;0<this.Ew&&this.Pw(t)?(this.Ew-=1,this.Su.Uu(function(){return e.Rw(),Promise.resolve()})):this.Nu.reject(t)},Bp.prototype.Pw=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Za(e)},Bp),_p=(Object.defineProperty(jp.prototype,"Bw",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),jp.prototype.subscribe=function(t){jr(null!==t,"SyncEngine listener cannot be null"),jr(null===this.Vw,"SyncEngine already has a subscriber."),this.Vw=t},jp.prototype.listen=function(s){return p(this,void 0,void 0,function(){var e,n,r,i,o;return y(this,function(t){switch(t.label){case 0:return this.Mw("listen()"),(r=this.kw.get(s))?(e=r.targetId,this.Cw.Mv(e),n=r.view.Iw(),[3,4]):[3,1];case 1:return[4,this.Oc.Xh(s.wi())];case 2:return i=t.sent(),o=this.Cw.Mv(i.targetId),e=i.targetId,[4,this.qw(s,e,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.Tw.listen(i),t.label=4;case 4:return this.Vw.Tl([n]),[2,e]}})})},jp.prototype.qw=function(a,u,h){return p(this,void 0,void 0,function(){var e,n,r,i,o,s;return y(this,function(t){switch(t.label){case 0:return[4,this.Oc.ic(a,!0)];case 1:return e=t.sent(),n=new Ip(a,e.rc),r=n.dw(e.documents),i=Eu.ee(u,h&&this.onlineState!==Qr.m),jr(0===(o=n.Qs(r,!0===this.isPrimary,i)).gw.length,"View returned limbo docs before target ack from the server."),jr(!!o.snapshot,"applyChanges for new view should always return a snapshot"),s=new Ap(a,u,n),this.kw.set(a,s),this.Nw[u]||(this.Nw[u]=[]),this.Nw[u].push(a),[2,o.snapshot]}})})},jp.prototype.Qw=function(r){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return[4,this.Oc.ic(r.query,!0)];case 1:return e=t.sent(),n=r.view._w(e),this.isPrimary&&this.Gw(r.targetId,n.gw),[2,n]}})})},jp.prototype.Zd=function(i){return p(this,void 0,void 0,function(){var e,n,r=this;return y(this,function(t){switch(t.label){case 0:return this.Mw("unlisten()"),jr(!!(e=this.kw.get(i)),"Trying to unlisten on query not found:"+i),1<(n=this.Nw[e.targetId]).length?(this.Nw[e.targetId]=n.filter(function(t){return!t.isEqual(i)}),this.kw.delete(i),[2]):this.isPrimary?(this.Cw.Qv(e.targetId),this.Cw.xv(e.targetId)?[3,2]:[4,this.Oc.nc(e.targetId,!1).then(function(){r.Cw.Wv(e.targetId),r.Tw.Zd(e.targetId),r.Ww(e.targetId)}).catch(ac)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.Ww(e.targetId),[4,this.Oc.nc(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},jp.prototype.write=function(n,r){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.Mw("write()"),[4,this.Oc.kh(n)];case 1:return e=t.sent(),this.Cw.jv(e.batchId),this.zw(e.batchId,r),[4,this.Kw(e.Os)];case 2:return t.sent(),[4,this.Tw.Jd()];case 3:return t.sent(),[2]}})})},jp.prototype.runTransaction=function(t,e,n){new Rp(t,this.Tw,e,n).run()},jp.prototype.Lh=function(n){return p(this,void 0,void 0,function(){var e,r=this;return y(this,function(t){switch(t.label){case 0:this.Mw("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Oc.Lh(n)];case 2:return e=t.sent(),wi(n.$i,function(t,e){var n=r.Fw[Number(t)];n&&(jr(e.ue.size+e.se.size+e.oe.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.ue.size?n.Sw=!0:0<e.se.size?jr(n.Sw,"Received change for limbo target document without add."):0<e.oe.size&&(jr(n.Sw,"Received remove for limbo target document without add."),n.Sw=!1))}),[4,this.Kw(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,ac(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},jp.prototype.bw=function(r,t){if(this.isPrimary&&t===Kr.p||!this.isPrimary&&t===Kr.g){this.Mw("applyOnlineStateChange()");var i=[];this.kw.forEach(function(t,e){var n=e.view.bw(r);jr(0===n.gw.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.Vw.Hw(r),this.Vw.Tl(i),this.onlineState=r,this.isPrimary&&this.Cw.Hv(r)}},jp.prototype.rv=function(a,u){return p(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return y(this,function(t){switch(t.label){case 0:return this.Mw("rejectListens()"),this.Cw.zv(a,"rejected",u),e=this.Fw[a],(n=e&&e.key)?(this.Ow=this.Ow.remove(n),delete this.Fw[a],r=(r=new Zi(Qi.Y)).gt(n,new qs(n,Gi.K())),i=ou().add(n),o=new bu(Gi.MIN,{},new co(Yr),r,i),[2,this.Lh(o)]):[3,1];case 1:return[4,this.Oc.nc(a,!1).then(function(){return s.Ww(a,u)}).catch(ac)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},jp.prototype.ew=function(n,r,i){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.Mw("applyBatchState()"),[4,this.Oc.Nh(n)];case 1:return null===(e=t.sent())?(Mr("SyncEngine","Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.Tw.Jd()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.Jw(n,i||null),this.Oc.oc(n)):Fr("Unknown batchState: "+r),t.label=4;case 4:return[4,this.Kw(e)];case 5:return t.sent(),[2]}})})},jp.prototype.av=function(r){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:this.Mw("applySuccessfulWrite()"),e=r.batch.batchId,this.Jw(e,null),this.Yw(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Oc.yo(r)];case 2:return n=t.sent(),this.Cw.Lv(e,"acknowledged"),[4,this.Kw(n)];case 3:return t.sent(),[3,6];case 4:return[4,ac(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},jp.prototype.dv=function(n,r){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:this.Mw("rejectFailedWrite()"),this.Jw(n,r),this.Yw(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Oc.jh(n)];case 2:return e=t.sent(),this.Cw.Lv(n,"rejected",r),[4,this.Kw(e)];case 3:return t.sent(),[3,6];case 4:return[4,ac(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},jp.prototype.Xw=function(r){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return this.Tw.xd()||Mr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.Oc.Vo()];case 1:return-1===(e=t.sent())?r.resolve():((n=this.Uw.get(e)||[]).push(r),this.Uw.set(e,n)),[2]}})})},jp.prototype.Yw=function(t){(this.Uw.get(t)||[]).forEach(function(t){t.resolve()}),this.Uw.delete(t)},jp.prototype.$w=function(e){this.Uw.forEach(function(t){t.forEach(function(t){t.reject(new oi(ii.CANCELLED,e))})}),this.Uw.clear()},jp.prototype.zw=function(t,e){var n=this.jw[this.currentUser.I()];n=(n=n||new Zi(Yr)).gt(t,e),this.jw[this.currentUser.I()]=n},jp.prototype.Jw=function(t,e){var n=this.jw[this.currentUser.I()];if(n){var r=n.get(t);r&&(jr(t===n.yt(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.jw[this.currentUser.I()]=n}},jp.prototype.Ww=function(t,e){var n=this;void 0===e&&(e=null),this.Cw.Qv(t),jr(this.Nw[t]&&0!==this.Nw[t].length,"There are no queries mapped to target id "+t);for(var r=0,i=this.Nw[t];r<i.length;r++){var o=i[r];this.kw.delete(o),e&&this.Vw.Zw(o,e)}if(delete this.Nw[t],this.isPrimary){var s=this.xw.bs(t);this.xw.ps(t),s.forEach(function(t){n.xw.ys(t)||n.tm(t)})}},jp.prototype.tm=function(t){var e=this.Ow.get(t);null!==e&&(this.Tw.Zd(e),this.Ow=this.Ow.remove(t),delete this.Fw[e])},jp.prototype.Gw=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof wp?(this.xw.ls(i.key,t),this.nm(i)):i instanceof bp?(Mr("SyncEngine","Document no longer in limbo: "+i.key),this.xw.vs(i.key,t),this.xw.ys(i.key)||this.tm(i.key)):Fr("Unknown limbo change: "+JSON.stringify(i))}},jp.prototype.nm=function(t){var e=t.key;if(!this.Ow.get(e)){Mr("SyncEngine","New document in limbo: "+e);var n=this.Lw.next(),r=wa.ei(e.path);this.Fw[n]=new Sp(e),this.Tw.listen(new za(r.wi(),n,fa.Ci,Xu.bu)),this.Ow=this.Ow.gt(e,n)}},jp.prototype.im=function(){return this.Ow},jp.prototype.Kw=function(r,u){return p(this,void 0,void 0,function(){var o,s,e,a=this;return y(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.kw.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.dw(r);return n.bf?a.Oc.ic(i.query,!1).then(function(t){var e=t.documents;return i.view.dw(e,n)}):n}).then(function(t){var e=u&&u.$i[i.targetId],n=i.view.Qs(t,!0===a.isPrimary,e);if(a.Gw(i.targetId,n.gw),n.snapshot){a.isPrimary&&a.Cw.zv(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=tc.fh(i.targetId,n.snapshot);s.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.Vw.Tl(o),[4,this.Oc.Hh(s)];case 2:return t.sent(),[2]}})})},jp.prototype.Mw=function(t){jr(null!==this.Vw,"Trying to call "+t+" before calling subscribe().")},jp.prototype.wv=function(r){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.$w("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.Oc.Ph(r)]):[3,3];case 1:return n=t.sent(),this.Cw.Ph(r,n.Ch,n.Vh),[4,this.Kw(n.Sh)];case 2:t.sent(),t.label=3;case 3:return[4,this.Tw.wv()];case 4:return t.sent(),[2]}})})},jp.prototype.mv=function(u){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a=this;return y(this,function(t){switch(t.label){case 0:return!0!==u||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.Tw.mv(!0)]);case 1:return t.sent(),o=this.Cw.Fv(),[4,this.em(o.ut())];case 2:for(e=t.sent(),n=0,r=e;n<r.length;n++)i=r[n],this.Tw.listen(i);return[3,7];case 3:return!1!==u||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,o=[],s=Promise.resolve(),gi(this.Nw,function(t,e){a.Cw.Gv(t)?o.push(t):s=s.then(function(){return a.Ww(t),a.Oc.nc(t,!0)}),a.Tw.Zd(t)}),[4,s]);case 4:return t.sent(),[4,this.em(o)];case 5:return t.sent(),this.rm(),[4,this.Tw.mv(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},jp.prototype.rm=function(){var e=this;gi(this.Fw,function(t){e.Tw.Zd(t)}),this.xw.gs(),this.Fw=[],this.Ow=new Zi(Qi.Y)},jp.prototype.em=function(d){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,h,c,f,l,p;return y(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(a=this.Nw[o])&&0!==a.length?[4,this.Oc.nc(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.Oc.Xh(a[0].wi())];case 3:s=t.sent(),u=0,h=a,t.label=4;case 4:return u<h.length?(c=h[u],jr(!!(f=this.kw.get(c)),"No query view found for "+c),[4,this.Qw(f)]):[3,7];case 5:(l=t.sent()).snapshot&&n.push(l.snapshot),t.label=6;case 6:return u++,[3,4];case 7:return[3,12];case 8:return jr(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.Oc.fc(o)];case 9:return jr(!!(p=t.sent()),"Target for id "+o+" not found"),[4,this.Oc.Xh(p)];case 10:return s=t.sent(),[4,this.qw(this.um(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(s),t.label=13;case 13:return r++,[3,1];case 14:return this.Vw.Tl(n),[2,e]}})})},jp.prototype.um=function(t){return new wa(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,aa.Yn,t.startAt,t.endAt)},jp.prototype.sc=function(){return this.Oc.sc()},jp.prototype.rw=function(r,i,o){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:if(this.isPrimary)return Mr("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.Nw[r])return[3,7];switch(i){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.Oc.lc()];case 2:return e=t.sent(),n=bu.ie(r,"current"===i),[4,this.Kw(e,n)];case 3:return t.sent(),[3,7];case 4:return[4,this.Oc.nc(r,!0)];case 5:return t.sent(),this.Ww(r,o),[3,7];case 6:Fr("Unexpected target state: "+i),t.label=7;case 7:return[2]}})})},jp.prototype.uw=function(f,l){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,h,c=this;return y(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];e=0,n=f,t.label=1;case 1:return e<n.length?(h=n[e],jr(!this.Nw[h],"Trying to add an already active target"),[4,this.Oc.fc(h)]):[3,6];case 2:return jr(!!(r=t.sent()),"Query data for active target "+h+" not found"),[4,this.Oc.Xh(r)];case 3:return i=t.sent(),[4,this.qw(this.um(r),i.targetId,!1)];case 4:t.sent(),this.Tw.listen(i),t.label=5;case 5:return e++,[3,1];case 6:o=function(e){return y(this,function(t){switch(t.label){case 0:return s.Nw[e]?[4,s.Oc.nc(e,!1).then(function(){c.Tw.Zd(e),c.Ww(e)}).catch(ac)]:[2,"continue"];case 1:return t.sent(),[2]}})},s=this,a=0,u=l,t.label=7;case 7:return a<u.length?(h=u[a],[5,o(h)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})},jp.prototype.enableNetwork=function(){return this.Oc.hc(!0),this.Tw.enableNetwork()},jp.prototype.disableNetwork=function(){return this.Oc.hc(!1),this.Tw.disableNetwork()},jp.prototype.He=function(t){var e=this.Fw[t];if(e&&e.Sw)return ou().add(e.key);var n=ou(),r=this.Nw[t];if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],a=this.kw.get(s);jr(!!a,"No query view found for "+s),n=n.Kt(a.view.lw)}return n},jp),Op=(Fp.prototype.listen=function(t){var e=t.query,n=!1,r=this.om.get(e);return r||(n=!0,r=new kp,this.om.set(e,r)),r.listeners.push(t),jr(!t.bw(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),r.sm&&t.cm(r.sm)&&this.am(),n?this.nv.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},Fp.prototype.Zd=function(o){return p(this,void 0,void 0,function(){var e,n,r,i;return y(this,function(t){return e=o.query,n=!1,(r=this.om.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.om.delete(e),[2,this.nv.Zd(e)]):[2]})})},Fp.prototype.Tl=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.om.get(o);if(s){for(var a=0,u=s.listeners;a<u.length;a++)u[a].cm(i)&&(e=!0);s.sm=i}}e&&this.am()},Fp.prototype.Zw=function(t,e){var n=this.om.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.om.delete(t)},Fp.prototype.Hw=function(i){this.onlineState=i;var o=!1;this.om.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].bw(i)&&(o=!0)}),o&&this.am()},Fp.prototype.fm=function(t){this.hm.add(t),t.next()},Fp.prototype.lm=function(t){this.hm.delete(t)},Fp.prototype.am=function(){this.hm.forEach(function(t){t.next()})},Fp),Cp=(qp.prototype.cm=function(t){if(jr(0<t.docChanges.length||t.Ji,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==uu.qi&&e.push(i)}t=new wu(t.query,t.docs,t.Ki,e,t.Hi,t.fromCache,t.Ji,!0)}var o=!1;return this.vm?this.mm(t)&&(this.dm.next(t),o=!0):this.pm(t,this.onlineState)&&(this.gm(t),o=!0),this.wm=t,o},qp.prototype.onError=function(t){this.dm.error(t)},qp.prototype.bw=function(t){this.onlineState=t;var e=!1;return this.wm&&!this.vm&&this.pm(this.wm,t)&&(this.gm(this.wm),e=!0),e},qp.prototype.pm=function(t,e){if(jr(!this.vm,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==Qr.m;return this.options.bm&&n?(jr(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.tt()||e===Qr.m},qp.prototype.mm=function(t){if(0<t.docChanges.length)return!0;var e=this.wm&&this.wm.hasPendingWrites!==t.hasPendingWrites;return!(!t.Ji&&!e)&&!0===this.options.includeMetadataChanges},qp.prototype.gm=function(t){jr(!this.vm,"Trying to raise initial events for second time"),t=wu.Xi(t.query,t.docs,t.Hi,t.fromCache),this.vm=!0,this.dm.next(t)},qp),xp=(Vp.prototype.La=function(){return fc.Ac(this.cacheSizeBytes)},Vp),Lp=(Mp.prototype.start=function(t){var n=this;this._m();var r=new Qu,i=new Qu,o=!1;return this.credentials.S(function(e){o?n.Su.Uu(function(){return n.wv(e)}):(o=!0,n.Im(t,i,e).then(function(t){return n.Tm(e,t)}).then(r.resolve,r.reject))}),this.Su.Uu(function(){return r.promise}),i.promise},Mp.prototype.enableNetwork=function(){var t=this;return this._m(),this.Su.enqueue(function(){return t.nv.enableNetwork()})},Mp.prototype.Im=function(t,e,n){var r=this;return t instanceof xp?this.Em(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.Rm(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.Am()}):(e.resolve(),this.Am())},Mp.prototype.Rm=function(t){return t instanceof oi?t.code===ii.FAILED_PRECONDITION||t.code===ii.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Mp.prototype._m=function(){if(this.Su.Wu)throw new oi(ii.FAILED_PRECONDITION,"The client has already been terminated.")},Mp.prototype.Em=function(r,i){var t=this,o=Ef.ff(this.ym),s=new Fu(this.ym.s,{Xe:!0});return Promise.resolve().then(function(){return p(t,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:if(i.synchronizeTabs&&!lp.Js(this.platform))throw new oi(ii.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return e=i.La(),this.Cw=i.synchronizeTabs?new lp(this.Su,this.platform,o,this.clientId,r):new Ep,[4,Ef.Ua({allowTabSynchronization:i.synchronizeTabs,persistenceKey:o,clientId:this.clientId,platform:this.platform,Da:this.Su,serializer:s,La:e,Pa:this.Cw})];case 1:return n=t.sent(),[2,(this.persistence=n).wo.Nc]}})})})},Mp.prototype.Am=function(){return this.persistence=qf.Of(this.clientId),this.Cw=new Ep,Promise.resolve(null)},Mp.prototype.Tm=function(h,c){var t=this;return Mr("FirestoreClient","Initializing. user=",h.uid),this.platform.Dm(this.ym).then(function(u){return p(t,void 0,void 0,function(){var e,n,r,i,o,s,a=this;return y(this,function(t){switch(t.label){case 0:return e=new Rf,this.Oc=new nc(this.persistence,e,h),[4,this.Oc.start()];case 1:return t.sent(),c&&(this.Pm=new lc(c,this.Su,this.Oc)),n=this.platform.Sm(),r=this.platform.Cm(this.ym.s),i=new rl(this.Su,u,this.credentials,r),o=function(t){return a.nv.bw(t,Kr.p)},s=function(t){return a.nv.bw(t,Kr.g)},this.Tw=new Kl(this.Oc,i,this.Su,o,n),this.nv=new _p(this.Oc,this.Tw,this.Cw,h),this.Cw.Id=s,this.Tw.nv=this.nv,this.Cw.nv=this.nv,this.Vm=new Op(this.nv),[4,this.Cw.start()];case 2:return t.sent(),[4,this.Tw.start()];case 3:return t.sent(),[4,this.persistence.za(function(e){return p(a,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.nv.mv(e)];case 1:return t.sent(),this.Pm&&(e&&!this.Pm.ph?this.Pm.start():e||this.Pm.stop()),[2]}})})})];case 4:return t.sent(),[4,this.persistence.Ka(function(){return p(a,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})})];case 5:return t.sent(),[2]}})})})},Mp.prototype.wv=function(t){return this.Su.Zu(),Mr("FirestoreClient","Credential Changed. Current user: "+t.uid),this.nv.wv(t)},Mp.prototype.disableNetwork=function(){var t=this;return this._m(),this.Su.enqueue(function(){return t.nv.disableNetwork()})},Mp.prototype.terminate=function(){var t=this;return this.Su.Yu(function(){return p(t,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.Pm&&this.Pm.stop(),[4,this.Tw.shutdown()];case 1:return t.sent(),[4,this.Cw.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.C(),[2]}})})})},Mp.prototype.waitForPendingWrites=function(){var t=this;this._m();var e=new Qu;return this.Su.Uu(function(){return t.nv.Xw(e)}),e.promise},Mp.prototype.listen=function(t,e,n){var r=this;this._m();var i=new Cp(t,e,n);return this.Su.Uu(function(){return r.Vm.listen(i)}),i},Mp.prototype.Zd=function(t){var e=this;this.km||this.Su.Uu(function(){return e.Vm.Zd(t)})},Mp.prototype.Nm=function(t){var e=this;return this._m(),this.Su.enqueue(function(){return e.Oc.Yh(t)}).then(function(t){if(t instanceof Vs)return t;if(t instanceof qs)return null;throw new oi(ii.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},Mp.prototype.Om=function(i){var t=this;return this._m(),this.Su.enqueue(function(){return p(t,void 0,void 0,function(){var e,n,r;return y(this,function(t){switch(t.label){case 0:return[4,this.Oc.ic(i,!0)];case 1:return e=t.sent(),n=new Ip(i,e.rc),r=n.dw(e.documents),[2,n.Qs(r,!1).snapshot]}})})})},Mp.prototype.write=function(t){var e=this;this._m();var n=new Qu;return this.Su.Uu(function(){return e.nv.write(t,n)}),n.promise},Mp.prototype.s=function(){return this.ym.s},Mp.prototype.fm=function(t){var e=this;this._m(),this.Su.Uu(function(){return e.Vm.fm(t),Promise.resolve()})},Mp.prototype.lm=function(t){this.km||this.Vm.lm(t)},Object.defineProperty(Mp.prototype,"km",{get:function(){return this.Su.Wu},enumerable:!0,configurable:!0}),Mp.prototype.transaction=function(t){var e=this;this._m();var n=new Qu;return this.Su.Uu(function(){return e.nv.runTransaction(e.Su,t,n),Promise.resolve()}),n.promise},Mp),Pp=(Up.prototype.next=function(t){this.Fm(this.observer.next,t)},Up.prototype.error=function(t){this.Fm(this.observer.error,t)},Up.prototype.xm=function(){this.muted=!0},Up.prototype.Fm=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Up);function Up(t){this.observer=t,this.muted=!1}function Mp(t,e,n,r){this.platform=t,this.ym=e,this.credentials=n,this.Su=r,this.clientId=Br.u()}function Vp(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}function qp(t,e,n){this.query=t,this.dm=e,this.vm=!1,this.wm=null,this.onlineState=Qr.l,this.options=n||{}}function Fp(t){this.nv=t,this.om=new gh(function(t){return t.canonicalId()}),this.onlineState=Qr.l,this.hm=new Set,this.nv.subscribe(this)}function jp(t,e,n,r){this.Oc=t,this.Tw=e,this.Cw=n,this.currentUser=r,this.Vw=null,this.kw=new gh(function(t){return t.canonicalId()}),this.Nw={},this.Ow=new Zi(Qi.Y),this.Fw={},this.xw=new vh,this.jw={},this.Uw=new Map,this.Lw=$h.Ho(),this.isPrimary=void 0,this.onlineState=Qr.l}function Bp(t,e,n,r){this.Su=t,this.Tw=e,this.updateFunction=n,this.Nu=r,this.Ew=5,this.sl=new Gf(this.Su,Zu.Pu)}function Gp(i){return function(){if("object"!=typeof i||null===i)return!1;for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return!0}return!1}()}var Yp,zp=fc.Sc,Wp=(fd.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},fd),Hp=(cd.prototype.settings=function(t){if(Ii("Firestore.settings",arguments,1),Ai("Firestore.settings","object",1,t),vi(t,"persistence"))throw new oi(ii.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Wp(t);if(this.Bm&&!this.Wm.isEqual(e))throw new oi(ii.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.Wm=e).credentials&&(this.Gm=function(t){if(!t)return new si;switch(t.type){case"gapi":var e=t.L;return jr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new hi(e,t.j||"0");case"provider":return t.L;default:throw new oi(ii.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},cd.prototype.enableNetwork=function(){return this.Lm(),this.Bm.enableNetwork()},cd.prototype.disableNetwork=function(){return this.Lm(),this.Bm.disableNetwork()},cd.prototype.enablePersistence=function(t){if(this.Bm)throw new oi(ii.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Vr("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=mi(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.Hm(new xp(this.Wm.cacheSizeBytes,e))},cd.prototype.clearPersistence=function(){var t=this,n=Ef.ff(this.Jm()),r=new Qu;return this.Um.zu(function(){return p(t,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),void 0!==this.Bm&&!this.Bm.km)throw new oi(ii.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,Ef.clearPersistence(n)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise},cd.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(cd.prototype,"Ym",{get:function(){return this.Lm(),this.Bm.km},enumerable:!0,configurable:!0}),cd.prototype.waitForPendingWrites=function(){return this.Lm(),this.Bm.waitForPendingWrites()},cd.prototype.onSnapshotsInSync=function(t){if(this.Lm(),Gp(t))return this.Xm(t);Ai("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.Xm(e)},cd.prototype.Xm=function(t){var e=this,n=new Pp({next:function(){t.next&&t.next()},error:function(t){throw Fr("Uncaught Error in onSnapshotsInSync")}});return this.Bm.fm(n),function(){n.xm(),e.Bm.lm(n)}},cd.prototype.Lm=function(){return this.Bm||this.Hm(new Dp),this.Bm},cd.prototype.Jm=function(){return new Hr(this.Mm,this.Qm,this.Wm.host,this.Wm.ssl,this.Wm.forceLongPolling)},cd.prototype.Hm=function(t){jr(!!this.Wm.host,"FirestoreSettings.host is not set"),jr(!this.Bm,"configureClient() called multiple times");var e=this.Jm();return this.Bm=new Lp(ju.t(),e,this.Gm,this.Um),this.Bm.start(t)},cd.prototype.Km=function(r){return new ql(function(t){if(t instanceof Kp){var e=r,n=t.firestore.Mm;if(!n.isEqual(e))throw new oi(ii.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new Vl(r,t.$m)}return t})},cd.qm=function(t){var e=t.options;if(!vi(e,"projectId"))throw new oi(ii.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new oi(ii.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Xr(n)},Object.defineProperty(cd.prototype,"app",{get:function(){if(!this.jm)throw new oi(ii.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.jm},enumerable:!0,configurable:!0}),cd.prototype.collection=function(t){return Ii("Firestore.collection",arguments,1),Ai("Firestore.collection","non-empty string",1,t),this.Lm(),new pd(zi.ot(t),this)},cd.prototype.doc=function(t){return Ii("Firestore.doc",arguments,1),Ai("Firestore.doc","non-empty string",1,t),this.Lm(),Kp.Zm(zi.ot(t),this)},cd.prototype.collectionGroup=function(t){if(Ii("Firestore.collectionGroup",arguments,1),Ai("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new oi(ii.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.Lm(),new td(new wa(zi.ht,t),this)},cd.prototype.runTransaction=function(e){var n=this;return Ii("Firestore.runTransaction",arguments,1),Ai("Firestore.runTransaction","function",1,e),this.Lm().transaction(function(t){return e(new Qp(n,t))})},cd.prototype.batch=function(){return this.Lm(),new Zp(this)},Object.defineProperty(cd,"logLevel",{get:function(){switch(Pr()){case Ar.DEBUG:return"debug";case Ar.ERROR:return"error";case Ar.SILENT:return"silent";default:return Fr("Unknown log level: "+Pr())}},enumerable:!0,configurable:!0}),cd.setLogLevel=function(t){switch(Ii("Firestore.setLogLevel",arguments,1),Ai("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Ur(Ar.DEBUG);break;case"error":Ur(Ar.ERROR);break;case"silent":Ur(Ar.SILENT);break;default:throw new oi(ii.INVALID_ARGUMENT,"Invalid log level: "+t)}},cd.prototype.tp=function(){return this.Wm.timestampsInSnapshots},cd),Qp=(hd.prototype.get=function(t){var n=this;Ii("Transaction.get",arguments,1);var r=gd("Transaction.get",t,this.np);return this.ip.lookup([r.$m]).then(function(t){if(!t||1!==t.length)return Fr("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof qs)return new $p(n.np,r.$m,null,!1,!1,r.ep);if(e instanceof Vs)return new $p(n.np,r.$m,e,!1,!1,r.ep);throw Fr("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},hd.prototype.set=function(t,e,n){Ni("Transaction.set",arguments,2,3);var r=gd("Transaction.set",t,this.np);n=yd("Transaction.set",n);var i=wd(r.ep,e,"Transaction.set"),o=i[0],s=i[1],a=n.merge||n.mergeFields?this.np.zm.ed(s,o,n.mergeFields):this.np.zm.td(s,o);return this.ip.set(r.$m,a),this},hd.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof il?(Ti("Transaction.update",arguments,3),r=gd("Transaction.update",t,this.np),this.np.zm.sd("Transaction.update",e,n,o)):(Ii("Transaction.update",arguments,2),r=gd("Transaction.update",t,this.np),this.np.zm.rd("Transaction.update",e)),this.ip.update(r.$m,i),this},hd.prototype.delete=function(t){Ii("Transaction.delete",arguments,1);var e=gd("Transaction.delete",t,this.np);return this.ip.delete(e.$m),this},hd),Zp=(ud.prototype.set=function(t,e,n){Ni("WriteBatch.set",arguments,2,3),this.sp();var r=gd("WriteBatch.set",t,this.np);n=yd("WriteBatch.set",n);var i=wd(r.ep,e,"WriteBatch.set"),o=i[0],s=i[1],a=n.merge||n.mergeFields?this.np.zm.ed(s,o,n.mergeFields):this.np.zm.td(s,o);return this.rp=this.rp.concat(a.Bl(r.$m,Fo.NONE)),this},ud.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.sp(),i="string"==typeof e||e instanceof il?(Ti("WriteBatch.update",arguments,3),r=gd("WriteBatch.update",t,this.np),this.np.zm.sd("WriteBatch.update",e,n,o)):(Ii("WriteBatch.update",arguments,2),r=gd("WriteBatch.update",t,this.np),this.np.zm.rd("WriteBatch.update",e)),this.rp=this.rp.concat(i.Bl(r.$m,Fo.exists(!0))),this},ud.prototype.delete=function(t){Ii("WriteBatch.delete",arguments,1),this.sp();var e=gd("WriteBatch.delete",t,this.np);return this.rp=this.rp.concat(new zo(e.$m,Fo.NONE)),this},ud.prototype.commit=function(){return p(this,void 0,void 0,function(){return y(this,function(t){return this.sp(),this.up=!0,0<this.rp.length?[2,this.np.Lm().write(this.rp)]:[2]})})},ud.prototype.sp=function(){if(this.up)throw new oi(ii.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},ud),Kp=(ad.Zm=function(t,e,n){if(t.length%2!=0)throw new oi(ii.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.st()+" has "+t.length);return new ad(new Qi(t),e,n)},Object.defineProperty(ad.prototype,"id",{get:function(){return this.$m.path.it()},enumerable:!0,configurable:!0}),Object.defineProperty(ad.prototype,"parent",{get:function(){return new pd(this.$m.path.Z(),this.firestore,this.ep)},enumerable:!0,configurable:!0}),Object.defineProperty(ad.prototype,"path",{get:function(){return this.$m.path.st()},enumerable:!0,configurable:!0}),ad.prototype.collection=function(t){if(Ii("DocumentReference.collection",arguments,1),Ai("DocumentReference.collection","non-empty string",1,t),!t)throw new oi(ii.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=zi.ot(t);return new pd(this.$m.path.child(e),this.firestore)},ad.prototype.isEqual=function(t){if(!(t instanceof ad))throw Pi("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.$m.isEqual(t.$m)&&this.ep===t.ep},ad.prototype.set=function(t,e){Ni("DocumentReference.set",arguments,1,2),e=yd("DocumentReference.set",e);var n=wd(this.ep,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore.zm.ed(i,r,e.mergeFields):this.firestore.zm.td(i,r);return this.Bm.write(o.Bl(this.$m,Fo.NONE))},ad.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof il?(Ti("DocumentReference.update",arguments,2),this.firestore.zm.sd("DocumentReference.update",t,e,r)):(Ii("DocumentReference.update",arguments,1),this.firestore.zm.rd("DocumentReference.update",t)),this.Bm.write(n.Bl(this.$m,Fo.exists(!0)))},ad.prototype.delete=function(){return Ii("DocumentReference.delete",arguments,0),this.Bm.write([new zo(this.$m,Fo.NONE)])},ad.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ni("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||Gp(t[i])||(Li("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Di("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=Gp(t[i])?t[i]:(Ai("DocumentReference.onSnapshot","function",i,t[i]),Si("DocumentReference.onSnapshot","function",i+1,t[i+1]),Si("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.hp(o,n)},ad.prototype.hp=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new Pp({next:function(t){if(n.next){jr(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(r.$m);n.next(new $p(r.firestore,r.$m,e,t.fromCache,t.hasPendingWrites,r.ep))}},error:e}),o=this.Bm.listen(wa.ei(this.$m.path),i,t);return function(){i.xm(),r.Bm.Zd(o)}},ad.prototype.get=function(n){var r=this;return Ni("DocumentReference.get",arguments,0,1),md("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.Lm().Nm(r.$m).then(function(t){e(new $p(r.firestore,r.$m,t,!0,t instanceof Vs&&t.an,r.ep))},t):r.cp(e,t,n)})},ad.prototype.cp=function(e,n,r){var i=this.hp({includeMetadataChanges:!0,bm:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new oi(ii.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new oi(ii.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},ad.prototype.withConverter=function(t){return new ad(this.$m,this.firestore,t)},ad),Jp=(sd.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},sd),$p=(od.prototype.data=function(t){if(Ni("DocumentSnapshot.data",arguments,0,1),t=vd("DocumentSnapshot.data",t),this.ap){if(this.ep){var e=new Xp(this.np,this.$m,this.ap,this.fp,this.lp);return this.ep.fromFirestore(e,t)}return this.dp(this.ap.data(),rs.kn(t,this.np.tp()))}},od.prototype.get=function(t,e){if(Ni("DocumentSnapshot.get",arguments,1,2),e=vd("DocumentSnapshot.get",e),this.ap){var n=this.ap.data().field(Yl("DocumentSnapshot.get",t));if(null!==n)return this.vp(n,rs.kn(e,this.np.tp()))}},Object.defineProperty(od.prototype,"id",{get:function(){return this.$m.path.it()},enumerable:!0,configurable:!0}),Object.defineProperty(od.prototype,"ref",{get:function(){return new Kp(this.$m,this.np,this.ep)},enumerable:!0,configurable:!0}),Object.defineProperty(od.prototype,"exists",{get:function(){return null!==this.ap},enumerable:!0,configurable:!0}),Object.defineProperty(od.prototype,"metadata",{get:function(){return new Jp(this.lp,this.fp)},enumerable:!0,configurable:!0}),od.prototype.isEqual=function(t){if(!(t instanceof od))throw Pi("isEqual","DocumentSnapshot",1,t);return this.np===t.np&&this.fp===t.fp&&this.$m.isEqual(t.$m)&&(null===this.ap?null===t.ap:this.ap.isEqual(t.ap))&&this.ep===t.ep},od.prototype.dp=function(t,n){var r=this,i={};return t.forEach(function(t,e){i[t]=r.vp(e,n)}),i},od.prototype.vp=function(t,e){if(t instanceof Ps)return this.dp(t,e);if(t instanceof Us)return this.wp(t,e);if(t instanceof xs){var n=t.value(e),r=this.np.Lm().s();return t.s.isEqual(r)||Vr("Document "+this.$m.path+" contains a document reference within a different database ("+t.s.projectId+"/"+t.s.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new Kp(n,this.np,this.ep)}return t.value(e)},od.prototype.wp=function(t,e){var n=this;return t.Zt.map(function(t){return n.vp(t,e)})},od),Xp=(t(id,Yp=$p),id.prototype.data=function(t){var e=Yp.prototype.data.call(this,t);return jr(void 0!==e,"Document in a QueryDocumentSnapshot should exist"),e},id),td=(rd.prototype.where=function(t,e,n){var r;Ii("Query.where",arguments,3),xi("Query.where",3,n),function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new oi(ii.INVALID_ARGUMENT,"Invalid value "+Ci(r)+" provided to function "+t+"() for its "+Mi(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e);var i=Yl("Query.where",t),o=ba.ot(e);if(i.at()){if(o===ba.ARRAY_CONTAINS||o===ba.ARRAY_CONTAINS_ANY)throw new oi(ii.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===ba.IN){this.pp(n,o);for(var s=[],a=0,u=n;a<u.length;a++){var h=u[a];s.push(this.gp(h))}r=new Us(s)}else r=this.gp(n)}else o!==ba.IN&&o!==ba.ARRAY_CONTAINS_ANY||this.pp(n,o),r=this.firestore.zm.od("Query.where",n,o===ba.IN);var c=Ea.create(i,o,r);return this.bp(c),new rd(this.mp.si(c),this.firestore,this.ep)},rd.prototype.orderBy=function(t,e){var n;if(Ni("Query.orderBy",arguments,1,2),Si("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=ka.ASCENDING;else{if("desc"!==e)throw new oi(ii.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=ka.DESCENDING}if(null!==this.mp.startAt)throw new oi(ii.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.mp.endAt)throw new oi(ii.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=Yl("Query.orderBy",t),i=new Ra(r,n);return this.yp(i),new rd(this.mp.hi(i),this.firestore,this.ep)},rd.prototype.limit=function(t){return Ii("Query.limit",arguments,1),Ai("Query.limit","number",1,t),Ui("Query.limit",1,t),new rd(this.mp.ci(t),this.firestore,this.ep)},rd.prototype.limitToLast=function(t){return Ii("Query.limitToLast",arguments,1),Ai("Query.limitToLast","number",1,t),Ui("Query.limitToLast",1,t),new rd(this.mp.ai(t),this.firestore,this.ep)},rd.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ti("Query.startAt",arguments,1);var r=this._p("Query.startAt",t,e,!0);return new rd(this.mp.fi(r),this.firestore,this.ep)},rd.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ti("Query.startAfter",arguments,1);var r=this._p("Query.startAfter",t,e,!1);return new rd(this.mp.fi(r),this.firestore,this.ep)},rd.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ti("Query.endBefore",arguments,1);var r=this._p("Query.endBefore",t,e,!0);return new rd(this.mp.li(r),this.firestore,this.ep)},rd.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ti("Query.endAt",arguments,1);var r=this._p("Query.endAt",t,e,!1);return new rd(this.mp.li(r),this.firestore,this.ep)},rd.prototype.isEqual=function(t){if(!(t instanceof rd))throw Pi("isEqual","Query",1,t);return this.firestore===t.firestore&&this.mp.isEqual(t.mp)},rd.prototype.withConverter=function(t){return new rd(this.mp,this.firestore,t)},rd.prototype._p=function(t,e,n,r){if(xi(t,1,e),e instanceof $p){if(0<n.length)throw new oi(ii.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new oi(ii.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.Ip(t,i.ap,r)}var o=[e].concat(n);return this.Tp(t,o,r)},rd.prototype.Ip=function(t,e,n){for(var r=[],i=0,o=this.mp.orderBy;i<o.length;i++){var s=o[i];if(s.field.at())r.push(new xs(this.firestore.Mm,e.key));else{var a=e.field(s.field);if(a instanceof Os)throw new oi(ii.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){var u=s.field.st();throw new oi(ii.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(a)}}return new Da(r,n)},rd.prototype.Tp=function(t,e,n){var r=this.mp.$n;if(e.length>r.length)throw new oi(ii.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.at()){if("string"!=typeof s)throw new oi(ii.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.mp.Ei()&&-1!==s.indexOf("/"))throw new oi(ii.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var a=this.mp.path.child(zi.ot(s));if(!Qi.dt(a))throw new oi(ii.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+a+"' is not because it contains an odd number of segments.");var u=new Qi(a);i.push(new xs(this.firestore.Mm,u))}else{var h=this.firestore.zm.od(t,s);i.push(h)}}return new Da(i,n)},rd.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ni("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||Gp(t[i])||(Li("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Di("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=Gp(t[i])?t[i]:(Ai("Query.onSnapshot","function",i,t[i]),Si("Query.onSnapshot","function",i+1,t[i+1]),Si("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.Ep(this.mp),this.hp(r,n)},rd.prototype.hp=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Pp({next:function(t){e.next&&e.next(new ed(n.firestore,n.mp,t,n.ep))},error:r}),o=this.firestore.Lm(),s=o.listen(this.mp,i,t);return function(){i.xm(),o.Zd(s)}},rd.prototype.Ep=function(t){if(t.Ii()&&0===t.$n.length)throw new oi(ii.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},rd.prototype.get=function(n){var r=this;return Ni("Query.get",arguments,0,1),md("Query.get",n),this.Ep(this.mp),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.Lm().Om(r.mp).then(function(t){e(new ed(r.firestore,r.mp,t,r.ep))},t):r.cp(e,t,n)})},rd.prototype.cp=function(e,n,r){var i=this.hp({includeMetadataChanges:!0,bm:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new oi(ii.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},rd.prototype.gp=function(t){if("string"==typeof t){if(""===t)throw new oi(ii.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.mp.Ei()&&-1!==t.indexOf("/"))throw new oi(ii.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.mp.path.child(zi.ot(t));if(!Qi.dt(e))throw new oi(ii.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new xs(this.firestore.Mm,new Qi(e))}if(t instanceof Kp){var n=t;return new xs(this.firestore.Mm,n.$m)}throw new oi(ii.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ci(t)+".")},rd.prototype.pp=function(t,e){if(!Array.isArray(t)||0===t.length)throw new oi(ii.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new oi(ii.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new oi(ii.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new oi(ii.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},rd.prototype.bp=function(t){if(t instanceof Ea){var e=[ba.ARRAY_CONTAINS,ba.ARRAY_CONTAINS_ANY],n=[ba.IN,ba.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.oi()){var o=this.mp.ri();if(null!==o&&!o.isEqual(t.field))throw new oi(ii.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.mp.ui();null!==s&&this.Rp(t.field,s)}else if(i||r){var a=null;if(i&&(a=this.mp.Ti(n)),null===a&&r&&(a=this.mp.Ti(e)),null!=a)throw a===t.op?new oi(ii.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new oi(ii.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+a.toString()+"' filters.")}}},rd.prototype.yp=function(t){if(null===this.mp.ui()){var e=this.mp.ri();null!==e&&this.Rp(e,t.field)}},rd.prototype.Rp=function(t,e){if(!e.isEqual(t))throw new oi(ii.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},rd),ed=(Object.defineProperty(nd.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(nd.prototype,"empty",{get:function(){return this.Dp.docs.tt()},enumerable:!0,configurable:!0}),Object.defineProperty(nd.prototype,"size",{get:function(){return this.Dp.docs.size},enumerable:!0,configurable:!0}),nd.prototype.forEach=function(e,n){var r=this;Ni("QuerySnapshot.forEach",arguments,1,2),Ai("QuerySnapshot.forEach","function",1,e),this.Dp.docs.forEach(function(t){e.call(n,r.Cp(t))})},Object.defineProperty(nd.prototype,"query",{get:function(){return new td(this.Ap,this.np,this.ep)},enumerable:!0,configurable:!0}),nd.prototype.docChanges=function(t){t&&(Li("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Di("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.Dp.Yi)throw new oi(ii.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Pp&&this.Sp===e||(this.Pp=function(i,e,o,s){if(o.Ki.tt()){var n,r=0;return o.docChanges.map(function(t){var e=new Xp(i,t.doc.key,t.doc,o.fromCache,o.Hi.has(t.doc.key),s);return jr(t.type===uu.Li,"Invalid event type for first snapshot"),jr(!n||o.query.mi(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:r++}})}var a=o.Ki;return o.docChanges.filter(function(t){return e||t.type!==uu.qi}).map(function(t){var e=new Xp(i,t.doc.key,t.doc,o.fromCache,o.Hi.has(t.doc.key),s),n=-1,r=-1;return t.type!==uu.Li&&(jr(0<=(n=a.indexOf(t.doc.key)),"Index for document not found"),a=a.delete(t.doc.key)),t.type!==uu.Bi&&(r=(a=a.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case uu.Li:return"added";case uu.Mi:case uu.qi:return"modified";case uu.Bi:return"removed";default:return Fr("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.np,e,this.Dp,this.ep),this.Sp=e),this.Pp},nd.prototype.isEqual=function(t){if(!(t instanceof nd))throw Pi("isEqual","QuerySnapshot",1,t);return this.np===t.np&&this.Ap.isEqual(t.Ap)&&this.Dp.isEqual(t.Dp)&&this.ep===t.ep},nd.prototype.Cp=function(t){return new Xp(this.np,t.key,t,this.metadata.fromCache,this.Dp.Hi.has(t.key),this.ep)},nd);function nd(t,e,n,r){this.np=t,this.Ap=e,this.Dp=n,this.ep=r,this.Pp=null,this.Sp=null,this.metadata=new Jp(n.hasPendingWrites,n.fromCache)}function rd(t,e,n){this.mp=t,this.firestore=e,this.ep=n}function id(){return null!==Yp&&Yp.apply(this,arguments)||this}function od(t,e,n,r,i,o){this.np=t,this.$m=e,this.ap=n,this.fp=r,this.lp=i,this.ep=o}function sd(t,e){this.hasPendingWrites=t,this.fromCache=e}function ad(t,e,n){this.$m=t,this.firestore=e,this.ep=n,this.Bm=this.firestore.Lm()}function ud(t){this.np=t,this.rp=[],this.up=!1}function hd(t,e){this.np=t,this.ip=e}function cd(t,e){var n=this;if(this.jm=null,this.Um=new rh,this.INTERNAL={delete:function(){return p(n,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.Lm(),[4,this.Bm.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var r=t;this.jm=r,this.Mm=cd.qm(r),this.Qm=r.name,this.Gm=new ai(e)}else{var i=t;if(!i.projectId)throw new oi(ii.INVALID_ARGUMENT,"Must provide projectId");this.Mm=new Xr(i.projectId,i.database),this.Qm="[DEFAULT]",this.Gm=new si}this.Wm=new Wp({}),this.zm=this.Km(this.Mm)}function fd(t){if(void 0===t.host){if(void 0!==t.ssl)throw new oi(ii.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else ki("settings","non-empty string","host",t.host),this.host=t.host,Di("settings","boolean","ssl",t.ssl),this.ssl=mi(t.ssl,!0);if(Li("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Di("settings","object","credentials",t.credentials),this.credentials=t.credentials,Di("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Vr("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Vr("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=mi(t.timestampsInSnapshots,!0),Di("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=fc.Vc;else{if(t.cacheSizeBytes!==zp&&t.cacheSizeBytes<fc.Cc)throw new oi(ii.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+fc.Cc);this.cacheSizeBytes=t.cacheSizeBytes}Di("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}s(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(ed.prototype.docChanges,t,{get:function(){return function(){throw new oi(ii.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var ld,pd=(t(dd,ld=td),Object.defineProperty(dd.prototype,"id",{get:function(){return this.mp.path.it()},enumerable:!0,configurable:!0}),Object.defineProperty(dd.prototype,"parent",{get:function(){var t=this.mp.path.Z();return t.tt()?null:new Kp(new Qi(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(dd.prototype,"path",{get:function(){return this.mp.path.st()},enumerable:!0,configurable:!0}),dd.prototype.doc=function(t){if(Ni("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Br.u()),Ai("CollectionReference.doc","non-empty string",1,t),""===t)throw new oi(ii.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=zi.ot(t);return Kp.Zm(this.mp.path.child(e),this.firestore,this.ep)},dd.prototype.add=function(t){Ii("CollectionReference.add",arguments,1),Ai("CollectionReference.add","object",1,this.ep?this.ep.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},dd.prototype.withConverter=function(t){return new dd(this.Vp,this.firestore,t)},dd);function dd(t,e,n){var r=ld.call(this,wa.ei(t),e,n)||this;if((r.Vp=t).length%2!=1)throw new oi(ii.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.st()+" has "+t.length);return r}function yd(t,e){if(void 0===e)return{merge:!1};if(Li(t,e,["merge","mergeFields"]),Di(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new oi(ii.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Ci(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new oi(ii.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+Ci(r[o]))}(t,e,n,r,i)}(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof il}),void 0!==e.mergeFields&&void 0!==e.merge)throw new oi(ii.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function vd(t,e){return void 0===e?{}:(Li(t,e,["serverTimestamps"]),Ri(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function md(t,e){Si(t,"object",1,e),e&&(Li(t,e,["source"]),Ri(t,0,"source",e.source,["default","server","cache"]))}function gd(t,e,n){if(e instanceof Kp){if(e.firestore!==n)throw new oi(ii.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Pi(t,"DocumentReference",1,e)}function wd(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}var bd=zu(Hp,"Use firebase.firestore() instead."),Ed=zu(Qp,"Use firebase.firestore().runTransaction() instead."),Id=zu(Zp,"Use firebase.firestore().batch() instead."),Td=zu(Kp,"Use firebase.firestore().doc() instead."),Nd=zu($p),Ad=zu(Xp),Sd=zu(td),kd=zu(ed),Dd=zu(pd,"Use firebase.firestore().collection() instead."),Rd={Firestore:bd,GeoPoint:ji,Timestamp:Bi,Blob:$u,Transaction:Ed,WriteBatch:Id,DocumentReference:Td,DocumentSnapshot:Nd,Query:Sd,QueryDocumentSnapshot:Ad,QuerySnapshot:kd,CollectionReference:Dd,FieldPath:il,FieldValue:Nl,setLogLevel:Hp.setLogLevel,CACHE_SIZE_UNLIMITED:zp};var _d=(jd.prototype.Fd=function(t){},jd.prototype.shutdown=function(){},jd),Od=(Fd.prototype.Fd=function(t){this.xp.push(t)},Fd.prototype.shutdown=function(){window.removeEventListener("online",this.kp),window.removeEventListener("offline",this.Op)},Fd.prototype.jp=function(){window.addEventListener("online",this.kp),window.addEventListener("offline",this.Op)},Fd.prototype.Np=function(){Mr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.xp;t<e.length;t++)(0,e[t])(0)},Fd.prototype.Fp=function(){Mr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.xp;t<e.length;t++)(0,e[t])(1)},Fd.Js=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Fd),Cd=(qd.prototype._l=function(t){jr(!this.Bp,"Called onOpen on stream twice!"),this.Bp=t},qd.prototype.ml=function(t){jr(!this.Mp,"Called onClose on stream twice!"),this.Mp=t},qd.prototype.onMessage=function(t){jr(!this.qp,"Called onMessage on stream twice!"),this.qp=t},qd.prototype.close=function(){this.Lp()},qd.prototype.send=function(t){this.Up(t)},qd.prototype.Qp=function(){jr(void 0!==this.Bp,"Cannot call onOpen because no callback was set"),this.Bp()},qd.prototype.Gp=function(t){jr(void 0!==this.Mp,"Cannot call onClose because no callback was set"),this.Mp(t)},qd.prototype.Wp=function(t){jr(void 0!==this.qp,"Cannot call onMessage because no callback was set"),this.qp(t)},qd),xd={BatchGetDocuments:"batchGet",Commit:"commit"},Ld="gl-js/ fire/"+xr,Pd=(Vd.prototype.Kp=function(t,e){if(e)for(var n in e.A)e.A.hasOwnProperty(n)&&(t[n]=e.A[n]);t["X-Goog-Api-Client"]=Ld},Vd.prototype.Nl=function(u,r,i){var h=this,c=this.Hp(u);return new Promise(function(o,s){var a=new Cr;a.listenOnce(_r.COMPLETE,function(){try{switch(a.getLastErrorCode()){case Rr.NO_ERROR:var t=a.getResponseJson();Mr("Connection","XHR received:",JSON.stringify(t)),o(t);break;case Rr.TIMEOUT:Mr("Connection",'RPC "'+u+'" timed out'),s(new oi(ii.DEADLINE_EXCEEDED,"Request time out"));break;case Rr.HTTP_ERROR:var e=a.getStatus();if(Mr("Connection",'RPC "'+u+'" failed with status:',e,"response text:",a.getResponseText()),0<e){var n=a.getResponseJson().error;if(n&&n.status&&n.message){var r=(i=n.status.toLowerCase().replace("_","-"),0<=Object.values(ii).indexOf(i)?i:ii.UNKNOWN);s(new oi(r,n.message))}else s(new oi(ii.UNKNOWN,"Server responded with status "+a.getStatus()))}else Mr("Connection",'RPC "'+u+'" failed'),s(new oi(ii.UNAVAILABLE,"Connection failed."));break;default:Fr('RPC "'+u+'" failed with unanticipated webchannel error '+a.getLastErrorCode()+": "+a.getLastError()+", giving up.")}}finally{Mr("Connection",'RPC "'+u+'" completed.')}var i});var t=f({},r);delete t.database;var e=JSON.stringify(t);Mr("Connection","XHR sending: ",c+" "+e);var n={"Content-Type":"text/plain"};h.Kp(n,i),a.send(c,"POST",e,n,15)})},Vd.prototype.Ol=function(t,e,n){return this.Nl(t,e,n)},Vd.prototype.Il=function(t,e){var n=[this.zp,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Dr(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.s.projectId+"/databases/"+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.Kp(i.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(l())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=l().indexOf("Electron/")||function(){var t=l();return 0<=t.indexOf("MSIE ")||0<=t.indexOf("Trident/")}()||0<=l().indexOf("MSAppHost/")||function(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function s(t,e){u.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Mr("Connection","Creating WebChannel: "+o+" "+i);var u=r.createWebChannel(o,i),a=!1,h=!1,c=new Cd({Up:function(t){h?Mr("Connection","Not sending because WebChannel is closed:",t):(a||(Mr("Connection","Opening WebChannel transport."),u.open(),a=!0),Mr("Connection","WebChannel sending:",t),u.send(t))},Lp:function(){return u.close()}});return s(Or.EventType.OPEN,function(){h||Mr("Connection","WebChannel transport opened.")}),s(Or.EventType.CLOSE,function(){h||(h=!0,Mr("Connection","WebChannel transport closed"),c.Gp())}),s(Or.EventType.ERROR,function(t){h||(h=!0,Mr("Connection","WebChannel transport errored:",t),c.Gp(new oi(ii.UNAVAILABLE,"The operation could not be completed")))}),s(Or.EventType.MESSAGE,function(t){var e;if(!h){var n=t.data[0];jr(!!n,"Got a webchannel message without data.");var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){Mr("Connection","WebChannel received error:",i);var o=i.status,s=function(){var t=Ga[o];if(void 0!==t)return Ka(t)}(),a=i.message;void 0===s&&(s=ii.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),h=!0,c.Gp(new oi(s,a)),u.close()}else Mr("Connection","WebChannel received:",n),c.Wp(n)}}),setTimeout(function(){c.Qp()},0),c},Vd.prototype.Hp=function(t){var e=xd[t];return jr(void 0!==e,"Unknown REST mapping for: "+t),this.zp+"/v1/projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents:"+e},Vd),Ud=(Object.defineProperty(Md.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(Md.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),Md.prototype.Dm=function(t){return Promise.resolve(new Pd(t))},Md.prototype.Sm=function(){return Od.Js()?new Od:new _d},Md.prototype.Cm=function(t){return new Fu(t,{Xe:!0})},Md.prototype.i=function(t){return JSON.stringify(t)},Md.prototype.atob=function(t){return atob(t)},Md.prototype.btoa=function(t){return btoa(t)},Md);function Md(){this.Ye="",this.du="undefined"!=typeof atob}function Vd(t){this.s=t.s;var e=t.ssl?"https":"http";this.zp=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function qd(t){this.Up=t.Up,this.Lp=t.Lp}function Fd(){var t=this;this.kp=function(){return t.Np()},this.Op=function(){return t.Fp()},this.xp=[],this.jp()}function jd(){}ju.lu(new Ud);var Bd;(Bd=Gd).INTERNAL.registerComponent(new b("firestore",function(t){var e=t.getProvider("app").getImmediate();return new Hp(e,t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(function(t){jr(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(Rd))),Bd.registerVersion("@firebase/firestore","1.11.0")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map
